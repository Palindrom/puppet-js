<link rel="import" href="../../../../polymer/polymer.html">

<polymer-element name="puppet-animation">
  <template>
    <style>
      #puppetAnim {
        width: 107px;
        height: 145px;
        position: fixed;
        left: 0;
        bottom: 125px;
      }

      #puppet {
        width: 107px;
        height: 145px;
      }

      .mirrored {
        -webkit-transform: rotateY(180deg);
        transform: rotateY(180deg);
      }
    </style>
    <div id="puppetAnim">
      <img id="puppet" src="puppet.png">
    </div>
  </template>
  <script>
    function animatePuppet() {

    }

    Polymer("puppet-animation", {
      position: 0, //0 .. 100
      direction: 1,
      step: 1,
      width: 107,
      height: 145,
      ready: function () {
        this.animateStep();
      },
      animateStep: function () {
        var that = this;
        window.requestAnimationFrame(function () {
          var maxLeft = window.innerWidth - that.width;

          that.position = that.position + that.step * that.direction;

          var left = maxLeft * that.position / 100 + "px";

          var jumpLength = 4; //1-20
          var jumpHeight = 100; //px

          var bottom = Math.abs(jumpHeight * Math.sin(that.position / jumpLength)) + "px";

          that.$.puppetAnim.style.transform = 'translate(' + left + ', ' + bottom + ')';
          that.$.puppetAnim.style.webkitTransform =  that.$.puppetAnim.style.transform;

          if (that.position >= 100 || that.position <= 0) {
            that.direction = -that.direction;
            if (that.direction > 0) {
              that.$.puppet.classList.remove("mirrored");
            }
            else {
              that.$.puppet.classList.add("mirrored");
            }
          }

          window.requestAnimationFrame(function () {
            that.animateStep();
          });
        })
      }
    });
  </script>
</polymer-element>