/**
 * angular-ui-handsontable 0.3.11
 * 
 * Date: Mon Jun 17 2013 00:27:03 GMT+0200 (Central European Daylight Time)
*/

document.all&&!document.addEventListener&&(document.createElement("ui-handsontable"),document.createElement("datacolumn"),document.createElement("optionlist")),angular.module("uiHandsontable",[]).factory("getHandsontableSettings",function(){return function(t){var e=t.data("uiDatagrid");return e||(e={settings:{columns:[],colHeaders:!0,outsideClickDeselects:!0,autoComplete:[]},$container:$('<div class="ui-handsontable-container"></div>')},t.data("uiDatagrid",e)),e}}).factory("getDatacolumnSettings",function(){return function(t){var e=t.data("uiDatagridDatacolumn");return e||(e={},t.data("uiDatagridDatacolumn",e)),e}}).directive("uiHandsontable",function(t,e,i){for(var n=["data","width","height","rowHeaders","colHeaders","colWidths","columns","cells","dataSchema","contextMenu","onSelection","onSelectionByProp","onBeforeChange","onChange","onCopyLimit","startRows","startCols","minRows","minCols","maxRows","maxCols","minSpareRows","minSpareCols","multiSelect","fillHandle","undo","outsideClickDeselects","enterBeginsEditing","enterMoves","tabMoves","autoWrapRow","autoWrapCol","copyRowsLimit","copyColsLimit","currentRowClassName","currentColClassName","asyncRendering","stretchH","columnSorting","manualColumnMove","manualColumnResize"],o={selectedIndex:"=selectedindex"},s=0,r=n.length;r>s;s++)o[n[s]]="="+n[s].toLowerCase();var a={restrict:"EA",scope:o,priority:490,compile:function(o,s){var r,a,l,c=function(e,i,n){var o=i.optionList,s=o.match(/^\s*(.+)\s+in\s+(.*)\s*$/);if(!s)throw Error("Expected datarows in form of '_item_ in _collection_' but got '"+o+"'.");var r,a,l,c=s[1],h=s[2],u=e.$new();n.$container.on("blur","textarea",function(){l&&l()}),i.source=function(t,o){l&&l();var s=function(){var t=n.$container.data("handsontable"),i=t.getSelected()[0];return u[n.lhs]=e.$parent.$eval(n.rhs)[i],u.$eval(h)};r=s(),u.$$phase||u.$apply(),o(r),a.$apply(),l=e.$parent.$watch(s,function(e,n){e!==n&&setTimeout(function(){i.source(t,o)},0)}),i.saveOnBlur||(u.$eval(i.value+' = "'+$.trim(t).replace(/"/g,'"')+'"'),u.$apply())},i.sorter=function(t){return t},i.highlighter=function(e){var n,o=u.$new();return o[c]=e,a=o,i.transclude?i.transclude(o,function(t){n=t[0]}):n=t("<span>"+i.optionTemplate+"</span>")(o),n},i.onSelect=function(t,e,n,o,s){u[c]=r[s],u.$eval(i.clickrow),u.$apply()}},h=s.datarows;if(h&&(r=h.match(/^\s*(.+)\s+in\s+(.*)\s*$/)),!r)throw Error("Expected datarows in form of '_item_ in _collection_' but got '"+h+"'.");return a=r[1],l=r[2],function(t,o,s){var r,h,u=i(o);u.lhs=a,u.rhs=l,u.settings=angular.extend(u.settings,t.$parent.$eval(s.uiHandsontable||s.settings));for(r in n)n.hasOwnProperty(r)&&t[n[r]]!==void 0&&(u.settings[n[r]]=t[n[r]]);$(o).append(u.$container);var d=t.$parent.$eval(l);if(d!==void 0&&(u.settings.data=d),u.settings.columns){var p=RegExp("^("+a+"\\.)");for(r=0,h=u.settings.columns.length;h>r;r++)u.settings.columns[r].data=u.settings.columns[r].value.replace(p,""),"autocomplete"===u.settings.columns[r].type&&c(t,u.settings.columns[r],u)}u.settings.afterChange=function(){e.$$phase||t.$apply()},u.settings.afterSelectionByProp=function(e,i,n,o){t.$emit("datagridSelection",u.$container,e,i,n,o)},u.$container.handsontable(u.settings);var f=0;for(t.$watch(function(){if(t.$parent.$eval(l)!==u.$container.handsontable("getData"))return!0;var e=u.$container.data("handsontable"),i=e.countRows();if(f!==i)return f=i;for(var n="",o=e.countCols(),s=e.rowOffset(),r=s+e.countVisibleRows();r>s;s++)for(var a=0;o>a;a++)n+=e.getDataAtCell(s,a);return n},function(e,i){1==e?u.$container.handsontable("loadData",t.$parent.$eval(l)):e!==i&&u.$container.handsontable("render")},!1),r=0,h=n.length;h>r;r++)(function(e){t.$watch(e,function(i,n){if(i!==n){if("columns"===e)for(var o=RegExp("^("+a+"\\.)"),s=0,r=i.length;r>s;s++)i[s].data=i[s].value.replace(o,""),"autocomplete"===i[s].type&&c(t,i[s],u);var l={};l[e]=i,u.$container.handsontable("updateSettings",l)}},!0)})(n[r])}}};return a}).directive("datacolumn",function(t,e){var i={restrict:"E",priority:500,compile:function(i,n){return function(i,o,s){var r,a=t(o.parent()),l=e(o),c=i.$parent.$eval(s.title),h=i.$parent.$eval(s.width),u=i.$parent.$eval(s.type),d=s.options,p=[];for(r in s)n.hasOwnProperty(r)&&p.push(r);l.value=s.value,l.source=null,l.saveOnBlur=-1!==$.inArray("saveonblur",p),l.strict=-1!==$.inArray("strict",p);var f=i.$new(),g=i.$parent.$eval(d)||{};switch(g.value=s.value,g.type=u,g.title=c,g.width=h,u){case"autocomplete":for(r in l)l.hasOwnProperty(r)&&(g[r]=l[r]);break;case"checkbox":s.checkedtemplate!==void 0&&(g.checkedTemplate=i.$parent.$eval(s.checkedtemplate)),s.uncheckedtemplate!==void 0&&(g.uncheckedTemplate=i.$parent.$eval(s.uncheckedtemplate))}s.readonly!==void 0&&(g.readOnly=!0);for(r in s)s.hasOwnProperty(r)&&"$"!==r.charAt(0)&&g[r]===void 0&&(g[r]=f.$eval(s[r]));a.settings.columns.push(g)}}};return i}).directive("optionlist",function(t){var e={restrict:"E",transclude:"element",priority:510,compile:function(e,i,n){return function(e,i,o){var s=t(i.parent());s.optionList=o.datarows,s.clickrow=o.clickrow,s.transclude=n}}};return e}).directive("selectedindex",function(t){var e={restrict:"A",priority:491,compile:function(){return function(e,i){var n,o,s,r=t(i).$container;t(i).settings.afterSelection=function(t,i){n=!0,o=t,s=i,e.$$phase||void 0===e.selectedIndex||e.selectedIndex==t||e.$apply(function(){e.selectedIndex=t})},t(i).settings.afterDeselect=function(){n=!1,o=null,e.$$phase||void 0===e.selectedIndex||null==e.selectedIndex||e.$apply(function(){e.selectedIndex=null})},e.$watch("selectedIndex",function(t){var e=parseInt(t,10);if(t!==void 0&&null!==t&&e!==o){var i=s||0;r.handsontable("selectCell",e,i,e,i,!0)}},!1)}}};return e});var Handsontable={extension:{},helper:{}};(function(t,e,i){"use strict";function n(t){this.isCellEdited=!1,this.instance=t,this.createElements(),this.bindEvents()}function o(t){this.isCellEdited=!1,this.instance=t,this.createElements(),this.bindEvents(),this.emptyStringLabel="   "}function s(t,e,n,o){i.helper.stringify(t.getDataAtRowProp(e,n))===i.helper.stringify(o.checkedTemplate)?t.setDataAtRowProp(e,n,o.uncheckedTemplate):t.setDataAtRowProp(e,n,o.checkedTemplate)}function r(e){if(!t.datepicker)throw Error("jQuery UI Datepicker dependency not found. Did you forget to include jquery-ui.custom.js or its substitute?");this.isCellEdited=!1,this.instance=e,this.createElements(),this.bindEvents()}function a(t){this.isCellEdited=!1,this.instance=t,this.createElements(),this.bindEvents()}function l(){var e,n=this,o=5;this.beforeInit=function(){this.autoColumnWidths=[],this.autoColumnSizeTmp={thead:null,theadTh:null,theadStyle:null,tbody:null,tbodyTd:null,noRenderer:null,noRendererTd:null,renderer:null,rendererTd:null,container:null,containerStyle:null,$container:null,$noRenderer:null,$renderer:null}},this.determineColumnWidth=function(n){var s,r=e.autoColumnSizeTmp;r.container||(s=document,r.thead=s.createElement("table"),r.thead.appendChild(s.createElement("thead")).appendChild(s.createElement("tr")).appendChild(s.createElement("th")),r.theadTh=r.thead.getElementsByTagName("th")[0],r.thead.className="htTable",r.theadStyle=r.thead.style,r.theadStyle.tableLayout="auto",r.theadStyle.width="auto",r.tbody=r.thead.cloneNode(!1),r.tbody.appendChild(s.createElement("tbody")).appendChild(s.createElement("tr")).appendChild(s.createElement("td")),r.tbodyTd=r.tbody.getElementsByTagName("td")[0],r.noRenderer=r.tbody.cloneNode(!0),r.noRendererTd=r.noRenderer.getElementsByTagName("td")[0],r.renderer=r.tbody.cloneNode(!0),r.rendererTd=r.renderer.getElementsByTagName("td")[0],r.container=s.createElement("div"),r.container.className=e.rootElement[0].className+" hidden",r.containerStyle=r.container.style,r.container.appendChild(r.thead),r.container.appendChild(r.tbody),r.container.appendChild(r.noRenderer),r.container.appendChild(r.renderer),r.$container=t(r.container),r.$noRenderer=t(r.noRenderer),r.$renderer=t(r.renderer),e.rootElement[0].parentNode.appendChild(r.container)),r.container.className=e.rootElement[0].className+" hidden";var a=e.$table[0].className;r.thead.className=a,r.tbody.className=a;for(var l=e.countRows(),c={},h=0,u=0;l>u;u++){var d=i.helper.stringify(e.getDataAtCell(u,n)),p=d.length;p>h&&(h=p),c[p]||(c[p]={needed:o,strings:[]}),c[p].needed&&(c[p].strings.push(d),c[p].needed--)}var f=e.getSettings();f.colHeaders&&e.view.appendColHeader(n,r.theadTh);var g="";for(var m in c)if(c.hasOwnProperty(m))for(var w=0,v=c[m].strings.length;v>w;w++)g+=c[m].strings[w]+"<br>";r.tbodyTd.innerHTML=g,e.view.wt.wtDom.empty(r.rendererTd),e.view.wt.wtDom.empty(r.noRendererTd),r.containerStyle.display="block";var y=r.$container.outerWidth(),b=e.getCellMeta(0,n);if(b.renderer){var C=9999999999;r.noRendererTd.appendChild(document.createTextNode(C));var S=i.helper.getCellMethod("renderer",b.renderer);S(e,r.rendererTd,0,n,e.colToProp(n),C,b),y+=r.$renderer.width()-r.$noRenderer.width()}return r.containerStyle.display="none",y},this.determineColumnsWidth=function(){e=this;var t=this.getSettings();if(t.autoColumnSize||!t.colWidths)for(var i=this.countCols(),o=0;i>o;o++)this.autoColumnWidths[o]=n.determineColumnWidth(o)},this.getColWidth=function(t,e){this.autoColumnWidths[t]&&this.autoColumnWidths[t]>e.width&&(e.width=this.autoColumnWidths[t])}}function c(){var e,i=this;this.afterInit=function(){var e=this;this.getSettings().columnSorting&&(this.sortIndex=[],this.rootElement.on("click.handsontable",".columnSorting",function(n){var o=t(n.target);if(o.is(".columnSorting")){var s=o.closest("th").index();e.getSettings().rowHeaders&&s--,e.sortColumn===s?e.sortOrder=!e.sortOrder:(e.sortColumn=s,e.sortOrder=!0),i.sort.call(e),e.render()}}))},this.sort=function(){e=!1;var t=this;this.sortIndex.length=0;for(var i=0,n=this.countRows();n>i;i++)this.sortIndex.push([i,t.getDataAtCell(i,this.sortColumn)]);this.sortIndex.sort(function(e,i){return e[1]===i[1]?0:null===e[1]?1:null===i[1]?-1:e[1]<i[1]?t.sortOrder?-1:1:e[1]>i[1]?t.sortOrder?1:-1:0}),e=!0},this.translateRow=function(t){e&&this.sortIndex&&this.sortIndex.length&&(t.row=this.sortIndex[t.row][0])},this.getColHeader=function(e,i){this.getSettings().columnSorting&&(t(i).find("span.colHeader")[0].className+=" columnSorting")}}function h(){function e(t){var e=s.getSelected();if(e)switch(t){case"row_above":s.alter("insert_row",e[0]);break;case"row_below":s.alter("insert_row",e[2]+1);break;case"col_left":s.alter("insert_col",e[1]);break;case"col_right":s.alter("insert_col",e[3]+1);break;case"remove_row":s.alter(t,e[0],e[2]-e[0]+1);break;case"remove_col":s.alter(t,e[1],e[3]-e[1]+1);break;case"undo":s.undo();break;case"redo":s.redo()}}function i(t){return s.countRows()>=s.getSettings().maxRows&&("row_above"===t||"row_below"===t)?!0:s.countCols()>=s.getSettings().maxCols&&("col_left"===t||"col_right"===t)?!0:!1}var n,o,s=this,r=s.rootElement[0].id,a={row_above:{name:"Insert row above",disabled:i},row_below:{name:"Insert row below",disabled:i},hsep1:"---------",col_left:{name:"Insert column on the left",disabled:i},col_right:{name:"Insert column on the right",disabled:i},hsep2:"---------",remove_row:{name:"Remove row",disabled:i},remove_col:{name:"Remove column",disabled:i},hsep3:"---------",undo:{name:"Undo",disabled:function(){return!s.isUndoAvailable()}},redo:{name:"Redo",disabled:function(){return!s.isRedoAvailable()}}},l={selector:"#"+r+" table, #"+r+" div",trigger:"right",callback:e},c={},h=s.getSettings();if(h.contextMenu){if(h.contextMenu===!0)c.items=a;else if("[object Array]"===Object.prototype.toString.apply(h.contextMenu))for(c.items={},n=0,o=h.contextMenu.length;o>n;n++){var u=h.contextMenu[n];if(a[u]===void 0)throw Error('Context menu key "'+u+'" is not recognised');c.items[u]=a[u]}else if("[object Object]"===Object.prototype.toString.apply(h.contextMenu)){if(c=h.contextMenu,c.items)for(n in c.items)c.items.hasOwnProperty(n)&&a[n]&&(c.items[n]="string"==typeof c.items[n]?a[n]:t.extend(!0,a[n],c.items[n]));else c.items=a;if(c.callback){var d=l.callback,p=c.callback;c.callback=function(t,e){d(t,e),p(t,e)}}}if(!r)throw Error("Handsontable container must have an id");t.contextMenu(t.extend(!0,l,c))}}function u(){var e=this.rootElement[0].id;t.contextMenu("destroy","#"+e+" table, #"+e+" div")}function d(){var e,i,n,o,s,r,a=document.createElement("DIV"),l=a.style;a.className="ghost",l.position="absolute",l.top="25px",l.left=0,l.width="10px",l.height="10px",l.backgroundColor="#CCC",l.opacity=.7,t(document).mousemove(function(t){i&&(l.left=r+t.pageX-s+6+"px","none"===l.display&&(l.display="block"))}),t(document).mouseup(function(){i&&(o>n&&o--,e.getSettings().rowHeaders&&(n--,o--),e.manualColumnPositions.splice(o,0,e.manualColumnPositions.splice(n,1)[0]),t(".manualColumnMover.active").removeClass("active"),i=!1,e.forceFullRender=!0,e.view.render(),l.display="none",e.PluginHooks.run("afterColumnMove",n,o))}),this.beforeInit=function(){this.manualColumnPositions=[]},this.afterInit=function(){if(this.getSettings().manualColumnMove){var c=this;this.rootElement.on("mousedown.handsontable",".manualColumnMover",function(o){e=c;var h=t(o.target),u=h.closest("th");n=u.index(),i=!0,s=o.pageX;var d=c.rootElement.find(".htCore");d.parent()[0].appendChild(a),l.width=h.parent().width()+"px",l.height=d.height()+"px",r=parseInt(u.offset().left-d.offset().left,10),l.left=r+6+"px"}),this.rootElement.on("mouseenter.handsontable","td, th",function(){if(i){t(".manualColumnMover.active").removeClass("active");var e=c.rootElement.find("thead th");o=t(this).index();var n=e.eq(o).find(".manualColumnMover").addClass("active");e.not(n).removeClass("active")}})}},this.modifyCol=function(t){return this.getSettings().manualColumnMove?(this.manualColumnPositions[t]===void 0&&(this.manualColumnPositions[t]=t),this.manualColumnPositions[t]):t},this.getColHeader=function(t,e){if(this.getSettings().manualColumnMove){var i=document.createElement("DIV");i.className="manualColumnMover",e.firstChild.appendChild(i)}}}function p(){var e,i,n,o,s,r,a,l,c,h,u=0,d=document.createElement("DIV"),p=document.createElement("DIV"),f=p.style;d.className="manualColumnResizer",p.className="manualColumnResizerLine",f.position="absolute",f.top=0,f.left=0,f.width=0,f.borderRight="1px dashed #777",p.appendChild(d),t(document).mousemove(function(t){e&&(n=c+(t.pageX-l),r=g(i,n),f.left=h+n-1+"px","none"===f.display&&(f.display="block"))}),t(document).mouseup(function(){e&&(t(".manualColumnResizer.active").removeClass("active"),e=!1,s.forceFullRender=!0,s.view.render(),f.display="none",s.PluginHooks.run("afterColumnResize",i,r))}),this.beforeInit=function(){this.manualColumnWidths=[]},this.afterInit=function(){if(this.getSettings().manualColumnResize){var d=this;this.rootElement.on("mousedown.handsontable",".manualColumnResizer",function(){null==o&&(o=setTimeout(function(){u>=2&&(g(i,z.determineColumnWidth.call(s,i)),s.PluginHooks.run("afterColumnResize",i,r)),u=0,o=null},500)),u++}),this.rootElement.on("mousedown.handsontable",".manualColumnResizer",function(o){var r=o.target,u=d.rootElement.find(".htCore"),g=t(r.parentNode.parentNode);s=d,i=r.getAttribute("rel"),a=t(d.rootElement[0].getElementsByTagName("col")[g.index()]),e=!0,l=o.pageX,c=a.width(),n=c,r.className+=" active",f.height=u.height()+"px",u.parent()[0].appendChild(p),h=parseInt(g.offset().left-u.offset().left,10),f.left=h+n-1+"px"})}};var g=function(t,e){return e=Math.max(e,20),e=Math.min(e,500),s.manualColumnWidths[t]=e,e};this.getColHeader=function(t,e){if(this.getSettings().manualColumnResize){var i=document.createElement("DIV");i.className="manualColumnResizer",i.setAttribute("rel",t),e.firstChild.appendChild(i)}},this.getColWidth=function(t,e){this.getSettings().manualColumnResize&&this.manualColumnWidths[t]&&(e.width=this.manualColumnWidths[t])}}function f(){function t(e,i){for(var n in i){var o=i[n];o instanceof Object&&(Object.unobserve(o,e),o.____Path=i.____Path+"/"+n,t(e,o))}}function i(t,e){delete e.____Path,Object.observe(e,t);for(var n in e){var o=e[n];o instanceof Object&&i(t,o)}}function n(n,r){var h=[],u=n;if(Object.observe)var d=function(e){u.___Path||(Object.unobserve(u,d),u.____Path="",t(d,u),e.forEach(function(t){"____Path"!=t.name&&a[t.type].call(t,h,t.object.____Path)}),i(d,u)),r&&r.call(h)};else{d={};for(var p,f=0,g=l.length;g>f;f++)if(l[f].obj===n){p=l[f];break}if(p||(p={obj:n},l.push(p)),p.value=JSON.parse(JSON.stringify(n)),r){c.push(r);var m,w=[100],v=0,y=function(){var t=s(d);t.length>0&&(d.patches=[],r.call(null,t))},b=function(){clearTimeout(m),m=setTimeout(function(){y(),v=0,m=setTimeout(C,w[v++])},0)},C=function(){y(),v==w.length&&(v=w.length-1),m=setTimeout(C,w[v++])};["mousedown","mouseup","keydown"].forEach(function(t){e.addEventListener(t,b)}),m=setTimeout(C,w[v++])}}return d.patches=h,d.object=n,o(d,n,h)}function o(t,e,i){Object.observe&&Object.observe(e,t);for(var n in e)if(e.hasOwnProperty(n)){var s=e[n];s&&"object"==typeof s&&o(t,s,i)}return t}function s(t){if(Object.observe)Object.deliverChangeRecords(t);else{for(var e,i=0,n=l.length;n>i;i++)if(l[i].obj===t.object){e=l[i];break}r(e.value,t.object,t.patches,"")}return t.patches}function r(t,e,i,n){for(var o=Object.keys(e),s=Object.keys(t),a=!1,l=!1,c=0;s.length>c;c++){var h=s[c],u=t[h];if(e.hasOwnProperty(h)){var d=e[h];u instanceof Object?r(u,d,i,n+"/"+h):u!=d&&(a=!0,i.push({op:"replace",path:n+"/"+h,value:d}),t[h]=d)}else i.push({op:"remove",path:n+"/"+h}),l=!0}if(l||o.length!=s.length)for(var c=0;o.length>c;c++){var h=o[c];t.hasOwnProperty(h)||i.push({op:"add",path:n+"/"+h,value:e[h]})}}var a={"new":function(t,e){var i={op:"add",path:e+"/"+this.name,value:this.object[this.name]};t.push(i)},deleted:function(t,e){var i={op:"remove",path:e+"/"+this.name};t.push(i)},updated:function(t,e){var i={op:"replace",path:e+"/"+this.name,value:this.object[this.name]};t.push(i)}},l=[],c=[];this.afterLoadData=function(){if(!this.observer&&this.getSettings().observeChanges){var t=this;this.observer=n(this.getData(),function(){t.render()})}}}function g(t){var e,i=this;t=t||document.body,this.elDiv=document.createElement("DIV"),e=this.elDiv.style,e.position="fixed",e.top=0,e.left=0,t.appendChild(this.elDiv),this.elTextarea=document.createElement("TEXTAREA"),this.elTextarea.className="copyPaste",e=this.elTextarea.style,e.width="1px",e.height="1px",this.elDiv.appendChild(this.elTextarea),e.opacity!==void 0&&(e.opacity=0),this._bindEvent(t,"keydown",function(t){var e=!1;t.metaKey?e=!0:t.ctrlKey&&-1===navigator.userAgent.indexOf("Mac")&&(e=!0),e&&(i.selectNodeText(i.elTextarea),setTimeout(function(){i.selectNodeText(i.elTextarea)},0)),!e||67!==t.keyCode&&86!==t.keyCode&&88!==t.keyCode||(88===t.keyCode?setTimeout(function(){i.triggerCut(t)},0):86===t.keyCode&&setTimeout(function(){i.triggerPaste(t)},0))})}function m(t,e){var i;this.instance=t,this.settings=e,this.wtDom=this.instance.wtDom,this.main=document.createElement("div"),i=this.main.style,i.position="absolute",i.top=0,i.left=0;for(var n=0;5>n;n++){var o=document.createElement("DIV");o.className="wtBorder "+(e.className||""),i=o.style,i.backgroundColor=e.border.color,i.height=e.border.width+"px",i.width=e.border.width+"px",this.main.appendChild(o)}this.top=this.main.childNodes[0],this.left=this.main.childNodes[1],this.bottom=this.main.childNodes[2],this.right=this.main.childNodes[3],this.topStyle=this.top.style,this.leftStyle=this.left.style,this.bottomStyle=this.bottom.style,this.rightStyle=this.right.style,this.corner=this.main.childNodes[4],this.corner.className+=" corner",this.cornerStyle=this.corner.style,this.cornerStyle.width="5px",this.cornerStyle.height="5px",this.cornerStyle.border="2px solid #FFF",this.disappear(),t.wtTable.hider.appendChild(this.main)}function w(){this.offset=0,this.total=0,this.fixedCount=0}function v(){}function y(){this.cache=[]}function b(){this.countTH=0}function C(t,e,i){var n,o=0;for(this.containerSizeFn=t,this.cellSizesSum=0,this.cellSizes=[],this.cellStretch=[],this.cellCount=0,this.remainingSize=0,this.strategy=i;;){if(n=e(o),void 0===n)break;if(this.cellSizesSum>=this.getContainerSize(this.cellSizesSum+n))break;this.cellSizes.push(n),this.cellSizesSum+=n,this.cellCount++,o++}var s=this.getContainerSize(this.cellSizesSum);this.remainingSize=this.cellSizesSum-s}function S(t){var e=this,i=[];if(this.wtSettings=new M(this,t),this.wtDom=new x,this.wtTable=new A(this),this.wtScroll=new E(this),this.wtScrollbars=new H(this),this.wtViewport=new O(this),this.wtWheel=new N(this),this.wtEvent=new T(this),this.wtTable.THEAD.childNodes.length&&this.wtTable.THEAD.childNodes[0].childNodes.length){for(var n=0,o=this.wtTable.THEAD.childNodes[0].childNodes.length;o>n;n++)i.push(this.wtTable.THEAD.childNodes[0].childNodes[n].innerHTML);this.getSetting("columnHeaders").length||this.update("columnHeaders",[function(t,n){e.wtDom.avoidInnerHTML(n,i[t])}])}this.selections={};var s=this.getSetting("selections");if(s)for(var r in s)s.hasOwnProperty(r)&&(this.selections[r]=new $(this,s[r]));this.drawn=!1,this.drawInterrupted=!1}function x(){}function T(e){var i=this;this.instance=e,this.wtDom=this.instance.wtDom;var n=[null,null,null,null];this.instance.dblClickTimeout=null;var o,s=function(t){var e=i.parentCell(t.target);e.TD&&"TD"===e.TD.nodeName?i.instance.hasSetting("onCellMouseDown")&&i.instance.getSetting("onCellMouseDown",t,e.coords,e.TD):i.wtDom.hasClass(t.target,"corner")&&i.instance.getSetting("onCellCornerMouseDown",t,t.target),2!==t.button&&(e.TD&&"TD"===e.TD.nodeName?(n.shift(),n.push(e.TD)):i.wtDom.hasClass(t.target,"corner")&&(n.shift(),n.push(t.target)))},r=function(t){if(i.instance.hasSetting("onCellMouseOver")){var e=i.wtDom.closest(t.target,["TD","TH"]);e&&e!==o&&(o=e,"TD"===e.nodeName&&i.instance.getSetting("onCellMouseOver",t,i.instance.wtTable.getCoords(e),e))}},a=function(t){if(2!==t.button){var e=i.parentCell(t.target);e.TD&&"TD"===e.TD.nodeName?(n.shift(),n.push(e.TD)):(n.shift(),n.push(t.target)),null!==n[3]&&n[3]===n[2]&&(i.instance.dblClickTimeout&&n[2]===n[1]&&n[1]===n[0]?(e.TD?i.instance.getSetting("onCellDblClick",t,e.coords,e.TD):i.wtDom.hasClass(t.target,"corner")&&i.instance.getSetting("onCellCornerDblClick",t,e.coords,e.TD),clearTimeout(i.instance.dblClickTimeout),i.instance.dblClickTimeout=null):(clearTimeout(i.instance.dblClickTimeout),i.instance.dblClickTimeout=setTimeout(function(){i.instance.dblClickTimeout=null},500)))}};t(this.instance.wtTable.parent).on("mousedown",s),t(this.instance.wtTable.TABLE).on("mouseover",r),t(this.instance.wtTable.parent).on("mouseup",a)}function k(){}function R(t,e){this.containerSizeFn=t,this.sizeAtIndex=e,this.cellSizesSum=0,this.cellSizes=[],this.cellCount=0,this.remainingSize=-1/0}function E(t){this.instance=t}function D(){}function P(){this.lastWindowScrollPosition=0/0}function H(t){switch(t.getSetting("scrollbarModelV")){case"dragdealer":this.vertical=new X(t);break;case"native":this.vertical=new K(t)}switch(t.getSetting("scrollbarModelH")){case"dragdealer":this.horizontal=new Y(t);break;case"native":this.horizontal=new U(t)}}function $(t,e){this.instance=t,this.settings=e,this.selected=[],e.border&&(this.border=new m(t,e))}function M(t,e){var i=this;this.instance=t,this.defaults={table:void 0,scrollH:"auto",scrollV:"auto",scrollbarModelH:"dragdealer",scrollbarModelV:"dragdealer",stretchH:"hybrid",currentRowClassName:null,currentColumnClassName:null,data:void 0,offsetRow:0,offsetColumn:0,fixedColumnsLeft:0,fixedRowsTop:0,rowHeaders:[],columnHeaders:[],totalRows:void 0,totalColumns:void 0,width:null,height:null,cellRenderer:function(t,e,n){var o=i.getSetting("data",t,e);i.instance.wtDom.avoidInnerHTML(n,void 0===o||null===o?"":o)},columnWidth:50,selections:null,onCellMouseDown:null,onCellMouseOver:null,onCellDblClick:null,onCellCornerMouseDown:null,onCellCornerDblClick:null,beforeDraw:null,onDraw:null,scrollbarWidth:10,scrollbarHeight:10},this.settings={};for(var n in this.defaults)if(this.defaults.hasOwnProperty(n))if(void 0!==e[n])this.settings[n]=e[n];else{if(void 0===this.defaults[n])throw Error('A required setting "'+n+'" was not provided');this.settings[n]=this.defaults[n]}}function A(e){this.instance=e,this.TABLE=this.instance.getSetting("table"),this.wtDom=this.instance.wtDom,this.wtDom.removeTextNodes(this.TABLE),this.hasEmptyCellProblem=t.browser.msie&&7>=parseInt(t.browser.version,10),this.hasCellSpacingProblem=t.browser.msie&&7>=parseInt(t.browser.version,10),this.hasCellSpacingProblem&&(this.TABLE.cellSpacing=0);var i=this.TABLE.parentNode;if(!i||1!==i.nodeType||!this.wtDom.hasClass(i,"wtHolder")){var n=document.createElement("DIV");n.className="wtSpreader",i&&i.insertBefore(n,this.TABLE),n.appendChild(this.TABLE)}if(this.spreader=this.TABLE.parentNode,i=this.spreader.parentNode,!i||1!==i.nodeType||!this.wtDom.hasClass(i,"wtHolder")){var o=document.createElement("DIV");o.className="wtHider",i&&i.insertBefore(o,this.spreader),o.appendChild(this.spreader)}if(this.hider=this.spreader.parentNode,this.hiderStyle=this.hider.style,this.hiderStyle.position="relative",i=this.hider.parentNode,!i||1!==i.nodeType||!this.wtDom.hasClass(i,"wtHolder")){var s=document.createElement("DIV");s.style.position="relative",s.className="wtHolder",i&&i.insertBefore(s,this.hider),s.appendChild(this.hider)}if(this.parent=this.hider.parentNode,this.TBODY=this.TABLE.getElementsByTagName("TBODY")[0],this.TBODY||(this.TBODY=document.createElement("TBODY"),this.TABLE.appendChild(this.TBODY)),this.THEAD=this.TABLE.getElementsByTagName("THEAD")[0],this.THEAD||(this.THEAD=document.createElement("THEAD"),this.TABLE.insertBefore(this.THEAD,this.TBODY)),this.COLGROUP=this.TABLE.getElementsByTagName("COLGROUP")[0],this.COLGROUP||(this.COLGROUP=document.createElement("COLGROUP"),this.TABLE.insertBefore(this.COLGROUP,this.THEAD)),this.instance.getSetting("columnHeaders").length&&!this.THEAD.childNodes.length){var r=document.createElement("TR");this.THEAD.appendChild(r)}this.colgroupChildrenLength=this.COLGROUP.childNodes.length,this.theadChildrenLength=this.THEAD.firstChild?this.THEAD.firstChild.childNodes.length:0,this.tbodyChildrenLength=this.TBODY.childNodes.length,this.oldCellCache=new y,this.currentCellCache=new y,this.rowFilter=new k,this.columnFilter=new b,this.verticalRenderReverse=!1}function O(t){this.instance=t,this.resetSettings()}function N(e){"native"!==e.getSetting("scrollbarModelV")&&"native"!==e.getSetting("scrollbarModelH")&&t(e.wtTable.TABLE).on("mousewheel",function(t,i,n,o){o>0&&0===e.getSetting("offsetRow")||0>o&&e.wtTable.isLastRowFullyVisible()||0>n&&0===e.getSetting("offsetColumn")||n>0&&e.wtTable.isLastColumnFullyVisible()||(clearTimeout(e.wheelTimeout),e.wheelTimeout=setTimeout(function(){o?e.wtScrollbars.vertical.visible&&e.scrollVertical(-Math.ceil(o)).draw():n&&e.wtScrollbars.horizontal.visible&&e.scrollHorizontal(Math.ceil(n)).draw()},0),t.preventDefault())})}i.Core=function(n,o){function s(e,i){for(var n=t.Deferred(),o=[],s=function(i){var n=t.Deferred();o.push(n);var s=e[i][3],r="string"==typeof s?s.toLowerCase():null;return function(t){for(var o=!1,a=0,l=t.length;l>a;a++){if(s===t[a]){o=!0;break}if(r===t[a].toLowerCase()){e[i][3]=t[a],o=!0;break}}o||(e[i]=null),n.resolve()}},r=e.length-1;r>=0;r--){var a=f.getCellMeta(e[r][0],c.propToCol(e[r][1]));a.strict&&a.source&&(t.isFunction(a.source)?a.source(e[r][3],s(r)):s(r)(a.source))}return t.when.apply(t,o).then(function(){for(var o=e.length-1;o>=0;o--)if(null===e[o])e.splice(o,1);else{var s=f.getCellMeta(e[o][0],c.propToCol(e[o][1]));"number"===s.dataType&&"string"==typeof e[o][3]&&e[o][3].length>0&&/^-?[\d\s]*\.?\d*$/.test(e[o][3])&&(e[o][3]=numeral().unformat(e[o][3]||"0")),s.validator&&f.validateCell(e[o][3],s,function(t){t===!1&&s.allowInvalid===!1&&(e.splice(o,1),--o,--length)},i)}if(e.length){var r=f.PluginHooks.execute("beforeChange",e,i);"function"==typeof r?t.when(r).then(function(){n.resolve()}):(r===!1&&e.splice(0,e.length),n.resolve())}else n.resolve()}),t.when(n)}function r(t,e){var i=t.length-1;if(!(0>i)){for(;i>=0;i--)if(null!==t[i]){if(l.settings.minSpareRows)for(;t[i][0]>f.countRows()-1;)c.createRow();if("array"===l.dataType&&l.settings.minSpareCols)for(;c.propToCol(t[i][1])>f.countCols()-1;)c.createCol();c.set(t[i][0],t[i][1],t[i][3])}else t.splice(i,1);f.forceFullRender=!0,h.adjustRowsAndCols(),u.refreshBorders(),f.PluginHooks.run("afterChange",t,e||"edit")}}function a(e,i,n){return"object"==typeof e?e:t.isPlainObject(n)?n:[[e,i,n]]}var l,c,h,u,d,p,f=this,m=function(){};i.helper.inherit(m,V),i.helper.extend(m.prototype,o),this.rootElement=n,this.guid="ht_"+i.helper.randomString(),this.rootElement[0].id||(this.rootElement[0].id=this.guid),l={cellSettings:[],columnSettings:[],columnsSettingConflicts:["data","width"],settings:new m,settingsFromDOM:{},selStart:new i.SelectionPoint,selEnd:new i.SelectionPoint,editProxy:!1,isPopulated:null,scrollable:null,undoRedo:null,extensions:{},colToProp:null,propToCol:null,dataSchema:null,dataType:"array",firstRun:!0},c={recursiveDuckSchema:function(e){var i;if(t.isPlainObject(e)){i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=t.isPlainObject(e[n])?c.recursiveDuckSchema(e[n]):null)}else i=[];return i},recursiveDuckColumns:function(e,i,n){var o,s;if(i===void 0&&(i=0,n=""),t.isPlainObject(e))for(s in e)e.hasOwnProperty(s)&&(null===e[s]?(o=n+s,l.colToProp.push(o),l.propToCol[o]=i,i++):i=c.recursiveDuckColumns(e[s],i,s+"."));return i},createMap:function(){if(c.getSchema()===void 0)throw Error("trying to create `columns` definition but you didnt' provide `schema` nor `data`");var t,e,i=c.getSchema();if(l.colToProp=[],l.propToCol={},l.settings.columns)for(t=0,e=l.settings.columns.length;e>t;t++)l.colToProp[t]=l.settings.columns[t].data,l.propToCol[l.settings.columns[t].data]=t;else c.recursiveDuckColumns(i)},colToProp:function(t){return t=i.PluginHooks.execute(f,"modifyCol",t),l.colToProp&&l.colToProp[t]!==void 0?l.colToProp[t]:t},propToCol:function(t){var e;return e=l.propToCol[t]!==void 0?l.propToCol[t]:t,e=i.PluginHooks.execute(f,"modifyCol",e)},getSchema:function(){return l.settings.dataSchema?"function"==typeof l.settings.dataSchema?l.settings.dataSchema():l.settings.dataSchema:l.duckDataSchema},createRow:function(e){var i,n=f.countRows();if(("number"!=typeof e||e>=n)&&(e=n),"array"===l.dataType){i=[];for(var o=0,s=f.countCols();s>o;o++)i.push(null)}else i="function"===l.dataType?l.settings.dataSchema(e):t.extend(!0,{},c.getSchema());e===n?m.prototype.data.push(i):m.prototype.data.splice(e,0,i),f.PluginHooks.run("afterCreateRow",e),f.forceFullRender=!0},createCol:function(t){if("object"===l.dataType||l.settings.columns)throw Error("Cannot create new column. When data source in an object, you can only have as much columns as defined in first data row, data schema or in the 'columns' setting");var e=0,n=f.countRows(),o=m.prototype.data,s=i.helper.columnFactory(m,l.columnsSettingConflicts,i.TextCell);if("number"!=typeof t||t>=f.countCols()){for(;n>e;e++)o[e]===void 0&&(o[e]=[]),o[e].push(null);l.columnSettings.push(s)}else{for(;n>e;e++)o[e].splice(t,0,null);l.columnSettings.splice(t,0,s)}f.PluginHooks.run("afterCreateCol",t),f.forceFullRender=!0},removeRow:function(t,e){e||(e=1),"number"!=typeof t&&(t=-e),m.prototype.data.splice(t,e),f.PluginHooks.run("afterRemoveRow",t,e),f.forceFullRender=!0},removeCol:function(t,e){if("object"===l.dataType||l.settings.columns)throw Error("cannot remove column with object data source or columns option specified");e||(e=1),"number"!=typeof t&&(t=-e);for(var i=m.prototype.data,n=0,o=f.countRows();o>n;n++)i[n].splice(t,e);f.PluginHooks.run("afterRemoveCol",t,e),l.columnSettings.splice(t,e),f.forceFullRender=!0},spliceCol:function(t,e,n){var o=arguments.length>=4?[].slice.call(arguments,3):[],s=f.getDataAtCol(t),r=s.slice(e,e+n),a=s.slice(e+n);i.helper.extendArray(o,a);for(var l=0;n>l;)o.push(null),l++;return i.helper.to2dArray(o),f.populateFromArray(e,t,o,null,null,"spliceCol"),r},spliceRow:function(t,e,n){var o=arguments.length>=4?[].slice.call(arguments,3):[],s=f.getDataAtRow(t),r=s.slice(e,e+n),a=s.slice(e+n);i.helper.extendArray(o,a);for(var l=0;n>l;)o.push(null),l++;
return f.populateFromArray(t,e,[o],null,null,"spliceRow"),r},getVars:{},get:function(t,e){if(c.getVars.row=t,c.getVars.prop=e,f.PluginHooks.run("beforeGet",c.getVars),"string"==typeof c.getVars.prop&&c.getVars.prop.indexOf(".")>-1){var i=c.getVars.prop.split("."),n=l.settings.data[c.getVars.row];if(!n)return null;for(var o=0,s=i.length;s>o;o++)if(n=n[i[o]],n===void 0)return null;return n}return"function"==typeof c.getVars.prop?c.getVars.prop(l.settings.data.slice(c.getVars.row,c.getVars.row+1)[0]):l.settings.data[c.getVars.row]?l.settings.data[c.getVars.row][c.getVars.prop]:null},setVars:{},set:function(t,e,i,n){if(c.setVars.row=t,c.setVars.prop=e,c.setVars.value=i,f.PluginHooks.run("beforeSet",c.setVars,n||"datamapGet"),"string"==typeof c.setVars.prop&&c.setVars.prop.indexOf(".")>-1){for(var o=c.setVars.prop.split("."),s=l.settings.data[c.setVars.row],r=0,a=o.length-1;a>r;r++)s=s[o[r]];s[o[r]]=c.setVars.value}else"function"==typeof c.setVars.prop?c.setVars.prop(l.settings.data.slice(c.setVars.row,c.setVars.row+1)[0],c.setVars.value):l.settings.data[c.setVars.row][c.setVars.prop]=c.setVars.value},clear:function(){for(var t=0;f.countRows()>t;t++)for(var e=0;f.countCols()>e;e++)c.set(t,c.colToProp(e),"")},getAll:function(){return l.settings.data},getRange:function(t,e){var i,n,o,s,r,a=[];for(n=Math.max(t.row,e.row),s=Math.max(t.col,e.col),i=Math.min(t.row,e.row);n>=i;i++){for(r=[],o=Math.min(t.col,e.col);s>=o;o++)r.push(c.get(i,c.colToProp(o)));a.push(r)}return a},getText:function(t,e){return SheetClip.stringify(c.getRange(t,e))}},h={alter:function(e,i,n,o,s){var r,a,d,p,g,m,w,v;switch(r=t.extend(!0,[],c.getAll()),e){case"insert_row":for(n||(n=1),v=0;n>v&&f.countRows()<l.settings.maxRows;)c.createRow(i),v++;v&&(l.selStart.exists()&&l.selStart.row()>=i?(l.selStart.row(l.selStart.row()+v),u.transformEnd(v,0)):u.refreshBorders());break;case"insert_col":for(n||(n=1),v=0;n>v&&f.countCols()<l.settings.maxCols;)c.createCol(i),v++;v&&(l.selStart.exists()&&l.selStart.col()>=i?(l.selStart.col(l.selStart.col()+v),u.transformEnd(0,v)):u.refreshBorders());break;case"remove_row":c.removeRow(i,n),h.adjustRowsAndCols(),u.refreshBorders();break;case"remove_col":c.removeCol(i,n),h.adjustRowsAndCols(),u.refreshBorders();break;default:throw Error('There is no such action "'+e+'"')}for(d=[],a=c.getAll(),p=0,g=a.length;g>p;p++)for(m=0,w=a[p].length;w>m;m++)d.push([p,m,r[p]?r[p][m]:null,a[p][m]]);f.PluginHooks.run("afterChange",d,o||e),s||h.adjustRowsAndCols()},adjustRowsAndCols:function(){var t,e,i,n=f.countEmptyRows(!0);if(e=f.countRows(),l.settings.minRows>e)for(t=0;l.settings.minRows-e>t;t++)c.createRow();if(l.settings.minSpareRows>n)for(;l.settings.minSpareRows>n&&f.countRows()<l.settings.maxRows;n++)c.createRow();if(i=f.countEmptyCols(!0),!l.settings.columns&&f.countCols()<l.settings.minCols)for(;f.countCols()<l.settings.minCols;i++)c.createCol();if(!l.settings.columns&&"array"===l.dataType&&l.settings.minSpareCols>i)for(;l.settings.minSpareCols>i&&f.countCols()<l.settings.maxCols;i++)c.createCol();if(l.settings.enterBeginsEditing)for(;(l.settings.minRows||l.settings.minSpareRows)&&f.countRows()>l.settings.minRows&&l.settings.minSpareRows&&n>l.settings.minSpareRows;n--)c.removeRow();if(l.settings.enterBeginsEditing&&!l.settings.columns)for(;(l.settings.minCols||l.settings.minSpareCols)&&f.countCols()>l.settings.minCols&&l.settings.minSpareCols&&i>l.settings.minSpareCols;i--)c.removeCol();var o=f.countRows(),s=f.countCols();if((0===o||0===s)&&u.deselect(),l.selStart.exists()){var r,a=l.selStart.row(),h=l.selStart.col(),d=l.selEnd.row(),p=l.selEnd.col();a>o-1?(a=o-1,r=!0,d>a&&(d=a)):d>o-1&&(d=o-1,r=!0,a>d&&(a=d)),h>s-1?(h=s-1,r=!0,p>h&&(p=h)):p>s-1&&(p=s-1,r=!0,h>p&&(h=p)),r&&f.selectCell(a,h,d,p)}},populateFromArray:function(t,e,n,o,s){var r,a,c,h,u=[],d={};if(a=e.length,0===a)return!1;var p,g,m,w;switch(s){case"shift_down":for(p=n?n.col-t.col+1:0,g=n?n.row-t.row+1:0,e=i.helper.translateRowsToColumns(e),c=0,h=e.length,m=Math.max(h,p);m>c;c++)if(h>c){for(r=0,a=e[c].length;g-a>r;r++)e[c].push(e[c][r%a]);e[c].unshift(t.col+c,t.row,0),f.spliceCol.apply(f,e[c])}else e[c%h][0]=t.col+c,f.spliceCol.apply(f,e[c%h]);break;case"shift_right":for(p=n?n.col-t.col+1:0,g=n?n.row-t.row+1:0,r=0,a=e.length,w=Math.max(a,g);w>r;r++)if(a>r){for(c=0,h=e[r].length;p-h>c;c++)e[r].push(e[r][c%h]);e[r].unshift(t.row+r,t.col,0),f.spliceRow.apply(f,e[r])}else e[r%a][0]=t.row+r,f.spliceRow.apply(f,e[r%a]);break;case"overwrite":default:for(d.row=t.row,d.col=t.col,r=0;a>r&&!(n&&d.row>n.row||!l.settings.minSpareRows&&d.row>f.countRows()-1||d.row>=l.settings.maxRows);r++){for(d.col=t.col,h=e[r]?e[r].length:0,c=0;h>c&&!(n&&d.col>n.col||!l.settings.minSpareCols&&d.col>f.countCols()-1||d.col>=l.settings.maxCols);c++)f.getCellMeta(d.row,d.col).isWritable&&u.push([d.row,d.col,e[r][c]]),d.col++,n&&c===h-1&&(c=-1);d.row++,n&&r===a-1&&(r=-1)}f.setDataAtCell(u,null,null,o||"populateFromArray")}},getCornerCoords:function(e){function i(e,i,n){function o(t){return t[n]}return Array.prototype.map?e.apply(Math,i.map(o)):e.apply(Math,t.map(i,o))}return{TL:{row:i(Math.min,e,"row"),col:i(Math.min,e,"col")},BR:{row:i(Math.max,e,"row"),col:i(Math.max,e,"col")}}},getCellsAtCoords:function(t,e){var i,n,o=h.getCornerCoords([t,e]),s=[];for(i=o.TL.row;o.BR.row>=i;i++)for(n=o.TL.col;o.BR.col>=n;n++)s.push(f.view.getCellAtCoords({row:i,col:n}));return s}},this.selection=u={inProgress:!1,begin:function(){f.selection.inProgress=!0},finish:function(){var t=f.getSelected();f.PluginHooks.run("afterSelectionEnd",t[0],t[1],t[2],t[3]),f.PluginHooks.run("afterSelectionEndByProp",t[0],f.colToProp(t[1]),t[2],f.colToProp(t[3])),f.selection.inProgress=!1},isInProgress:function(){return f.selection.inProgress},setRangeStart:function(t){l.selStart.coords(t),u.setRangeEnd(t)},setRangeEnd:function(t,e){f.selection.begin(),l.selEnd.coords(t),l.settings.multiSelect||l.selStart.coords(t),f.view.wt.selections.current.clear(),f.view.wt.selections.current.add(l.selStart.arr()),f.view.wt.selections.area.clear(),u.isMultiple()&&(f.view.wt.selections.area.add(l.selStart.arr()),f.view.wt.selections.area.add(l.selEnd.arr())),(l.settings.currentRowClassName||l.settings.currentColClassName)&&(f.view.wt.selections.highlight.clear(),f.view.wt.selections.highlight.add(l.selStart.arr()),f.view.wt.selections.highlight.add(l.selEnd.arr())),f.PluginHooks.run("afterSelection",l.selStart.row(),l.selStart.col(),l.selEnd.row(),l.selEnd.col()),f.PluginHooks.run("afterSelectionByProp",l.selStart.row(),c.colToProp(l.selStart.col()),l.selEnd.row(),c.colToProp(l.selEnd.col())),e!==!1&&(f.view.scrollViewport(t),f.view.wt.draw(!0),f.view.scrollViewport(t)),u.refreshBorders()},refreshBorders:function(t,e){e||d.destroy(t),f.view.render(),u.isSelected()&&!e&&d.prepare()},isMultiple:function(){return!(l.selEnd.col()===l.selStart.col()&&l.selEnd.row()===l.selStart.row())},transformStart:function(t,e,i){l.selStart.row()+t>f.countRows()-1?i&&l.settings.minSpareRows>0?f.alter("insert_row",f.countRows()):l.settings.autoWrapCol&&l.selStart.col()+e<f.countCols()-1&&(t=1-f.countRows(),e=1):l.settings.autoWrapCol&&0>l.selStart.row()+t&&l.selStart.col()+e>=0&&(t=f.countRows()-1,e=-1),l.selStart.col()+e>f.countCols()-1?i&&l.settings.minSpareCols>0?f.alter("insert_col",f.countCols()):l.settings.autoWrapRow&&l.selStart.row()+t<f.countRows()-1&&(t=1,e=1-f.countCols()):l.settings.autoWrapRow&&0>l.selStart.col()+e&&l.selStart.row()+t>=0&&(t=-1,e=f.countCols()-1);var n=f.countRows(),o=f.countCols(),s={row:l.selStart.row()+t,col:l.selStart.col()+e};0>s.row?s.row=0:s.row>0&&s.row>=n&&(s.row=n-1),0>s.col?s.col=0:s.col>0&&s.col>=o&&(s.col=o-1),u.setRangeStart(s)},transformEnd:function(t,e){if(l.selEnd.exists()){var i=f.countRows(),n=f.countCols(),o={row:l.selEnd.row()+t,col:l.selEnd.col()+e};0>o.row?o.row=0:o.row>0&&o.row>=i&&(o.row=i-1),0>o.col?o.col=0:o.col>0&&o.col>=n&&(o.col=n-1),u.setRangeEnd(o)}},isSelected:function(){return l.selEnd.exists()},inInSelection:function(t){if(!u.isSelected())return!1;var e=h.getCornerCoords([l.selStart.coords(),l.selEnd.coords()]);return e.TL.row<=t.row&&e.BR.row>=t.row&&e.TL.col<=t.col&&e.BR.col>=t.col},deselect:function(){u.isSelected()&&(f.selection.inProgress=!1,l.selEnd=new i.SelectionPoint,f.view.wt.selections.current.clear(),f.view.wt.selections.area.clear(),d.destroy(),u.refreshBorders(),f.PluginHooks.run("afterDeselect"))},selectAll:function(){l.settings.multiSelect&&(u.setRangeStart({row:0,col:0}),u.setRangeEnd({row:f.countRows()-1,col:f.countCols()-1},!1))},empty:function(){if(u.isSelected()){var t,e,i=h.getCornerCoords([l.selStart.coords(),l.selEnd.coords()]),n=[];for(t=i.TL.row;i.BR.row>=t;t++)for(e=i.TL.col;i.BR.col>=e;e++)f.getCellMeta(t,e).isWritable&&n.push([t,e,""]);f.setDataAtCell(n)}}},this.autofill=p={handle:null,init:function(){p.handle?p.handle.disabled=!1:p.handle={}},disable:function(){p.handle.disabled=!0},selectAdjacent:function(){var t,e,i,n,o;t=u.isMultiple()?f.view.wt.selections.area.getCorners():f.view.wt.selections.current.getCorners(),e=c.getAll();t:for(i=t[2]+1;f.countRows()>i;i++){for(o=t[1];t[3]>=o;o++)if(e[i][o])break t;(e[i][t[1]-1]||e[i][t[3]+1])&&(n=i)}n&&(f.view.wt.selections.fill.clear(),f.view.wt.selections.fill.add([t[0],t[1]]),f.view.wt.selections.fill.add([n,t[3]]),p.apply())},apply:function(){var t,e,i,n,o;p.handle.isDragged=0,t=f.view.wt.selections.fill.getCorners(),t&&(f.view.wt.selections.fill.clear(),e=u.isMultiple()?f.view.wt.selections.area.getCorners():f.view.wt.selections.current.getCorners(),t[0]===e[0]&&t[1]<e[1]?(i={row:t[0],col:t[1]},n={row:t[2],col:e[1]-1}):t[0]===e[0]&&t[3]>e[3]?(i={row:t[0],col:e[3]+1},n={row:t[2],col:t[3]}):t[0]<e[0]&&t[1]===e[1]?(i={row:t[0],col:t[1]},n={row:e[0]-1,col:t[3]}):t[2]>e[2]&&t[1]===e[1]&&(i={row:e[2]+1,col:t[1]},n={row:t[2],col:t[3]}),i&&(o=SheetClip.parse(c.getText(l.selStart.coords(),l.selEnd.coords())),f.PluginHooks.run("beforeAutofill",i,n,o),h.populateFromArray(i,o,n,"autofill"),u.setRangeStart({row:t[0],col:t[1]}),u.setRangeEnd({row:t[2],col:t[3]})))},showBorder:function(t){t.row=t[0],t.col=t[1];var e=h.getCornerCoords([l.selStart.coords(),l.selEnd.coords()]);if("horizontal"!==l.settings.fillHandle&&(e.BR.row<t.row||e.TL.row>t.row))t=[t.row,e.BR.col];else{if("vertical"===l.settings.fillHandle)return;t=[e.BR.row,t.col]}f.view.wt.selections.fill.clear(),f.view.wt.selections.fill.add([l.selStart.coords().row,l.selStart.coords().col]),f.view.wt.selections.fill.add([l.selEnd.coords().row,l.selEnd.coords().col]),f.view.wt.selections.fill.add(t),f.view.render()}},d={init:function(){function e(){u.empty()}function n(t){var e=t.replace(/^[\r\n]*/g,"").replace(/[\r\n]*$/g,""),i=SheetClip.parse(e),n=h.getCornerCoords([l.selStart.coords(),l.selEnd.coords()]),o=n.TL,s={row:Math.max(n.BR.row,i.length-1+n.TL.row),col:Math.max(n.BR.col,i[0].length-1+n.TL.col)};f.PluginHooks.once("afterChange",function(t){t&&t.length&&f.selectCell(o.row,o.col,s.row,s.col)}),h.populateFromArray(o,i,s,"paste",l.settings.pasteMode)}function o(t){if(l.settings.beforeOnKeyDown&&l.settings.beforeOnKeyDown.call(f,t),!s.children(".context-menu-list:visible").length){if(17===t.keyCode||224===t.keyCode||91===t.keyCode||93===t.keyCode)return d.setCopyableText(),void 0;if(l.lastKeyCode=t.keyCode,u.isSelected()){var e=(t.ctrlKey||t.metaKey)&&!t.altKey;if(i.helper.isPrintableChar(t.keyCode)&&e)return 65===t.keyCode?(u.selectAll(),d.setCopyableText(),t.preventDefault()):89===t.keyCode||t.shiftKey&&90===t.keyCode?l.undoRedo&&l.undoRedo.redo():90===t.keyCode&&l.undoRedo&&l.undoRedo.undo(),void 0;var n=t.shiftKey?u.setRangeEnd:u.setRangeStart;if(f.PluginHooks.run("beforeKeyDown",t),!t.isImmediatePropagationStopped())switch(t.keyCode){case 38:t.shiftKey?u.transformEnd(-1,0):u.transformStart(-1,0),t.preventDefault(),t.stopPropagation();break;case 9:var o="function"==typeof l.settings.tabMoves?l.settings.tabMoves(t):l.settings.tabMoves;t.shiftKey?u.transformStart(-o.row,-o.col):u.transformStart(o.row,o.col,!0),t.preventDefault(),t.stopPropagation();break;case 39:t.shiftKey?u.transformEnd(0,1):u.transformStart(0,1),t.preventDefault(),t.stopPropagation();break;case 37:t.shiftKey?u.transformEnd(0,-1):u.transformStart(0,-1),t.preventDefault(),t.stopPropagation();break;case 8:case 46:u.empty(t),t.preventDefault();break;case 40:t.shiftKey?u.transformEnd(1,0):u.transformStart(1,0),t.preventDefault(),t.stopPropagation();break;case 113:t.preventDefault();break;case 13:var r="function"==typeof l.settings.enterMoves?l.settings.enterMoves(t):l.settings.enterMoves;t.shiftKey?u.transformStart(-r.row,-r.col):u.transformStart(r.row,r.col,!0),t.preventDefault();break;case 36:t.ctrlKey||t.metaKey?n({row:0,col:l.selStart.col()}):n({row:l.selStart.row(),col:0}),t.preventDefault(),t.stopPropagation();break;case 35:t.ctrlKey||t.metaKey?n({row:f.countRows()-1,col:l.selStart.col()}):n({row:l.selStart.row(),col:f.countCols()-1}),t.preventDefault(),t.stopPropagation();break;case 33:u.transformStart(-f.countVisibleRows(),0),f.view.wt.scrollVertical(-f.countVisibleRows()),f.view.render(),t.preventDefault(),t.stopPropagation();break;case 34:u.transformStart(f.countVisibleRows(),0),f.view.wt.scrollVertical(f.countVisibleRows()),f.view.render(),t.preventDefault(),t.stopPropagation();break;default:}}}}var s=t(document.body);f.copyPaste=new g(f.rootElement[0]),f.copyPaste.onCut(e),f.copyPaste.onPaste(n),f.rootElement.on("keydown.handsontable."+f.guid,o)},destroy:function(t){if("function"==typeof l.editorDestroyer){var e=l.editorDestroyer;l.editorDestroyer=null,e(t)}},setCopyableText:function(){var t=Math.min(l.selStart.row(),l.selEnd.row()),e=Math.min(l.selStart.col(),l.selEnd.col()),i=Math.max(l.selStart.row(),l.selEnd.row()),n=Math.max(l.selStart.col(),l.selEnd.col()),o=Math.min(i,t+l.settings.copyRowsLimit-1),s=Math.min(n,e+l.settings.copyColsLimit-1);f.copyPaste.copyable(c.getText({row:t,col:e},{row:o,col:s})),(i!==o||n!==s)&&f.PluginHooks.run("afterCopyLimit",i-t+1,n-e+1,l.settings.copyRowsLimit,l.settings.copyColsLimit)},prepare:function(){if(f.getCellMeta(l.selStart.row(),l.selStart.col()).isWritable){f.listen();var t=f.view.getCellAtCoords(l.selStart.coords());l.editorDestroyer=f.view.applyCellTypeMethod("editor",t,l.selStart.row(),l.selStart.col())}}},this.init=function(){f.PluginHooks.run("beforeInit"),d.init(),this.updateSettings(l.settings,!0),this.parseSettingsFromDOM(),this.focusCatcher=new i.FocusCatcher(this),this.view=new i.TableView(this),this.forceFullRender=!0,this.view.render(),"object"==typeof l.firstRun&&(f.PluginHooks.run("afterChange",l.firstRun[0],l.firstRun[1]),l.firstRun=!1),f.PluginHooks.run("afterInit")},this.validateCell=function(t,e,i,n){var o=e.validator;"[object RegExp]"===Object.prototype.toString.call(o)&&(o=function(t){return function(e,i){i(t.test(e))}}(o)),"function"==typeof o&&(t=f.PluginHooks.execute("beforeValidate",t,e.row,e.prop,n),o.call(e,t,function(o){e.allowInvalid&&(e.valid=o),o=f.PluginHooks.execute("afterValidate",o,t,e.row,e.prop,n),i(o)}))},this.setDataAtCell=function(t,e,i,n){var o,l,h,u=a(t,e,i),d=[];for(o=0,l=u.length;l>o;o++){if("object"!=typeof u[o])throw Error("Method `setDataAtCell` accepts row number or changes array of arrays as its first parameter");if("number"!=typeof u[o][1])throw Error("Method `setDataAtCell` accepts row and column number as its parameters. If you want to use object property name, use method `setDataAtRowProp`");h=c.colToProp(u[o][1]),d.push([u[o][0],h,c.get(u[o][0],h),u[o][2]])}n||"object"!=typeof t||(n=e),s(d,n).then(function(){r(d,n)})},this.setDataAtRowProp=function(t,e,i,n){var o,l,h=a(t,e,i),u=[];for(o=0,l=h.length;l>o;o++)u.push([h[o][0],h[o][1],c.get(h[o][0],h[o][1]),h[o][2]]);n||"object"!=typeof t||(n=e),s(u,n).then(function(){r(u,n)})},this.listen=function(){f.focusCatcher.listen()},this.destroyEditor=function(t){u.refreshBorders(t)},this.populateFromArray=function(t,e,i,n,o,s,r){if("object"!=typeof i)throw Error("populateFromArray parameter `input` must be an array");return h.populateFromArray({row:t,col:e},i,"number"==typeof n?{row:n,col:o}:null,s,r)},this.spliceCol=function(){return c.spliceCol.apply(null,arguments)},this.spliceRow=function(){return c.spliceRow.apply(null,arguments)},this.getCornerCoords=function(t){return h.getCornerCoords(t)},this.getSelected=function(){return u.isSelected()?[l.selStart.row(),l.selStart.col(),l.selEnd.row(),l.selEnd.col()]:void 0},this.parseSettingsFromDOM=function(){var t=this.rootElement.css("overflow");if("scroll"===t||"auto"===t?(this.rootElement[0].style.overflow="visible",l.settingsFromDOM.overflow=t):(void 0===l.settings.width||void 0===l.settings.height)&&(l.settingsFromDOM.overflow="auto"),l.settingsFromDOM.width=void 0===l.settings.width?this.rootElement.width():void 0,l.settingsFromDOM.height=void 0,void 0===l.settings.height&&("scroll"===l.settingsFromDOM.overflow||"auto"===l.settingsFromDOM.overflow)){var i=this.rootElement[0].cloneNode(!1),n=this.rootElement[0].parentNode;if(n){i.removeAttribute("id"),n.appendChild(i);var o=parseInt(e.getComputedStyle(i,null).getPropertyValue("height"),10);o>0&&(l.settingsFromDOM.height=o),n.removeChild(i)}}},this.render=function(){f.view&&(l.cellSettings.length=0,f.forceFullRender=!0,f.parseSettingsFromDOM(),u.refreshBorders(null,!0))},this.loadData=function(e){if(!e.push||!e.splice)throw Error("loadData only accepts array of objects or array of arrays ("+typeof e+" given)");l.isPopulated=!1,m.prototype.data=e,l.dataType=l.settings.dataSchema instanceof Array||e[0]instanceof Array?"array":t.isFunction(l.settings.dataSchema)?"function":"object",l.duckDataSchema=e[0]?c.recursiveDuckSchema(e[0]):{},c.createMap(),h.adjustRowsAndCols(),f.PluginHooks.run("afterLoadData"),l.firstRun?l.firstRun=[null,"loadData"]:(f.PluginHooks.run("afterChange",null,"loadData"),f.render()),l.isPopulated=!0,f.clearUndo()},this.getData=function(t,e,i,n){return t===void 0?c.getAll():c.getRange({row:t,col:e},{row:i,col:n})},this.updateSettings=function(t,e){var n,o,s,r,a;if(t.rows!==void 0)throw Error("'rows' setting is no longer supported. do you mean startRows, minRows or maxRows?");if(t.cols!==void 0)throw Error("'cols' setting is no longer supported. do you mean startCols, minCols or maxCols?");t.undo!==void 0&&(l.undoRedo&&t.undo===!1?l.undoRedo=null:l.undoRedo||t.undo!==!0||(l.undoRedo=new i.UndoRedo(f)));for(n in t)"data"!==n&&(void 0!==f.PluginHooks.hooks.persistent[n]||void 0!==f.PluginHooks.legacy[n]?f.PluginHooks.add(n,t[n]):(!e&&t.hasOwnProperty(n)&&(m.prototype[n]=t[n]),i.extension[n]&&(l.extensions[n]=new i.extension[n](f,t[n]))));if(void 0===t.data&&void 0===l.settings.data){var d,g=[];for(o=0,s=l.settings.startRows;s>o;o++){for(d=[],r=0,a=l.settings.startCols;a>r;r++)d.push(null);g.push(d)}f.loadData(g)}else void 0!==t.data?f.loadData(t.data):void 0!==t.columns&&c.createMap();if(a=f.countCols(),a>0){var w,v,y;for(n=0;a>n;n++)if(l.columnSettings[n]=i.helper.columnFactory(m,l.columnsSettingConflicts,i.TextCell),v=l.columnSettings[n].prototype,m.prototype.columns){y=m.prototype.columns[n];for(w in y)y.hasOwnProperty(w)&&(v[w]=y[w])}}t.fillHandle!==void 0&&(p.handle&&t.fillHandle===!1?p.disable():p.handle||t.fillHandle===!1||p.init()),h.adjustRowsAndCols(),f.view&&(f.forceFullRender=!0,u.refreshBorders(null,!0))},this.getSettings=function(){return l.settings},this.getSettingsFromDOM=function(){return l.settingsFromDOM},this.clear=function(){u.selectAll(),u.empty()},this.isUndoAvailable=function(){return l.undoRedo&&l.undoRedo.isUndoAvailable()},this.isRedoAvailable=function(){return l.undoRedo&&l.undoRedo.isRedoAvailable()},this.undo=function(){l.undoRedo&&l.undoRedo.undo()},this.redo=function(){l.undoRedo&&l.undoRedo.redo()},this.clearUndo=function(){l.undoRedo&&l.undoRedo.clear()},this.alter=function(t,e,i,n,o){h.alter(t,e,i,n,o)},this.getCell=function(t,e){return f.view.getCellAtCoords({row:t,col:e})},this.colToProp=function(t){return c.colToProp(t)},this.propToCol=function(t){return c.propToCol(t)},this.getDataAtCell=function(t,e){return c.get(t,c.colToProp(e))},this.getDataAtRowProp=function(t,e){return c.get(t,e)},this.getDataAtCol=function(t){return[].concat.apply([],c.getRange({row:0,col:t},{row:l.settings.data.length-1,col:t}))},this.getDataAtProp=function(t){return[].concat.apply([],c.getRange({row:0,col:c.propToCol(t)},{row:l.settings.data.length-1,col:c.propToCol(t)}))},this.getDataAtRow=function(t){return l.settings.data[t]},this.getCellMeta=function(t,e){var n,o,s,r=c.colToProp(e);if(e=i.PluginHooks.execute(f,"modifyCol",e),l.columnSettings[e]===void 0&&(l.columnSettings[e]=i.helper.columnFactory(m,l.columnsSettingConflicts,i.TextCell)),l.cellSettings[t]||(l.cellSettings[t]={}),l.cellSettings[t][e]||(l.cellSettings[t][e]=new l.columnSettings[e]),n=l.cellSettings[t][e],n.row=t,n.col=e,n.prop=r,n.instance=f,n.cells){var a,h=n.cells.call(n,t,e,r)||{};for(a in h)h.hasOwnProperty(a)&&(n[a]=h[a])}if(n.isWritable=!n.readOnly,f.PluginHooks.run("beforeGetCellMeta",t,e,n),"string"==typeof n.type&&"text"!==n.type){if(o=i.cellTypes[n.type],void 0===o)throw Error('You declared cell type "'+n.type+'" as a string that is not mapped to a known object. Cell type must be an object or a string mapped to an object in Handsontable.cellTypes')}else"object"==typeof n.type&&(o=n.type);if(o)for(s in o)o.hasOwnProperty(s)&&n[s]===i.cellTypes.text[s]&&(n[s]=o[s]);return n.validator&&void 0===n.valid&&f.validateCell(f.getDataAtCell(t,e),n,function(){},"getCellMeta"),f.PluginHooks.run("afterGetCellMeta",t,e,n),n},this.getRowHeader=function(t){if(void 0===t){for(var e=[],i=0,n=f.countRows();n>i;i++)e.push(f.getRowHeader(i));return e}return"[object Array]"===Object.prototype.toString.call(l.settings.rowHeaders)&&void 0!==l.settings.rowHeaders[t]?l.settings.rowHeaders[t]:"function"==typeof l.settings.rowHeaders?l.settings.rowHeaders(t):l.settings.rowHeaders&&"string"!=typeof l.settings.rowHeaders&&"number"!=typeof l.settings.rowHeaders?t+1:l.settings.rowHeaders},this.getColHeader=function(t){if(void 0===t){for(var e=[],n=0,o=f.countCols();o>n;n++)e.push(f.getColHeader(n));return e}return t=i.PluginHooks.execute(f,"modifyCol",t),l.settings.columns&&l.settings.columns[t]&&l.settings.columns[t].title?l.settings.columns[t].title:"[object Array]"===Object.prototype.toString.call(l.settings.colHeaders)&&void 0!==l.settings.colHeaders[t]?l.settings.colHeaders[t]:"function"==typeof l.settings.colHeaders?l.settings.colHeaders(t):l.settings.colHeaders&&"string"!=typeof l.settings.colHeaders&&"number"!=typeof l.settings.colHeaders?i.helper.spreadsheetColumnLabel(t):l.settings.colHeaders},this.getColWidth=function(t){t=i.PluginHooks.execute(f,"modifyCol",t);var e={};return e.width=l.settings.columns&&l.settings.columns[t]&&l.settings.columns[t].width?l.settings.columns[t].width:"[object Array]"===Object.prototype.toString.call(l.settings.colWidths)&&void 0!==l.settings.colWidths[t]?l.settings.colWidths[t]:50,f.PluginHooks.run("afterGetColWidth",t,e),e.width},this.countRows=function(){return l.settings.data.length},this.countCols=function(){return"object"===l.dataType||"function"===l.dataType?l.settings.columns&&l.settings.columns.length?l.settings.columns.length:l.colToProp.length:"array"===l.dataType?l.settings.columns&&l.settings.columns.length?l.settings.columns.length:l.settings.data&&l.settings.data[0]&&l.settings.data[0].length?l.settings.data[0].length:0:void 0},this.rowOffset=function(){return f.view.wt.getSetting("offsetRow")},this.colOffset=function(){return f.view.wt.getSetting("offsetColumn")},this.countVisibleRows=function(){return f.view.wt.drawn?f.view.wt.wtTable.rowStrategy.countVisible():-1},this.countVisibleCols=function(){return f.view.wt.drawn?f.view.wt.wtTable.columnStrategy.countVisible():-1},this.countEmptyRows=function(t){for(var e=f.countRows()-1,i=0;e>=0;){if(f.isEmptyRow(e))i++;else if(t)break;e--}return i},this.countEmptyCols=function(t){if(1>f.countRows())return 0;for(var e=f.countCols()-1,i=0;e>=0;){if(f.isEmptyCol(e))i++;else if(t)break;e--}return i},this.isEmptyRow=function(t){if(l.settings.isEmptyRow)return l.settings.isEmptyRow.call(this,t);for(var e,i=0,n=this.countCols();n>i;i++)if(e=this.getDataAtCell(t,i),""!==e&&null!==e&&e!==void 0)return!1;return!0},this.isEmptyCol=function(t){if(l.settings.isEmptyCol)return l.settings.isEmptyCol.call(this,t);for(var e,i=0,n=this.countRows();n>i;i++)if(e=this.getDataAtCell(i,t),""!==e&&null!==e&&e!==void 0)return!1;return!0},this.selectCell=function(t,e,i,n,o){if("number"!=typeof t||0>t||t>=f.countRows())return!1;if("number"!=typeof e||0>e||e>=f.countCols())return!1;if(i!==void 0){if("number"!=typeof i||0>i||i>=f.countRows())return!1;if("number"!=typeof n||0>n||n>=f.countCols())return!1}return l.selStart.coords({row:t,col:e}),f.listen(),i===void 0?u.setRangeEnd({row:t,col:e},o):u.setRangeEnd({row:i,col:n},o),f.selection.finish(),!0},this.selectCellByProp=function(){return arguments[1]=c.propToCol(arguments[1]),arguments[3]!==void 0&&(arguments[3]=c.propToCol(arguments[3])),f.selectCell.apply(f,arguments)},this.deselectCell=function(){u.deselect()},this.destroy=function(){f.clearTimeouts(),f.view&&f.view.wt.destroy(),f.rootElement.empty(),f.rootElement.removeData("handsontable"),f.rootElement.off(".handsontable"),t(e).off("."+f.guid),t(document.documentElement).off("."+f.guid),f.PluginHooks.run("afterDestroy")},this.getInstance=function(){return f.rootElement.data("handsontable")},function(){f.PluginHooks=new i.PluginHookClass;var t=f.PluginHooks.run,e=f.PluginHooks.execute;f.PluginHooks.run=function(e,n,o,s,r,a){t.call(this,f,e,n,o,s,r,a),i.PluginHooks.run(f,e,n,o,s,r,a)},f.PluginHooks.execute=function(t,n,o,s,r,a){return n=e.call(this,f,t,n,o,s,r,a),n=i.PluginHooks.execute(f,t,n,o,s,r,a)},f.addHook=f.PluginHooks.add,f.addHookOnce=f.PluginHooks.once,f.removeHook=f.PluginHooks.remove,f.runHooks=f.PluginHooks.run,f.runHooksAndReturn=f.PluginHooks.execute}(),this.timeouts={},this.registerTimeout=function(t,e,i){clearTimeout(this.timeouts[t]),this.timeouts[t]=setTimeout(e,i||0)},this.clearTimeouts=function(){for(var t in this.timeouts)this.timeouts.hasOwnProperty(t)&&clearTimeout(this.timeouts[t])},this.version="0.9.5"};var V=function(){};V.prototype={data:void 0,width:void 0,height:void 0,startRows:5,startCols:5,minRows:0,minCols:0,maxRows:1/0,maxCols:1/0,minSpareRows:0,minSpareCols:0,multiSelect:!0,fillHandle:!0,undo:!0,outsideClickDeselects:!0,enterBeginsEditing:!0,enterMoves:{row:1,col:0},tabMoves:{row:0,col:1},autoWrapRow:!1,autoWrapCol:!1,copyRowsLimit:1e3,copyColsLimit:1e3,pasteMode:"overwrite",currentRowClassName:void 0,currentColClassName:void 0,stretchH:"hybrid",isEmptyRow:void 0,isEmptyCol:void 0,observeDOMVisibility:!0,allowInvalid:!0,invalidCellClassName:"htInvalid"},t.fn.handsontable=function(t){var e,n,o,s,r,a=this.first(),l=a.data("handsontable");if("string"!=typeof t)return r=t||{},l?l.updateSettings(r):(l=new i.Core(a,r),a.data("handsontable",l),l.init()),a;if(o=[],arguments.length>1)for(e=1,n=arguments.length;n>e;e++)o.push(arguments[e]);if(l){if(void 0===l[t])throw Error("Handsontable do not provide action: "+t);s=l[t].apply(l,o)}return s},i.FocusCatcher=function(e){this.el=document.createElement("DIV"),this.el.style.position="fixed",this.el.style.top="0",this.el.style.left="0",this.el.style.width="1px",this.el.style.height="1px",this.el.setAttribute("tabindex",1e4),e.rootElement.append(this.el),this.$el=t(this.el)},i.FocusCatcher.prototype.listen=function(){this.el.focus()},i.TableView=function(i){var n=this,o=t(e),s=t(document.documentElement);this.instance=i,this.settings=i.getSettings(),this.settingsFromDOM=i.getSettingsFromDOM(),i.rootElement.data("originalStyle",i.rootElement.attr("style")),i.rootElement.addClass("handsontable");var r=document.createElement("TABLE");r.className="htCore",r.appendChild(document.createElement("THEAD")),r.appendChild(document.createElement("TBODY")),i.$table=t(r),i.rootElement.prepend(i.$table),s.on("keyup."+i.guid,function(t){i.selection.isInProgress()&&!t.shiftKey&&i.selection.finish()});var a,l;s.on("mouseup."+i.guid,function(t){i.selection.isInProgress()&&1===t.which&&i.selection.finish(),a=!1,clearInterval(l),l=null,i.autofill.handle&&i.autofill.handle.isDragged&&(i.autofill.handle.isDragged>1&&i.autofill.apply(),i.autofill.handle.isDragged=0)}),s.on("mousedown."+i.guid,function(e){var o=e.target;if(o!==n.wt.wtTable.spreader)for(;o!==document.documentElement;){if(null===o)return;if(o===i.rootElement[0]||"X-HANDSONTABLE"===o.nodeName||"context-menu-layer"===o.id||t(o).is(".context-menu-list")||t(o).is(".typeahead li"))return;o=o.parentNode}n.settings.outsideClickDeselects?i.deselectCell():i.destroyEditor()}),i.$table.on("selectstart",function(t){t.preventDefault()}),i.$table.on("mouseenter",function(){l&&(clearInterval(l),l=null)}),i.$table.on("mouseleave",function(t){if(a||i.autofill.handle&&i.autofill.handle.isDragged){var e,o,s=1,c=n.wt.wtDom.offset(r),h=c.top+s,u=c.left+s,d=n.containerWidth-n.wt.getSetting("scrollbarWidth")-2*s,p=n.containerHeight-n.wt.getSetting("scrollbarHeight")-2*s,f=0,g=0;h>t.pageY?(f=-1,e="scrollVertical"):t.pageY>=h+p?(f=1,e="scrollVertical"):u>t.pageX?(g=-1,e="scrollHorizontal"):t.pageX>=u+d&&(g=1,e="scrollHorizontal"),e&&(o=function(){(a||i.autofill.handle&&i.autofill.handle.isDragged)&&n.wt[e](f+g).draw()},o(),l=setInterval(o,100))}});var c=function(){e.getSelection?e.getSelection().empty?e.getSelection().empty():e.getSelection().removeAllRanges&&e.getSelection().removeAllRanges():document.selection&&document.selection.empty()},h={table:r,stretchH:this.settings.stretchH,data:i.getDataAtCell,totalRows:i.countRows,totalColumns:i.countCols,scrollbarModelV:this.settings.scrollbarModelV,scrollbarModelH:this.settings.scrollbarModelH,offsetRow:0,offsetColumn:0,width:this.getWidth(),height:this.getHeight(),fixedColumnsLeft:this.settings.fixedColumnsLeft,fixedRowsTop:this.settings.fixedRowsTop,rowHeaders:this.settings.rowHeaders?[function(t,e){n.appendRowHeader(t,e)}]:[],columnHeaders:this.settings.colHeaders?[function(t,e){n.appendColHeader(t,e)}]:[],columnWidth:i.getColWidth,cellRenderer:function(t,e,i){n.applyCellTypeMethod("renderer",i,t,e)},selections:{current:{className:"current",border:{width:2,color:"#5292F7",style:"solid",cornerVisible:function(){return n.settings.fillHandle&&!n.isCellEdited()&&!i.selection.isMultiple()}}},area:{className:"area",border:{width:1,color:"#89AFF9",style:"solid",cornerVisible:function(){return n.settings.fillHandle&&!n.isCellEdited()&&i.selection.isMultiple()}}},highlight:{highlightRowClassName:n.settings.currentRowClassName,highlightColumnClassName:n.settings.currentColClassName},fill:{className:"fill",border:{width:1,color:"red",style:"solid"}}},onCellMouseDown:function(t,e,o){a=!0;var s={row:e[0],col:e[1]};2===t.button&&i.selection.inInSelection(s)||(t.shiftKey?i.selection.setRangeEnd(s):i.selection.setRangeStart(s)),t.preventDefault(),c(),n.settings.afterOnCellMouseDown&&n.settings.afterOnCellMouseDown.call(i,t,e,o),setTimeout(function(){i.listen()})},onCellMouseOver:function(t,e){var n={row:e[0],col:e[1]};a?i.selection.setRangeEnd(n):i.autofill.handle&&i.autofill.handle.isDragged&&(i.autofill.handle.isDragged++,i.autofill.showBorder(e))},onCellCornerMouseDown:function(t){i.autofill.handle.isDragged=1,t.preventDefault()},onCellCornerDblClick:function(){i.autofill.selectAdjacent()},beforeDraw:function(t){n.beforeRender(t)}};i.PluginHooks.run("beforeInitWalkontable",h),this.wt=new S(h),o.on("resize."+i.guid,function(){i.registerTimeout("resizeTimeout",function(){i.parseSettingsFromDOM();var t=n.getWidth(),e=n.getHeight();(h.width!==t||h.height!==e)&&(i.forceFullRender=!0,n.render(),h.width=t,h.height=e)},60)}),t(n.wt.wtTable.spreader).on("mousedown.handsontable, contextmenu.handsontable",function(t){t.target===n.wt.wtTable.spreader&&3===t.which&&t.stopPropagation()}),s.on("click."+i.guid,function(){n.settings.observeDOMVisibility&&n.wt.drawInterrupted&&(n.instance.forceFullRender=!0,n.render())})},i.TableView.prototype.isCellEdited=function(){return this.instance.textEditor&&this.instance.textEditor.isCellEdited||this.instance.autocompleteEditor&&this.instance.autocompleteEditor.isCellEdited||this.instance.handsontableEditor&&this.instance.handsontableEditor.isCellEdited
},i.TableView.prototype.getWidth=function(){var t=void 0!==this.settings.width?this.settings.width:this.settingsFromDOM.width;return"function"==typeof t?t():t},i.TableView.prototype.getHeight=function(){var t=void 0!==this.settings.height?this.settings.height:this.settingsFromDOM.height;return"function"==typeof t?t():t},i.TableView.prototype.beforeRender=function(t){t&&(this.instance.PluginHooks.run("beforeRender"),this.wt.update("width",this.getWidth()),this.wt.update("height",this.getHeight()))},i.TableView.prototype.render=function(){this.wt.draw(!this.instance.forceFullRender),this.instance.rootElement.triggerHandler("render.handsontable"),this.instance.forceFullRender&&this.instance.PluginHooks.run("afterRender"),this.instance.forceFullRender=!1},i.TableView.prototype.applyCellTypeMethod=function(t,e,n,o){var s=this.instance.colToProp(o),r=this.instance.getCellMeta(n,o),a=i.helper.getCellMethod(t,r[t]);return a(this.instance,e,n,o,s,this.instance.getDataAtRowProp(n,s),r)},i.TableView.prototype.getCellAtCoords=function(t){var e=this.wt.wtTable.getCell([t.row,t.col]);return 0>e?null:e},i.TableView.prototype.scrollViewport=function(t){this.wt.scrollViewport([t.row,t.col])},i.TableView.prototype.appendRowHeader=function(t,e){t>-1?this.wt.wtDom.avoidInnerHTML(e,this.instance.getRowHeader(t)):this.wt.wtDom.empty(e)},i.TableView.prototype.appendColHeader=function(t,e){var i=document.createElement("DIV"),n=document.createElement("SPAN");for(i.className="relative",n.className="colHeader",this.wt.wtDom.avoidInnerHTML(n,this.instance.getColHeader(t)),i.appendChild(n);e.firstChild;)e.removeChild(e.firstChild);e.appendChild(i),this.instance.PluginHooks.run("afterGetColHeader",t,e)},i.helper.isPrintableChar=function(t){return 32==t||t>=48&&57>=t||t>=96&&111>=t||t>=186&&192>=t||t>=219&&222>=t||t>=226||t>=65&&90>=t},i.helper.stringify=function(t){switch(typeof t){case"string":case"number":return t+"";case"object":return null===t?"":""+t;case"undefined":return"";default:return""+t}},i.helper.spreadsheetColumnLabel=function(t){for(var e,i=t+1,n="";i>0;)e=(i-1)%26,n=String.fromCharCode(65+e)+n,i=parseInt((i-e)/26,10);return n},i.helper.isNumeric=function(t){var e=typeof t;return"number"==e?!isNaN(t)&&isFinite(t):"string"==e?t.length?1==t.length?/\d/.test(t):/^\s*[+-]?\s*(?:(?:\d+(?:\.\d+)?(?:e[+-]?\d+)?)|(?:0x[a-f\d]+))\s*$/i.test(t):!1:"object"==e?!(!t||"number"!=typeof t.valueOf()||t instanceof Date):!1},i.helper.isDescendant=function(t,e){for(var i=e.parentNode;null!=i;){if(i==t)return!0;i=i.parentNode}return!1},i.helper.randomString=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+t()+t()},i.helper.inherit=function(t,e){function i(){}return i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t},i.helper.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},i.helper.columnFactory=function(t,e,i){var n=0,o=e.length,s=function(){};for(s.prototype=new t;o>n;n++)s.prototype[e[n]]=void 0;for(n in i)i.hasOwnProperty(n)&&(s.prototype[n]=i[n]);return s},i.helper.translateRowsToColumns=function(t){var e,i,n,o,s=[],r=0;for(e=0,i=t.length;i>e;e++)for(n=0,o=t[e].length;o>n;n++)n==r&&(s.push([]),r++),s[n].push(t[e][n]);return s},i.helper.to2dArray=function(t){for(var e=0,i=t.length;i>e;)t[e]=[t[e]],e++},i.helper.extendArray=function(t,e){for(var i=0,n=e.length;n>i;)t.push(e[i]),i++},i.helper.getCellMethod=function(t,e){if("string"==typeof e){var n=i.cellLookup[t][e];if(void 0===n)throw Error("You declared cell "+t+' "'+e+'" as a string that is not mapped to a known function. Cell '+t+" must be a function or a string mapped to a function in Handsontable.cellLookup."+t+" lookup object");return n}return e},i.UndoRedo=function(t){var e=this;this.instance=t,this.clear(),i.PluginHooks.add("afterChange",function(t,i){"undo"!==i&&"redo"!==i&&e.add(t,i)})},i.UndoRedo.prototype.undo=function(){var e,i;if(this.isUndoAvailable()){var n=t.extend(!0,[],this.data[this.rev]);for(e=0,i=n.length;i>e;e++)n[e].splice(3,1);this.instance.setDataAtRowProp(n,null,null,"undo"),this.rev--}},i.UndoRedo.prototype.redo=function(){var e,i;if(this.isRedoAvailable()){this.rev++;var n=t.extend(!0,[],this.data[this.rev]);for(e=0,i=n.length;i>e;e++)n[e].splice(2,1);this.instance.setDataAtRowProp(n,null,null,"redo")}},i.UndoRedo.prototype.isUndoAvailable=function(){return this.rev>=0},i.UndoRedo.prototype.isRedoAvailable=function(){return this.rev<this.data.length-1},i.UndoRedo.prototype.add=function(t){this.rev++,this.data.splice(this.rev),this.data.push(t)},i.UndoRedo.prototype.clear=function(){this.data=[],this.rev=-1},i.SelectionPoint=function(){this._row=null,this._col=null},i.SelectionPoint.prototype.exists=function(){return null!==this._row},i.SelectionPoint.prototype.row=function(t){return void 0!==t&&(this._row=t),this._row},i.SelectionPoint.prototype.col=function(t){return void 0!==t&&(this._col=t),this._col},i.SelectionPoint.prototype.coords=function(t){return void 0!==t&&(this._row=t.row,this._col=t.col),{row:this._row,col:this._col}},i.SelectionPoint.prototype.arr=function(t){return void 0!==t&&(this._row=t[0],this._col=t[1]),[this._row,this._col]},i.TextRenderer=function(t,e,n,o,s,r,a){var l=i.helper.stringify(r);l.match(/\n/)?(l=l.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),e.innerHTML=l.replace(/\n/g,"<br/>")):(t.view.wt.wtDom.empty(e),e.appendChild(document.createTextNode(l))),a.readOnly&&t.view.wt.wtDom.addClass(e,"htDimmed"),a.valid===!1&&a.invalidCellClassName&&(e.className=a.invalidCellClassName)};var L=document.createElement("DIV");L.className="htAutocomplete";var I=document.createElement("DIV");I.className="htAutocompleteArrow",I.appendChild(document.createTextNode("▼")),i.AutocompleteRenderer=function(t,e,n,o,s,r,a){var l=L.cloneNode(!1),c=I.cloneNode(!1);t.acArrowListener||(t.acArrowListener=function(){t.view.wt.getSetting("onCellDblClick")},t.rootElement.on("mouseup",".htAutocompleteArrow",t.acArrowListener)),i.TextRenderer(t,l,n,o,s,r,a),l.firstChild||l.appendChild(document.createTextNode(" ")),l.appendChild(c),t.view.wt.wtDom.empty(e),e.appendChild(l)};var B=document.createElement("INPUT");B.className="htCheckboxRendererInput",B.type="checkbox",B.setAttribute("autocomplete","off"),i.CheckboxRenderer=function(e,n,o,s,r,a,l){l.checkedTemplate===void 0&&(l.checkedTemplate=!0),l.uncheckedTemplate===void 0&&(l.uncheckedTemplate=!1),e.view.wt.wtDom.empty(n);var c=B.cloneNode(!1);a===l.checkedTemplate||a===i.helper.stringify(l.checkedTemplate)?(c.checked=!0,n.appendChild(c)):a===l.uncheckedTemplate||a===i.helper.stringify(l.uncheckedTemplate)?n.appendChild(c):null===a?(c.className+=" noValue",n.appendChild(c)):n.appendChild(document.createTextNode("#bad value#"));var h=t(c);return l.readOnly?h.on("click",function(t){t.preventDefault()}):(h.on("mousedown",function(t){this.checked?e.setDataAtRowProp(o,r,l.uncheckedTemplate):e.setDataAtRowProp(o,r,l.checkedTemplate),t.stopPropagation()}),h.on("mouseup",function(t){t.stopPropagation()})),n},i.NumericRenderer=function(t,e,n,o,s,r,a){i.helper.isNumeric(r)?(a.language!==void 0&&numeral.language(a.language),t.view.wt.wtDom.empty(e),t.view.wt.wtDom.addClass(e,"htNumeric"),e.appendChild(document.createTextNode(numeral(r).format(a.format||"0"))),a.valid===!1&&a.invalidCellClassName&&(e.className=a.invalidCellClassName)):i.TextRenderer(t,e,n,o,s,r,a)},n.prototype.createElements=function(){this.wtDom=new x,this.TEXTAREA=document.createElement("TEXTAREA"),this.TEXTAREA.className="handsontableInput",this.textareaStyle=this.TEXTAREA.style,this.textareaStyle.width=0,this.textareaStyle.height=0,this.$textarea=t(this.TEXTAREA),this.TEXTAREA_PARENT=document.createElement("DIV"),this.TEXTAREA_PARENT.className="handsontableInputHolder",this.textareaParentStyle=this.TEXTAREA_PARENT.style,this.textareaParentStyle.top=0,this.textareaParentStyle.left=0,this.textareaParentStyle.display="none",this.$textareaParent=t(this.TEXTAREA_PARENT),this.TEXTAREA_PARENT.appendChild(this.TEXTAREA),this.instance.rootElement[0].appendChild(this.TEXTAREA_PARENT);var e=this;i.PluginHooks.add("afterRender",function(){e.instance.registerTimeout("refresh_editor_dimensions",function(){e.refreshDimensions()},0)})},n.prototype.bindEvents=function(){var t=this;this.$textareaParent.off(".editor").on("keydown.editor",function(e){if(t.instance.PluginHooks.run("beforeKeyDown",e),!e.isImmediatePropagationStopped()){var i=(e.ctrlKey||e.metaKey)&&!e.altKey;if(17===e.keyCode||224===e.keyCode||91===e.keyCode||93===e.keyCode)return e.stopImmediatePropagation(),void 0;switch(e.keyCode){case 38:case 40:t.finishEditing(!1);break;case 9:t.finishEditing(!1),e.preventDefault();break;case 39:t.getCaretPosition(t.TEXTAREA)===t.TEXTAREA.value.length?t.finishEditing(!1):e.stopImmediatePropagation();break;case 37:0===t.getCaretPosition(t.TEXTAREA)?t.finishEditing(!1):e.stopImmediatePropagation();break;case 27:t.instance.destroyEditor(!0),e.stopImmediatePropagation();break;case 13:var n=t.instance.getSelected(),o=!(n[0]===n[2]&&n[1]===n[3]);e.ctrlKey&&!o||e.altKey?(t.TEXTAREA.value=t.TEXTAREA.value+"\n",t.TEXTAREA.focus(),e.stopImmediatePropagation()):t.finishEditing(!1,i),e.preventDefault();break;default:e.stopImmediatePropagation()}}})},n.prototype.bindTemporaryEvents=function(t,e,n,o,s,r){function a(){l.beginEditing(e,n,o,!0)}this.TD=t,this.row=e,this.col=n,this.prop=o,this.originalValue=s,this.cellProperties=r;var l=this;this.instance.focusCatcher.$el.on("keydown.editor",function(t){var s=(t.ctrlKey||t.metaKey)&&!t.altKey;if(!l.isCellEdited)if(i.helper.isPrintableChar(t.keyCode))s||l.beginEditing(e,n,o);else if(113===t.keyCode)l.beginEditing(e,n,o,!0),t.stopImmediatePropagation(),t.preventDefault();else if(13===t.keyCode&&l.instance.getSettings().enterBeginsEditing){var r=l.instance.getSelected(),a=!(r[0]===r[2]&&r[1]===r[3]);s&&!a||t.altKey?l.beginEditing(e,n,o,!0,"\n"):l.beginEditing(e,n,o,!0),t.preventDefault(),t.stopImmediatePropagation()}}),this.instance.view.wt.update("onCellDblClick",a)},n.prototype.unbindTemporaryEvents=function(){this.instance.focusCatcher.$el.off(".editor"),this.instance.view.wt.update("onCellDblClick",null)},n.prototype.getCaretPosition=function(t){if(t.selectionStart)return t.selectionStart;if(document.selection){t.focus();var e=document.selection.createRange();if(null==e)return 0;var i=t.createTextRange(),n=i.duplicate();return i.moveToBookmark(e.getBookmark()),n.setEndPoint("EndToStart",i),n.text.length}return 0},n.prototype.setCaretPosition=function(t,e){if(t.setSelectionRange)t.focus(),t.setSelectionRange(e,e);else if(t.createTextRange){var i=t.createTextRange();i.collapse(!0),i.moveEnd("character",e),i.moveStart("character",e),i.select()}},n.prototype.beginEditing=function(t,e,n,o,s){if(!this.isCellEdited){this.isCellEdited=!0,this.row=t,this.col=e,this.prop=n;var r={row:t,col:e};this.instance.view.scrollViewport(r),this.instance.view.render(),this.$textarea.on("cut.editor",function(t){t.stopPropagation()}),this.$textarea.on("paste.editor",function(t){t.stopPropagation()}),this.TEXTAREA.value=o?i.helper.stringify(this.originalValue)+(s||""):"",this.refreshDimensions(),this.TEXTAREA.focus(),this.setCaretPosition(this.TEXTAREA,this.TEXTAREA.value.length)}},n.prototype.refreshDimensions=function(){if(this.isCellEdited){this.TD=this.instance.getCell(this.row,this.col);var e=t(this.TD),i=this.wtDom.offset(this.TD),n=this.wtDom.offset(this.instance.rootElement[0]),o=this.instance.rootElement.scrollTop(),s=this.instance.rootElement.scrollLeft(),r=i.top-n.top+o-1,a=i.left-n.left+s-1,l=this.instance.getSettings(),c=l.rowHeaders===!1?0:1,h=l.colHeaders===!1?0:1;0>r&&(r=0),0>a&&(a=0),c>0&&parseInt(e.css("border-top-width"),10)>0&&(r+=1),h>0&&parseInt(e.css("border-left-width"),10)>0&&(a+=1),t.browser.msie&&7>=parseInt(t.browser.version,10)&&(r-=1),this.textareaParentStyle.top=r+"px",this.textareaParentStyle.left=a+"px";var u=e.width(),d=e.outerHeight()-4;parseInt(e.css("border-top-width"),10)>0&&(d-=1),parseInt(e.css("border-left-width"),10)>0&&c>0&&(u-=1),this.$textarea.autoResize({maxHeight:200,minHeight:d,minWidth:u,maxWidth:Math.max(168,u),animate:!1,extraSpace:0}),this.textareaParentStyle.display="block"}},n.prototype.finishEditing=function(e,i){if(this.isCellEdited&&(this.isCellEdited=!1,!e)){var n=[[t.trim(this.TEXTAREA.value)]];if(i){var o=this.instance.getSelected();this.instance.populateFromArray(o[0],o[1],n,o[2],o[3],"edit")}else this.instance.populateFromArray(this.row,this.col,n,null,null,"edit")}this.unbindTemporaryEvents(),document.activeElement===this.TEXTAREA&&this.instance.listen(),this.textareaParentStyle.display="none"},i.TextEditor=function(t,e,i,o,s,r,a){return t.textEditor||(t.textEditor=new n(t)),t.textEditor.bindTemporaryEvents(e,i,o,s,r,a),function(e){t.textEditor.finishEditing(e)}},i.helper.inherit(o,n),o.prototype.createElements=function(){n.prototype.createElements.call(this),this.$textarea.typeahead(),this.typeahead=this.$textarea.data("typeahead"),this.typeahead._render=this.typeahead.render,this.typeahead.minLength=0,this.typeahead.lookup=function(){var e;return this.query=this.$element.val(),e=t.isFunction(this.source)?this.source(this.query,t.proxy(this.process,this)):this.source,e?this.process(e):this},this.typeahead.matcher=function(){return!0};var e=this.typeahead.process,i=this;this.typeahead.process=function(n){for(var o=!1,s=0,r=n.length;r>s;s++)""===n[s]&&(o||(n=t.extend([],n),o=!0),n[s]=i.emptyStringLabel);return e.call(this,n)}},o.prototype.bindEvents=function(){var t=this;this.$textarea.off("keydown").off("keyup").off("keypress"),this.$textareaParent.off(".acEditor").on("keydown.acEditor",function(e){switch(e.keyCode){case 38:t.typeahead.prev(),e.stopImmediatePropagation();break;case 40:t.typeahead.next(),e.stopImmediatePropagation();break;case 13:e.preventDefault()}}),this.$textareaParent.on("keyup.acEditor",function(e){(i.helper.isPrintableChar(e.keyCode)||113===e.keyCode||13===e.keyCode||8===e.keyCode||46===e.keyCode)&&t.typeahead.lookup()}),n.prototype.bindEvents.call(this)},o.prototype.bindTemporaryEvents=function(t,e,i,o,s,r){function a(){h.beginEditing(e,i,o,!0),h.instance.registerTimeout("IE9_align_fix",function(){h.typeahead.lookup()},1)}var l,c,h=this;this.typeahead.select=function(){var t=this.hide();h.instance.destroyEditor(!0);var n=this.$menu.find(".active").attr("data-value");return n===h.emptyStringLabel&&(n=""),"function"==typeof r.onSelect?r.onSelect(e,i,o,n,this.$menu.find(".active").index()):h.instance.setDataAtRowProp(e,o,n),t},this.typeahead.render=function(t){return h.typeahead._render.call(this,t),r.strict||this.$menu.find("li:eq(0)").removeClass("active"),this};for(l in r)if("options"===l)for(c in r.options)this.typeahead.options[c]=r.options[c];else this.typeahead[l]=r[l];n.prototype.bindTemporaryEvents.call(this,t,e,i,o,s,r),this.instance.view.wt.update("onCellDblClick",a)},o.prototype.finishEditing=function(t,e){t||(this.isMenuExpanded()&&this.typeahead.$menu.find(".active").length?(this.typeahead.select(),this.isCellEdited=!1):this.cellProperties.strict&&(this.isCellEdited=!1)),n.prototype.finishEditing.call(this,t,e)},o.prototype.isMenuExpanded=function(){return this.typeahead.$menu.is(":visible")?this.typeahead:!1},i.AutocompleteEditor=function(t,e,i,n,s,r,a){return t.autocompleteEditor||(t.autocompleteEditor=new o(t)),t.autocompleteEditor.bindTemporaryEvents(e,i,n,s,r,a),function(e){t.autocompleteEditor.finishEditing(e)}},i.CheckboxEditor=function(t,e,n,o,r,a,l){return l===void 0&&(l={}),l.checkedTemplate===void 0&&(l.checkedTemplate=!0),l.uncheckedTemplate===void 0&&(l.uncheckedTemplate=!1),t.$table.on("keydown.editor",function(e){var o=(e.ctrlKey||e.metaKey)&&!e.altKey;!o&&i.helper.isPrintableChar(e.keyCode)&&(s(t,n,r,l),e.stopImmediatePropagation(),e.preventDefault())}),t.view.wt.update("onCellDblClick",function(){s(t,n,r,l)}),function(){t.$table.off(".editor"),t.view.wt.update("onCellDblClick",null)}},i.helper.inherit(r,n),r.prototype.createElements=function(){n.prototype.createElements.call(this),this.datePicker=document.createElement("DIV"),this.datePickerStyle=this.datePicker.style,this.datePickerStyle.position="absolute",this.datePickerStyle.top=0,this.datePickerStyle.left=0,this.datePickerStyle.zIndex=99,this.instance.rootElement[0].appendChild(this.datePicker),this.$datePicker=t(this.datePicker);var e=this,i={dateFormat:"yy-mm-dd",showButtonPanel:!0,changeMonth:!0,changeYear:!0,altField:this.$textarea,onSelect:function(){e.finishEditing(!1)}};this.$datePicker.datepicker(i),this.hideDatepicker()},r.prototype.beginEditing=function(t,e,i,o,s){n.prototype.beginEditing.call(this,t,e,i,o,s),this.showDatepicker()},r.prototype.finishEditing=function(t,e){this.hideDatepicker(),n.prototype.finishEditing.call(this,t,e)},r.prototype.showDatepicker=function(){var e=t(this.instance.dateEditor.TD),i=e.position();this.datePickerStyle.top=i.top+e.height()+"px",this.datePickerStyle.left=i.left+"px";var n={defaultDate:this.originalValue||void 0};t.extend(n,this.cellProperties),this.$datePicker.datepicker("option",n),this.originalValue&&this.$datePicker.datepicker("setDate",this.originalValue),this.datePickerStyle.display="block"},r.prototype.hideDatepicker=function(){this.datePickerStyle.display="none"},i.DateEditor=function(t,e,i,n,o,s,a){return t.dateEditor||(t.dateEditor=new r(t)),t.dateEditor.bindTemporaryEvents(e,i,n,o,s,a),function(e){t.dateEditor.finishEditing(e)}},i.helper.inherit(a,n),a.prototype.createElements=function(){n.prototype.createElements.call(this);var e=document.createElement("DIV");e.className="handsontableEditor",this.TEXTAREA_PARENT.appendChild(e),this.$htContainer=t(e)},a.prototype.bindTemporaryEvents=function(e,i,o,s,r,a){var l=this,c={colHeaders:!0,cells:function(){return{readOnly:!0}},fillHandle:!1,width:2e3,afterOnCellMouseDown:function(){var t=this.getSelected();l.TEXTAREA.value=this.getDataAtCell(t[0],t[1]),l.instance.destroyEditor()},beforeOnKeyDown:function(t){switch(t.keyCode){case 27:l.instance.destroyEditor(!0);break;case 13:var e=this.getSelected();l.TEXTAREA.value=this.getDataAtCell(e[0],e[1]),l.instance.destroyEditor()}}};a.handsontable&&(c=t.extend(c,a.handsontable)),this.$htContainer.handsontable(c),n.prototype.bindTemporaryEvents.call(this,e,i,o,s,r,a)},a.prototype.beginEditing=function(t,e,i,o,s){var r=this.instance.getSettings().onBeginEditing;r&&r()===!1||(n.prototype.beginEditing.call(this,t,e,i,o,s),this.$htContainer.handsontable("render"),this.$htContainer.handsontable("selectCell",0,0))},a.prototype.finishEditing=function(t,e){if(i.helper.isDescendant(this.instance.rootElement[0],document.activeElement)){var o=this;setTimeout(function(){o.instance.listen()},0),o.instance.listen()}this.$htContainer.handsontable("destroy"),n.prototype.finishEditing.call(this,t,e)},a.prototype.isMenuExpanded=function(){return this.typeahead.$menu.is(":visible")?this.typeahead:!1},i.HandsontableEditor=function(t,e,i,n,o,s,r){return t.handsontableEditor||(t.handsontableEditor=new a(t)),t.handsontableEditor.bindTemporaryEvents(e,i,n,o,s,r),t.registerEditor=t.handsontableEditor,function(e){t.handsontableEditor.finishEditing(e)}},i.NumericValidator=function(t,e){e(/^-?\d*\.?\d*$/.test(t))},i.AutocompleteCell={editor:i.AutocompleteEditor,renderer:i.AutocompleteRenderer},i.CheckboxCell={editor:i.CheckboxEditor,renderer:i.CheckboxRenderer},i.TextCell={editor:i.TextEditor,renderer:i.TextRenderer},i.NumericCell={editor:i.TextEditor,renderer:i.NumericRenderer,validator:i.NumericValidator,dataType:"number"},i.DateCell={editor:i.DateEditor,renderer:i.AutocompleteRenderer},i.HandsontableCell={editor:i.HandsontableEditor,renderer:i.AutocompleteRenderer},i.cellTypes={text:i.TextCell,date:i.DateCell,numeric:i.NumericCell,checkbox:i.CheckboxCell,autocomplete:i.AutocompleteCell,handsontable:i.HandsontableCell},i.cellLookup={renderer:{text:i.TextRenderer,numeric:i.NumericRenderer,checkbox:i.CheckboxRenderer,autocomplete:i.AutocompleteRenderer},editor:{text:i.TextEditor,date:i.DateEditor,checkbox:i.CheckboxEditor,autocomplete:i.AutocompleteEditor,handsontable:i.HandsontableEditor},validator:{numeric:i.NumericValidator}},i.PluginHookClass=function(){function t(){this.hooks={once:e(),persistent:e()},this.legacy=i}var e=function(){return{beforeInitWalkontable:[],beforeInit:[],beforeRender:[],beforeChange:[],beforeValidate:[],beforeGet:[],beforeSet:[],beforeGetCellMeta:[],beforeAutofill:[],beforeKeyDown:[],afterInit:[],afterLoadData:[],afterRender:[],afterChange:[],afterValidate:[],afterGetCellMeta:[],afterGetColHeader:[],afterGetColWidth:[],afterDestroy:[],afterRemoveRow:[],afterCreateRow:[],afterRemoveCol:[],afterCreateCol:[],afterColumnResize:[],afterColumnMove:[],afterDeselect:[],afterSelection:[],afterSelectionByProp:[],afterSelectionEnd:[],afterSelectionEndByProp:[],afterCopyLimit:[],modifyCol:[]}},i={onBeforeChange:"beforeChange",onChange:"afterChange",onCreateRow:"afterCreateRow",onCreateCol:"afterCreateCol",onSelection:"afterSelection",onCopyLimit:"afterCopyLimit",onSelectionEnd:"afterSelectionEnd",onSelectionByProp:"afterSelectionByProp",onSelectionEndByProp:"afterSelectionEndByProp"},n=function(t){return function(e,n){if(e in i&&(e=i[e]),this.hooks[t][e]===void 0&&(this.hooks[t][e]=[]),n instanceof Array)for(var o=0,s=n.length;s>o;o++)this.hooks[t][e].push(n[o]);else this.hooks[t][e].push(n);return this}};return t.prototype.add=n("persistent"),t.prototype.once=n("once"),t.prototype.remove=function(t,e){var n,o,s,r,a,l=!1,c=["persistent","once"];t in i&&(t=i[t]);for(o=0,s=c.length;s>o;o++)if(n=c[o],this.hooks[n][t]!==void 0)for(r=0,a=this.hooks[n][t].length;a>r;r++)if(this.hooks[n][t][r]==e){this.hooks[n][t].splice(r,1),l=!0;break}return l},t.prototype.run=function(t,e,n,o,s,r,a){var l,c,h,u,d,p=["persistent","once"];e in i&&(e=i[e]);for(c=0,h=p.length;h>c;c++)if(l=p[c],this.hooks[l][e]!==void 0)for(u=0,d=this.hooks[l][e].length;d>u;u++)this.hooks[l][e][u].call(t,n,o,s,r,a),"once"===l&&this.hooks[l][e].splice(u,1)},t.prototype.execute=function(t,e,n,o,s,r,a){var l,c,h,u,d,p=["persistent","once"];e in i&&(e=i[e]);for(c=0,h=p.length;h>c;c++)if(l=p[c],this.hooks[l][e]!==void 0)for(u=0,d=this.hooks[l][e].length;d>u;u++)n=this.hooks[l][e][u].call(t,n,o,s,r,a),"once"===l&&this.hooks[l][e].splice(u,1);return n},t}(),i.PluginHooks=new i.PluginHookClass;var z=new l;i.PluginHooks.add("beforeInit",z.beforeInit),i.PluginHooks.add("beforeRender",z.determineColumnsWidth),i.PluginHooks.add("afterGetColWidth",z.getColWidth);var _=new c;i.PluginHooks.add("afterInit",_.afterInit),i.PluginHooks.add("beforeGet",_.translateRow),i.PluginHooks.add("beforeSet",_.translateRow),i.PluginHooks.add("afterGetColHeader",_.getColHeader),i.PluginHooks.add("afterInit",h),i.PluginHooks.add("afterDestroy",u),i.PluginHooks.add("beforeGetCellMeta",function(t,e,n){var o,s,r,a=this.getSettings(),l=this.getData();if(a.autoComplete)for(o=0,s=a.autoComplete.length;s>o;o++)if(a.autoComplete[o].match(t,e,l)){n.type===void 0?n.type=i.AutocompleteCell:(n.type.renderer===void 0&&(n.type.renderer=i.AutocompleteCell.renderer),n.type.editor===void 0&&(n.type.editor=i.AutocompleteCell.editor));for(r in a.autoComplete[o])a.autoComplete[o].hasOwnProperty(r)&&"match"!==r&&n[o]===void 0&&(n[r]="source"===r?a.autoComplete[o][r](t,e):a.autoComplete[o][r]);break}});var F=new d;i.PluginHooks.add("beforeInit",F.beforeInit),i.PluginHooks.add("afterInit",F.afterInit),i.PluginHooks.add("afterGetColHeader",F.getColHeader),i.PluginHooks.add("modifyCol",F.modifyCol);var W=new p;i.PluginHooks.add("beforeInit",W.beforeInit),i.PluginHooks.add("afterInit",W.afterInit),i.PluginHooks.add("afterGetColHeader",W.getColHeader),i.PluginHooks.add("afterGetColWidth",W.getColWidth);var j=new f;i.PluginHooks.add("afterLoadData",j.afterLoadData),function(t){function e(n){return this.filter(e.resizableFilterSelector).each(function(){new i(t(this),n)}),this}function i(i,n){this.clones||(this.config=t.extend({},e.defaults,n),this.el=i,this.nodeName=i[0].nodeName.toLowerCase(),this.previousScrollTop=null,"original"===n.maxWidth&&(n.maxWidth=i.width()),"original"===n.minWidth&&(n.minWidth=i.width()),"original"===n.maxHeight&&(n.maxHeight=i.height()),"original"===n.minHeight&&(n.minHeight=i.height()),"textarea"===this.nodeName&&i.css({resize:"none",overflowY:"hidden"}),i.data("AutoResizer",this),this.createClone(),this.injectClone(),this.bind())}e.defaults={onResize:function(){},animate:{duration:200,complete:function(){}},extraSpace:50,minHeight:"original",maxHeight:500,minWidth:"original",maxWidth:500},e.cloneCSSProperties=["lineHeight","textDecoration","letterSpacing","fontSize","fontFamily","fontStyle","fontWeight","textTransform","textAlign","direction","wordSpacing","fontSizeAdjust","padding"],e.cloneCSSValues={position:"absolute",top:-9999,left:-9999,opacity:0,overflow:"hidden",border:"1px solid black",padding:"0.49em"},e.resizableFilterSelector="textarea,input:not(input[type]),input[type=text],input[type=password]",e.AutoResizer=i,t.fn.autoResize=e,i.prototype={bind:function(){var e=t.proxy(function(){return this.check(),!0},this);this.unbind(),this.el.bind("keyup.autoResize",e).bind("change.autoResize",e),this.check(null,!0)},unbind:function(){this.el.unbind(".autoResize")},createClone:function(){var i=this.el,n=this,o=this.config;this.clones=t(),("original"!==o.minHeight||"original"!==o.maxHeight)&&(this.hClone=i.clone().height("auto"),this.clones=this.clones.add(this.hClone)),("original"!==o.minWidth||"original"!==o.maxWidth)&&(this.wClone=t("<div/>").width("auto").css({whiteSpace:"nowrap","float":"left"}),this.clones=this.clones.add(this.wClone)),t.each(e.cloneCSSProperties,function(t,e){n.clones.css(e,i.css(e))}),this.clones.removeAttr("name").removeAttr("id").attr("tabIndex",-1).css(e.cloneCSSValues)},check:function(t,e){var i=this.config,n=this.wClone,o=this.hClone,s=this.el,r=s.val();if(n){n.text(r);var a=n.outerWidth(),l=a+i.extraSpace>=i.minWidth?a+i.extraSpace:i.minWidth,c=s.width();l=Math.min(l,i.maxWidth),(c>l&&l>=i.minWidth||l>=i.minWidth&&i.maxWidth>=l)&&(i.onResize.call(s),s.scrollLeft(0),i.animate&&!e?s.stop(1,1).animate({width:l},i.animate):s.width(l))}if(o){l&&o.width(l),o.height(0).val(r).scrollTop(1e4);var h=o[0].scrollTop+i.extraSpace;if(this.previousScrollTop===h)return;if(this.previousScrollTop=h,h>=i.maxHeight)return s.css("overflowY",""),void 0;s.css("overflowY","hidden"),i.minHeight>h&&(h=i.minHeight),i.onResize.call(s),i.animate&&!e?s.stop(1,1).animate({height:h},i.animate):s.height(h)}},destroy:function(){this.unbind(),this.el.removeData("AutoResizer"),this.clones.remove(),delete this.el,delete this.hClone,delete this.wClone,delete this.clones},injectClone:function(){(e.cloneContainer||(e.cloneContainer=t("<arclones/>").appendTo("body"))).empty().append(this.clones)}}}(jQuery),function(t){function e(t){return t.split('"').length-1}t.SheetClip={parse:function(t){var i,n,o,s,r,a,l,c=[],h=0;for(o=t.split("\n"),o.length>1&&""===o[o.length-1]&&o.pop(),i=0,n=o.length;n>i;i+=1){for(o[i]=o[i].split("	"),s=0,r=o[i].length;r>s;s+=1)c[h]||(c[h]=[]),a&&0===s?(l=c[h].length-1,c[h][l]=c[h][l]+"\n"+o[i][0],a&&1&e(o[i][0])&&(a=!1,c[h][l]=c[h][l].substring(0,c[h][l].length-1).replace(/""/g,'"'))):s===r-1&&0===o[i][s].indexOf('"')?(c[h].push(o[i][s].substring(1).replace(/""/g,'"')),a=!0):(c[h].push(o[i][s].replace(/""/g,'"')),a=!1);a||(h+=1)}return c},stringify:function(t){var e,i,n,o,s,r="";for(e=0,i=t.length;i>e;e+=1){for(n=0,o=t[e].length;o>n;n+=1)n>0&&(r+="	"),s=t[e][n],r+="string"==typeof s?s.indexOf("\n")>-1?'"'+s.replace(/"/g,'""')+'"':s:null===s||void 0===s?"":s;r+="\n"}return r}}}(e),g.prototype.selectNodeText=function(t){t.select()},g.prototype.copyable=function(t){if("string"!=typeof t&&void 0===t.toString)throw Error("copyable requires string parameter");this.elTextarea.value=t},g.prototype.onCopy=function(t){this.copyCallback=t},g.prototype.onCut=function(t){this.cutCallback=t},g.prototype.onPaste=function(t){this.pasteCallback=t},g.prototype.triggerCut=function(t){var e=this;e.cutCallback&&setTimeout(function(){e.cutCallback(t)},50)},g.prototype.triggerPaste=function(t,e){var i=this;i.pasteCallback&&setTimeout(function(){i.pasteCallback((e||i.elTextarea.value).replace(/\n$/,""),t)},50)},g.prototype._bindEvent=function(){return document.addEventListener?function(t,e,i){t.addEventListener(e,i,!1)}:function(t,i,n){t.attachEvent("on"+i,function(){var i=e.event;return i.target=i.srcElement,i.relatedTarget=i.relatedTarget||"mouseover"==i.type?i.fromElement:i.toElement,3===i.target.nodeType&&(i.target=i.target.parentNode),n.call(t,i)})}}(),m.prototype.appear=function(t){var e,i,n,o,s,r,a,l,c,h,u,d;if(!this.disabled){var p,f,g,m,w,v,y,b=this.instance,C=!1,S=!1,x=!1,T=!1;for(b.wtTable.isRowInViewport(t[0])||(C=!0),b.wtTable.isRowInViewport(t[2])||(x=!0),v=b.wtTable.rowStrategy.countVisible(),w=0;v>w;w++)if(y=b.wtTable.rowFilter.visibleToSource(w),y>=t[0]&&t[2]>=y){p=y;break}for(w=v-1;w>=0;w--)if(y=b.wtTable.rowFilter.visibleToSource(w),y>=t[0]&&t[2]>=y){g=y;break}if(C&&x)S=!0,T=!0;else{for(b.wtTable.isColumnInViewport(t[1])||(S=!0),b.wtTable.isColumnInViewport(t[3])||(T=!0),v=b.wtTable.columnStrategy.countVisible(),w=0;v>w;w++)if(y=b.wtTable.columnFilter.visibleToSource(w),y>=t[1]&&t[3]>=y){f=y;break}for(w=v-1;w>=0;w--)if(y=b.wtTable.columnFilter.visibleToSource(w),y>=t[1]&&t[3]>=y){m=y;break}}if(void 0===p||void 0===f)return this.disappear(),void 0;e=p!==g||f!==m,i=b.wtTable.getCell([p,f]),n=e?b.wtTable.getCell([g,m]):i,o=this.wtDom.offset(i),s=e?this.wtDom.offset(n):o,r=this.wtDom.offset(b.wtTable.TABLE),l=o.top,u=s.top+this.wtDom.outerHeight(n)-l,h=o.left,d=s.left+this.wtDom.outerWidth(n)-h,a=l-r.top-1,c=h-r.left-1;var k=this.wtDom.getComputedStyle(i);parseInt(k.borderTopWidth,10)>0&&(a+=1,u-=1),parseInt(k.borderLeftWidth,10)>0&&(c+=1,d-=1),C?this.topStyle.display="none":(this.topStyle.top=a+"px",this.topStyle.left=c+"px",this.topStyle.width=d+"px",this.topStyle.display="block"),S?this.leftStyle.display="none":(this.leftStyle.top=a+"px",this.leftStyle.left=c+"px",this.leftStyle.height=u+"px",this.leftStyle.display="block");var R=Math.floor(this.settings.border.width/2);x?this.bottomStyle.display="none":(this.bottomStyle.top=a+u-R+"px",this.bottomStyle.left=c+"px",this.bottomStyle.width=d+"px",this.bottomStyle.display="block"),T?this.rightStyle.display="none":(this.rightStyle.top=a+"px",this.rightStyle.left=c+d-R+"px",this.rightStyle.height=u+1+"px",this.rightStyle.display="block"),x||T||!this.hasSetting(this.settings.border.cornerVisible)?this.cornerStyle.display="none":(this.cornerStyle.top=a+u-4+"px",this.cornerStyle.left=c+d-4+"px",this.cornerStyle.display="block")}},m.prototype.disappear=function(){this.topStyle.display="none",this.leftStyle.display="none",this.bottomStyle.display="none",this.rightStyle.display="none",this.cornerStyle.display="none"},m.prototype.hasSetting=function(t){return"function"==typeof t?t():!!t},w.prototype.source=function(t){return t},w.prototype.offsetted=function(t){return t+this.offset},w.prototype.unOffsetted=function(t){return t-this.offset},w.prototype.fixed=function(t){return this.fixedCount>t?t-this.offset:t},w.prototype.unFixed=function(t){return this.fixedCount>t?t+this.offset:t},w.prototype.visibleToSource=function(t){return this.source(this.offsetted(this.fixed(t)))},w.prototype.sourceToVisible=function(t){return this.source(this.unOffsetted(this.unFixed(t)))},v.prototype.getSize=function(t){return this.cellSizes[t]},v.prototype.getContainerSize=function(t){return"function"==typeof this.containerSizeFn?this.containerSizeFn(t):this.containerSizeFn},v.prototype.countVisible=function(){return this.cellCount},v.prototype.isLastIncomplete=function(){return this.remainingSize>0},y.prototype.add=function(t,e,i){this.cache[t]||(this.cache[t]=[]),this.cache[t][e]||(this.cache[t][e]=[]),this.cache[t][e][i]=!0},y.prototype.test=function(t,e,i){return this.cache[t]&&this.cache[t][e]&&this.cache[t][e][i]},b.prototype=new w,b.prototype.readSettings=function(t){this.offset=t.wtSettings.settings.offsetColumn,this.total=t.getSetting("totalColumns"),this.fixedCount=t.getSetting("fixedColumnsLeft"),this.countTH=t.getSetting("rowHeaders").length
},b.prototype.offsettedTH=function(t){return t-this.countTH},b.prototype.unOffsettedTH=function(t){return t+this.countTH},b.prototype.visibleRowHeadedColumnToSourceColumn=function(t){return this.visibleToSource(this.offsettedTH(t))},b.prototype.sourceColumnToVisibleRowHeadedColumn=function(t){return this.unOffsettedTH(this.sourceToVisible(t))},C.prototype=new v,C.prototype.getSize=function(t){return this.cellSizes[t]+(this.cellStretch[t]||0)},C.prototype.stretch=function(){var t=this.getContainerSize(this.cellSizesSum),e=0;if(this.remainingSize=this.cellSizesSum-t,this.cellStretch.length=0,"all"===this.strategy){if(0>this.remainingSize){for(var i,n=t/this.cellSizesSum;this.cellCount-1>e;)i=Math.floor(n*this.cellSizes[e]),this.remainingSize+=i-this.cellSizes[e],this.cellStretch[e]=i-this.cellSizes[e],e++;this.cellStretch[this.cellCount-1]=-this.remainingSize,this.remainingSize=0}}else"last"===this.strategy&&0>this.remainingSize&&(this.cellStretch[this.cellCount-1]=-this.remainingSize,this.remainingSize=0)},S.prototype.draw=function(t){return this.drawInterrupted=!1,t||this.wtDom.isVisible(this.wtTable.TABLE)?(this.getSetting("beforeDraw",!t),t=t&&this.getSetting("offsetRow")===this.lastOffsetRow&&this.getSetting("offsetColumn")===this.lastOffsetColumn,this.drawn&&(this.scrollVertical(0),this.scrollHorizontal(0)),this.lastOffsetRow=this.getSetting("offsetRow"),this.lastOffsetColumn=this.getSetting("offsetColumn"),this.wtTable.draw(t),this.getSetting("onDraw"),this):(this.drawInterrupted=!0,void 0)},S.prototype.update=function(t,e){return this.wtSettings.update(t,e)},S.prototype.scrollVertical=function(t){return this.wtScroll.scrollVertical(t)},S.prototype.scrollHorizontal=function(t){return this.wtScroll.scrollHorizontal(t)},S.prototype.scrollViewport=function(t){return this.wtScroll.scrollViewport(t),this},S.prototype.getViewport=function(){return[this.wtTable.rowFilter.visibleToSource(0),this.wtTable.columnFilter.visibleToSource(0),this.wtTable.getLastVisibleRow(),this.wtTable.getLastVisibleColumn()]},S.prototype.getSetting=function(t,e,i,n){return this.wtSettings.getSetting(t,e,i,n)},S.prototype.hasSetting=function(t){return this.wtSettings.has(t)},S.prototype.destroy=function(){this.wtScrollbars.destroy(),clearTimeout(this.wheelTimeout),clearTimeout(this.dblClickTimeout)},x.prototype.closest=function(t,e){for(;null!=t;){if(1===t.nodeType&&e.indexOf(t.nodeName)>-1)return t;t=t.parentNode}return null},x.prototype.prevSiblings=function(t){for(var e=[];null!=(t=t.previousSibling);)1===t.nodeType&&e.push(t);return e},document.documentElement.classList?(x.prototype.hasClass=function(t,e){return t.classList.contains(e)},x.prototype.addClass=function(t,e){t.classList.add(e)},x.prototype.removeClass=function(t,e){t.classList.remove(e)}):(x.prototype.hasClass=function(t,e){return t.className.match(RegExp("(\\s|^)"+e+"(\\s|$)"))},x.prototype.addClass=function(t,e){this.hasClass(t,e)||(t.className+=" "+e)},x.prototype.removeClass=function(t,e){if(this.hasClass(t,e)){var i=RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(i," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}),x.prototype.removeTextNodes=function(t,e){if(3===t.nodeType)e.removeChild(t);else if(["TABLE","THEAD","TBODY","TFOOT","TR"].indexOf(t.nodeName)>-1)for(var i=t.childNodes,n=i.length-1;n>=0;n--)this.removeTextNodes(i[n],t)},x.prototype.empty=function(t){for(var e;e=t.lastChild;)t.removeChild(e)},x.prototype.avoidInnerHTML=function(t,e){if(/(<(.*)>|&(.*);)/g.test(e))t.innerHTML=e;else{for(var i;i=t.lastChild;)t.removeChild(i);t.appendChild(document.createTextNode(e))}},x.prototype.isVisible=function(t){try{if(!t.offsetParent)return!1}catch(e){return!1}if(t.offsetWidth>0)return!0;for(var i=t;i!==document.documentElement;){if(null===i)return!1;if(11===i.nodeType)return"#document-fragment"===i.nodeName?!0:!1;if("none"===i.style.display)return!1;i=i.parentNode}return!0},x.prototype.offset=function(t){for(var i=t.offsetLeft,n=t.offsetTop,o=t;(t=t.offsetParent)&&t!==document.body;)i+=t.offsetLeft,n+=t.offsetTop,o=t;return o&&"fixed"===o.style.position&&(i+=e.pageXOffset||document.documentElement.scrollLeft,n+=e.pageYOffset||document.documentElement.scrollTop),{left:i,top:n}},x.prototype.getComputedStyle=function(t){return t.currentStyle||document.defaultView.getComputedStyle(t)},x.prototype.outerWidth=function(t){return t.offsetWidth},x.prototype.outerHeight=function(t){return t.offsetHeight},T.prototype.parentCell=function(t){var e={};return e.TD=this.wtDom.closest(t,["TD","TH"]),e.TD?e.coords=this.instance.wtTable.getCoords(e.TD):!e.TD&&this.wtDom.hasClass(t,"wtBorder")&&this.wtDom.hasClass(t,"current")&&!this.wtDom.hasClass(t,"corner")&&(e.coords=this.instance.selections.current.selected[0],e.TD=this.instance.wtTable.getCell(e.coords)),e},Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length>>>0,i=Number(arguments[1])||0;for(i=0>i?Math.ceil(i):Math.floor(i),0>i&&(i+=e);e>i;i++)if(i in this&&this[i]===t)return i;return-1}),e.requestAnimFrame=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){return e.setTimeout(t,1e3/60)}}(),e.cancelRequestAnimFrame=function(){return e.cancelAnimationFrame||e.webkitCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||e.oCancelRequestAnimationFrame||e.msCancelRequestAnimationFrame||clearTimeout}(),e.getComputedStyle||function(){var t,i={getPropertyValue:function(e){return"float"==e&&(e="styleFloat"),t.currentStyle[e.toUpperCase()]||null}};e.getComputedStyle=function(e){return t=e,i}}(),k.prototype=new w,k.prototype.readSettings=function(t){this.offset=t.wtSettings.settings.offsetRow,this.total=t.getSetting("totalRows"),this.fixedCount=t.getSetting("fixedRowsTop")},R.prototype=new v,R.prototype.add=function(t,e){if(0>this.remainingSize){var i=this.sizeAtIndex(t,e);if(void 0===i)return;var n=this.getContainerSize(this.cellSizesSum+i);this.cellSizes.push(i),this.cellSizesSum+=i,this.cellCount++,this.remainingSize=this.cellSizesSum-n}},R.prototype.remove=function(){var t=this.cellSizes.pop();this.cellSizesSum-=t,this.cellCount--,this.remainingSize+=t},E.prototype.scrollVertical=function(t){if(!this.instance.drawn)throw Error("scrollVertical can only be called after table was drawn to DOM");var e,i=this.instance,n=i.getSetting("offsetRow"),o=i.getSetting("fixedRowsTop"),s=i.getSetting("totalRows"),r=i.wtViewport.getViewportHeight();return e=s>0?this.scrollLogicVertical(t,n,s,o,r,function(t){return o>t-n&&t-n>=0?i.getSetting("rowHeight",t-n):i.getSetting("rowHeight",t)},function(t){i.wtTable.verticalRenderReverse=t}):0,e!==n&&this.instance.wtScrollbars.vertical.scrollTo(e),i},E.prototype.scrollHorizontal=function(t){if(!this.instance.drawn)throw Error("scrollHorizontal can only be called after table was drawn to DOM");var e,i=this.instance,n=i.getSetting("offsetColumn"),o=i.getSetting("fixedColumnsLeft"),s=i.getSetting("totalColumns"),r=i.wtViewport.getViewportWidth();return e=s>0?this.scrollLogicHorizontal(t,n,s,o,r,function(t){return o>t-n&&t-n>=0?i.getSetting("columnWidth",t-n):i.getSetting("columnWidth",t)}):0,e!==n&&this.instance.wtScrollbars.horizontal.scrollTo(e),i},E.prototype.scrollLogicVertical=function(t,e,i,n,o,s,r){var a=e+t;return a>=i-n?(a=i-n-1,r(!0)):0>a&&(a=0),a},E.prototype.scrollLogicHorizontal=function(t,e,i,n,o,s){var r,a=e+t,l=0;if(a>n){for(a>=i-n&&(a=i-n-1),r=a;o>l&&i>r;)l+=s(r),r++;if(o>l)for(;a>0&&(l+=s(a-1),o>l);)a--}else 0>a&&(a=0);return a},E.prototype.scrollViewport=function(t){var e=this.instance.getSetting("offsetRow"),i=this.instance.getSetting("offsetColumn"),n=this.instance.wtTable.getLastVisibleRow(),o=this.instance.wtTable.getLastVisibleColumn(),s=this.instance.getSetting("totalRows"),r=this.instance.getSetting("totalColumns"),a=this.instance.getSetting("fixedRowsTop"),l=this.instance.getSetting("fixedColumnsLeft");if(0>t[0]||t[0]>s-1)throw Error("row "+t[0]+" does not exist");if(0>t[1]||t[1]>r-1)throw Error("column "+t[1]+" does not exist");return t[0]>n?(this.scrollVertical(t[0]-a-e),this.instance.wtTable.verticalRenderReverse=!0):t[0]===n&&this.instance.wtTable.rowStrategy.isLastIncomplete()?(this.scrollVertical(t[0]-a-e),this.instance.wtTable.verticalRenderReverse=!0):e>t[0]-a?this.scrollVertical(t[0]-a-e):this.scrollVertical(0),t[1]>o?this.scrollHorizontal(t[1]-o+1):t[1]===o&&this.instance.wtTable.columnStrategy.isLastIncomplete()?this.scrollHorizontal(t[1]-o+1):i>t[1]-l?this.scrollHorizontal(t[1]-l-i):this.scrollHorizontal(0),this.instance},D.prototype.init=function(){var e=this;this.$table=t(this.instance.wtTable.TABLE),this.slider=document.createElement("DIV"),this.sliderStyle=this.slider.style,this.sliderStyle.position="absolute",this.sliderStyle.top="0",this.sliderStyle.left="0",this.sliderStyle.display="none",this.slider.className="dragdealer "+this.type,this.handle=document.createElement("DIV"),this.handleStyle=this.handle.style,this.handle.className="handle",this.slider.appendChild(this.handle),this.container=this.instance.wtTable.parent,this.container.appendChild(this.slider);var i=!0;this.dragTimeout=null;var n,o=function(){e.onScroll(n)};this.dragdealer=new Q(this.slider,{vertical:"vertical"===this.type,horizontal:"horizontal"===this.type,slide:!1,speed:100,animationCallback:function(t,s){return i?(i=!1,void 0):(e.skipRefresh=!0,n="vertical"===e.type?s:t,null===e.dragTimeout&&(e.dragTimeout=setInterval(o,100),o()),void 0)},callback:function(t,i){e.skipRefresh=!1,clearInterval(e.dragTimeout),e.dragTimeout=null,n="vertical"===e.type?i:t,e.onScroll(n)}}),this.skipRefresh=!1},D.prototype.onScroll=function(t){if(this.instance.drawn&&(this.readSettings(),this.total>this.visibleCount)){var e=Math.round(this.handlePosition*this.total/this.sliderSize);1===t?"vertical"===this.type?this.instance.scrollVertical(1/0).draw():this.instance.scrollHorizontal(1/0).draw():e!==this.offset?"vertical"===this.type?this.instance.scrollVertical(e-this.offset).draw():this.instance.scrollHorizontal(e-this.offset).draw():this.refresh()}},D.prototype.getHandleSizeRatio=function(t,e){return!e||t>e?1:t/e},D.prototype.prepare=function(){if(!this.skipRefresh){var t=this.getHandleSizeRatio(this.visibleCount,this.total);this.visible=(1===t||isNaN(t))&&"auto"===this.scrollMode||"none"===this.scrollMode?!1:!0}},D.prototype.refresh=function(){if(!this.skipRefresh){if(!this.visible)return this.sliderStyle.display="none",void 0;var t,e,i,n,o=this.visibleCount,s=this.instance.wtViewport.getWorkspaceWidth(),r=this.instance.wtViewport.getWorkspaceHeight();1/0===s&&(s=this.instance.wtViewport.getWorkspaceActualWidth()),1/0===r&&(r=this.instance.wtViewport.getWorkspaceActualHeight()),"vertical"===this.type?(this.instance.wtTable.rowStrategy.isLastIncomplete()&&o--,e=r-2,this.sliderStyle.top=this.instance.wtDom.offset(this.$table[0]).top-this.instance.wtDom.offset(this.container).top+"px",this.sliderStyle.left=s-1+"px",this.sliderStyle.height=Math.max(e,0)+"px"):(this.instance.wtTable.columnStrategy.isLastIncomplete()&&o--,e=s-2,this.sliderStyle.left=this.instance.wtDom.offset(this.$table[0]).left-this.instance.wtDom.offset(this.container).left+"px",this.sliderStyle.top=r-1+"px",this.sliderStyle.width=Math.max(e,0)+"px"),t=this.getHandleSizeRatio(o,this.total),i=Math.round(e*t),10>i&&(i=15),n=Math.floor(e*(this.offset/this.total)),i+n>e&&(n=e-i),"vertical"===this.type?(this.handleStyle.height=i+"px",this.handleStyle.top=n+"px"):(this.handleStyle.width=i+"px",this.handleStyle.left=n+"px"),this.sliderStyle.display="block"}},D.prototype.destroy=function(){clearInterval(this.dragdealer.interval)};var X=function(t){this.instance=t,this.type="vertical",this.init()};X.prototype=new D,X.prototype.scrollTo=function(t){this.instance.update("offsetRow",t)},X.prototype.readSettings=function(){this.scrollMode=this.instance.getSetting("scrollV"),this.offset=this.instance.getSetting("offsetRow"),this.total=this.instance.getSetting("totalRows"),this.visibleCount=this.instance.wtTable.rowStrategy.countVisible(),this.visibleCount>1&&this.instance.wtTable.rowStrategy.isLastIncomplete()&&this.visibleCount--,this.handlePosition=parseInt(this.handleStyle.top,10),this.sliderSize=parseInt(this.sliderStyle.height,10),this.fixedCount=this.instance.getSetting("fixedRowsTop")};var Y=function(t){this.instance=t,this.type="horizontal",this.init()};Y.prototype=new D,Y.prototype.scrollTo=function(t){this.instance.update("offsetColumn",t)},Y.prototype.readSettings=function(){this.scrollMode=this.instance.getSetting("scrollH"),this.offset=this.instance.getSetting("offsetColumn"),this.total=this.instance.getSetting("totalColumns"),this.visibleCount=this.instance.wtTable.columnStrategy.countVisible(),this.visibleCount>1&&this.instance.wtTable.columnStrategy.isLastIncomplete()&&this.visibleCount--,this.handlePosition=parseInt(this.handleStyle.left,10),this.sliderSize=parseInt(this.sliderStyle.width,10),this.fixedCount=this.instance.getSetting("fixedColumnsLeft")},P.prototype.init=function(){this.fixedContainer=this.instance.wtTable.TABLE.parentNode.parentNode.parentNode,this.fixed=this.instance.wtTable.TABLE.parentNode.parentNode,this.TABLE=this.instance.wtTable.TABLE,this.$scrollHandler=t(e);var i=this;this.$scrollHandler.on("scroll.walkontable",function(){return i.instance.wtTable.parent.parentNode?(i.onScroll(),void 0):(i.destroy(),void 0)}),this.readSettings()},P.prototype.onScroll=function(){if(this.readSettings(),this.windowScrollPosition!==this.lastWindowScrollPosition){this.lastWindowScrollPosition=this.windowScrollPosition;var t,e=0;this.windowScrollPosition>this.tableParentOffset&&(t=this.windowScrollPosition-this.tableParentOffset,e=Math.ceil(t/20,10),e=Math.min(e,this.total)),this.instance.update("offsetRow",e),this.instance.draw()}},P.prototype.prepare=function(){},P.prototype.availableSize=function(){var t;return t=this.windowScrollPosition>this.tableParentOffset?this.instance.wtTable.getLastVisibleRow()===this.total-1?this.instance.wtDom.outerHeight(this.TABLE):this.windowSize:this.windowSize-(this.tableParentOffset-this.windowScrollPosition)},P.prototype.refresh=function(){var t=this.getLastCell();this.measureBefore=this.offset*this.cellSize,this.measureInside=this.getTableSize(),this.measureAfter=-1===t?0:(this.total-t-1)*this.cellSize,this.applyToDOM()},P.prototype.destroy=function(){this.$scrollHandler.off("scroll.walkontable")};var K=function(t){this.instance=t,this.type="vertical",this.cellSize=20,this.init()};K.prototype=new P,K.prototype.getLastCell=function(){return this.instance.wtTable.getLastVisibleRow()},K.prototype.getTableSize=function(){return this.instance.wtDom.outerHeight(this.TABLE)},K.prototype.applyToDOM=function(){this.windowScrollPosition>this.tableParentOffset?(this.fixed.style.position="fixed",this.fixed.style.top="0",this.fixed.style.left=this.tableParentOtherOffset):this.fixed.style.position="relative";var t=!1;t||(this.fixedContainer.style.paddingTop=this.measureBefore+"px",this.fixedContainer.style.paddingBottom=this.measureInside+this.measureAfter+"px")},K.prototype.scrollTo=function(t){this.$scrollHandler.scrollTop(this.tableParentOffset+t*this.cellSize)},K.prototype.readSettings=function(){var t=this.instance.wtDom.offset(this.fixedContainer);this.tableParentOffset=t.top,this.tableParentOtherOffset=t.left,this.windowSize=this.$scrollHandler.height(),this.windowScrollPosition=this.$scrollHandler.scrollTop(),this.offset=this.instance.getSetting("offsetRow"),this.total=this.instance.getSetting("totalRows")};var U=function(t){this.instance=t,this.type="horizontal",this.cellSize=50,this.init()};U.prototype=new P,U.prototype.getLastCell=function(){return this.instance.wtTable.getLastVisibleColumn()},U.prototype.getTableSize=function(){return this.instance.wtDom.outerWidth(this.TABLE)},U.prototype.applyToDOM=function(){this.windowScrollPosition>this.tableParentOffset?(this.fixed.style.position="fixed",this.fixed.style.left="0",this.fixed.style.top=this.tableParentOtherOffset):this.fixed.style.position="relative";var t=!1;t||(this.fixedContainer.style.paddingLeft=this.measureBefore+"px",this.fixedContainer.style.paddingRight=this.measureInside+this.measureAfter+"px")},U.prototype.scrollTo=function(t){this.$scrollHandler.scrollLeft(this.tableParentOffset+t*this.cellSize)},U.prototype.readSettings=function(){var t=this.instance.wtDom.offset(this.fixedContainer);this.tableParentOffset=t.left,this.tableParentOtherOffset=t.top,this.windowSize=this.$scrollHandler.width(),this.windowScrollPosition=this.$scrollHandler.scrollLeft(),this.offset=this.instance.getSetting("offsetColumn"),this.total=this.instance.getSetting("totalColumns")},H.prototype.destroy=function(){this.vertical.destroy(),this.horizontal.destroy()},H.prototype.refresh=function(){this.horizontal.readSettings(),this.vertical.readSettings(),this.horizontal.prepare(),this.vertical.prepare(),this.horizontal.refresh(),this.vertical.refresh()},$.prototype.add=function(t){this.selected.push(t)},$.prototype.clear=function(){this.selected.length=0},$.prototype.getCorners=function(){var t,e,i,n,o,s=this.selected.length;if(s>0&&(t=i=this.selected[0][0],e=n=this.selected[0][1],s>1))for(o=1;s>o;o++)t>this.selected[o][0]?t=this.selected[o][0]:this.selected[o][0]>i&&(i=this.selected[o][0]),e>this.selected[o][1]?e=this.selected[o][1]:this.selected[o][1]>n&&(n=this.selected[o][1]);return[t,e,i,n]},$.prototype.draw=function(){var t,e,i,n,o,s=this.instance.wtTable.rowStrategy.countVisible(),r=this.instance.wtTable.columnStrategy.countVisible();if(this.selected.length){for(t=this.getCorners(),e=0;s>e;e++)for(i=0;r>i;i++)n=this.instance.wtTable.rowFilter.visibleToSource(e),o=this.instance.wtTable.columnFilter.visibleToSource(i),n>=t[0]&&t[2]>=n&&o>=t[1]&&t[3]>=o?this.instance.wtTable.currentCellCache.add(e,i,this.settings.className):n>=t[0]&&t[2]>=n?this.instance.wtTable.currentCellCache.add(e,i,this.settings.highlightRowClassName):o>=t[1]&&t[3]>=o&&this.instance.wtTable.currentCellCache.add(e,i,this.settings.highlightColumnClassName);this.border&&this.border.appear(t)}else this.border&&this.border.disappear()},M.prototype.update=function(t,e){if(void 0===e)for(var i in t)t.hasOwnProperty(i)&&(this.settings[i]=t[i]);else this.settings[t]=e;return this.instance},M.prototype.getSetting=function(t,e,i,n){return this[t]?this[t](e,i,n):this._getSetting(t,e,i,n)},M.prototype._getSetting=function(t,e,i,n){return"function"==typeof this.settings[t]?this.settings[t](e,i,n):void 0!==e&&"[object Array]"===Object.prototype.toString.call(this.settings[t])&&void 0!==e?this.settings[t][e]:this.settings[t]},M.prototype.has=function(t){return!!this.settings[t]},M.prototype.rowHeight=function(t){var e=this.instance.wtTable.rowFilter.sourceToVisible(t),i=this.instance.wtTable.rowStrategy.getSize(e);return void 0!==i?i:20},M.prototype.columnWidth=function(t){return Math.min(200,this._getSetting("columnWidth",t))},A.prototype.refreshHiderDimensions=function(){var t=this.instance.wtViewport.getWorkspaceHeight(),e=this.instance.wtViewport.getWorkspaceWidth(),i=this.spreader.style;1/0!==t||1/0!==e?(this.hiderStyle.overflow="hidden",i.position="absolute",i.top="0",i.left="0","dragdealer"===this.instance.getSetting("scrollbarModelV")&&(i.height="4000px"),"dragdealer"===this.instance.getSetting("scrollbarModelH")&&(i.width="4000px"),1/0===t&&(t=this.instance.wtViewport.getWorkspaceActualHeight()),this.hiderStyle.height=t+"px",1/0===e&&(e=this.instance.wtViewport.getWorkspaceActualWidth()),this.hiderStyle.width=e+"px"):(i.position="relative",i.width="auto",i.height="auto")},A.prototype.refreshStretching=function(){var t=this.instance,e=t.getSetting("stretchH"),i=t.getSetting("totalRows"),n=t.getSetting("totalColumns"),o=t.getSetting("offsetColumn"),s=function(t){return r.instance.wtViewport.getViewportWidth(t)},r=this,a=function(e){var i=r.columnFilter.visibleToSource(e);return n>i?t.getSetting("columnWidth",i):void 0};"hybrid"===e&&(e=o>0?"last":"none");var l=function(t){return r.instance.wtViewport.getViewportHeight(t)},c=function(t,e){var n=r.rowFilter.visibleToSource(t);return i>n?r.verticalRenderReverse&&0===t?r.wtDom.outerHeight(e)-1:r.wtDom.outerHeight(e):void 0};this.columnStrategy=new C(s,a,e),this.rowStrategy=new R(l,c)},A.prototype.adjustAvailableNodes=function(){for(var t,e,i,n,o=this.instance.getSetting("rowHeaders"),s=o.length,r=this.instance.getSetting("columnHeaders");s>this.colgroupChildrenLength;)this.COLGROUP.appendChild(document.createElement("COL")),this.colgroupChildrenLength++;for(this.refreshStretching(),t=this.columnStrategy.cellCount;t+s>this.colgroupChildrenLength;)this.COLGROUP.appendChild(document.createElement("COL")),this.colgroupChildrenLength++;for(;this.colgroupChildrenLength>t+s;)this.COLGROUP.removeChild(this.COLGROUP.lastChild),this.colgroupChildrenLength--;if(r.length){for(e=this.THEAD.firstChild;t+s>this.theadChildrenLength;)e.appendChild(document.createElement("TH")),this.theadChildrenLength++;for(;this.theadChildrenLength>t+s;)e.removeChild(e.lastChild),this.theadChildrenLength--}for(n=0;this.colgroupChildrenLength>n;n++)s>n?this.wtDom.addClass(this.COLGROUP.childNodes[n],"rowHeader"):this.wtDom.removeClass(this.COLGROUP.childNodes[n],"rowHeader");if(r.length&&(e=this.THEAD.firstChild,s))for(i=e.firstChild,n=0;s>n;n++)o[n](-s+n,i),this.hasEmptyCellProblem&&(i.innerHTML="&nbsp;"),i=i.nextSibling;for(n=0;t>n;n++)r.length&&r[0](this.columnFilter.visibleToSource(n),e.childNodes[s+n])},A.prototype.adjustColumns=function(t,e){for(var i=t.childNodes.length;e>i;){var n=document.createElement("TD");t.appendChild(n),i++}for(;i>e;)t.removeChild(t.lastChild),i--},A.prototype.draw=function(t){return this.rowFilter.readSettings(this.instance),this.columnFilter.readSettings(this.instance),t?this.instance.wtScrollbars.refresh():(this.tableOffset=this.wtDom.offset(this.TABLE),this._doDraw()),this.refreshPositions(t),this.instance.drawn=!0,this},A.prototype._doDraw=function(){var t,e,i,n,o,s,r,a=0,l=this.instance.getSetting("offsetRow"),c=this.instance.getSetting("totalRows"),h=this.instance.getSetting("totalColumns"),u=this.instance.getSetting("rowHeaders"),d=u.length,p=!1;this.instance.wtViewport.resetSettings();var f=!1;if(this.verticalRenderReverse&&(l===c-this.rowFilter.fixedCount-1?f=!0:(this.instance.update("offsetRow",l+1),this.rowFilter.readSettings(this.instance))),h>0){t=this.rowFilter.visibleToSource(a);for(var g=!0;c>t&&t>=0;){if(a>=this.tbodyChildrenLength||this.verticalRenderReverse&&a>=this.rowFilter.fixedCount){for(o=document.createElement("TR"),e=0;d>e;e++)o.appendChild(document.createElement("TH"));this.verticalRenderReverse&&a>=this.rowFilter.fixedCount?this.TBODY.insertBefore(o,this.TBODY.childNodes[this.rowFilter.fixedCount]||this.TBODY.firstChild):this.TBODY.appendChild(o),this.tbodyChildrenLength++}else o=0===a?this.TBODY.firstChild:o.nextSibling;for(s=o.firstChild,e=0;d>e;e++)u[e](t,s),s=s.nextSibling;if(g)for(g=!1,this.adjustAvailableNodes(),p=!0,n=this.columnStrategy.cellCount,this.adjustColumns(o,n+d),r=this.instance.wtViewport.getWorkspaceWidth(),this.columnStrategy.stretch(),e=0;n>e;e++)this.COLGROUP.childNodes[e+d].style.width=this.columnStrategy.getSize(e)+"px";else this.adjustColumns(o,n+d);for(e=0;n>e;e++)i=this.columnFilter.visibleToSource(e),s=0===e?o.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(i)]:s.nextSibling,s.className="",s.removeAttribute("style"),this.instance.getSetting("cellRenderer",t,i,s),this.hasEmptyCellProblem&&""===s.innerHTML&&(s.innerHTML="&nbsp;");if(l=this.instance.getSetting("offsetRow"),this.verticalRenderReverse&&f){if(-this.wtDom.outerHeight(o.firstChild)<this.rowStrategy.remainingSize){this.TBODY.removeChild(o),this.instance.update("offsetRow",l+1),this.tbodyChildrenLength--,this.rowFilter.readSettings(this.instance);break}this.rowStrategy.add(a,s)}else if(this.rowStrategy.add(a,s),this.rowStrategy.isLastIncomplete())break;if(this.verticalRenderReverse&&a>=this.rowFilter.fixedCount){if(0===l)break;this.instance.update("offsetRow",l-1),this.rowFilter.readSettings(this.instance)}else a++;t=this.rowFilter.visibleToSource(a)}}for(p||this.adjustAvailableNodes(),a=this.rowStrategy.countVisible();this.tbodyChildrenLength>a;)this.TBODY.removeChild(this.TBODY.lastChild),this.tbodyChildrenLength--;if(this.instance.wtScrollbars.refresh(),r!==this.instance.wtViewport.getWorkspaceWidth())for(this.columnStrategy.stretch(),e=0;this.columnStrategy.cellCount>e;e++)this.COLGROUP.childNodes[e+d].style.width=this.columnStrategy.getSize(e)+"px";this.verticalRenderReverse=!1},A.prototype.refreshPositions=function(t){this.refreshHiderDimensions(),this.refreshSelections(t)},A.prototype.refreshSelections=function(t){var e,i,n,o,s,r,a=[],l=this.rowStrategy.countVisible(),c=this.columnStrategy.countVisible();if(this.oldCellCache=this.currentCellCache,this.currentCellCache=new y,this.instance.selections)for(i in this.instance.selections)this.instance.selections.hasOwnProperty(i)&&(this.instance.selections[i].draw(),this.instance.selections[i].settings.className&&a.push(this.instance.selections[i].settings.className),this.instance.selections[i].settings.highlightRowClassName&&a.push(this.instance.selections[i].settings.highlightRowClassName),this.instance.selections[i].settings.highlightColumnClassName&&a.push(this.instance.selections[i].settings.highlightColumnClassName));for(r=a.length,e=0;l>e;e++)for(n=0;c>n;n++)for(i=this.rowFilter.visibleToSource(e),o=this.columnFilter.visibleToSource(n),s=0;r>s;s++)this.currentCellCache.test(e,n,a[s])?this.wtDom.addClass(this.getCell([i,o]),a[s]):t&&this.oldCellCache.test(e,n,a[s])&&this.wtDom.removeClass(this.getCell([i,o]),a[s])},A.prototype.getCell=function(t){return this.isRowBeforeViewport(t[0])?-1:this.isRowAfterViewport(t[0])?-2:this.isColumnBeforeViewport(t[1])?-3:this.isColumnAfterViewport(t[1])?-4:this.TBODY.childNodes[this.rowFilter.sourceToVisible(t[0])].childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(t[1])]},A.prototype.getCoords=function(t){return[this.rowFilter.visibleToSource(this.wtDom.prevSiblings(t.parentNode).length),this.columnFilter.visibleRowHeadedColumnToSourceColumn(t.cellIndex)]},A.prototype.getLastVisibleRow=function(){return this.rowFilter.visibleToSource(this.rowStrategy.cellCount-1)},A.prototype.getLastVisibleColumn=function(){return this.columnFilter.visibleToSource(this.columnStrategy.cellCount-1)},A.prototype.isRowBeforeViewport=function(t){return this.rowFilter.sourceToVisible(t)<this.rowFilter.fixedCount&&t>=this.rowFilter.fixedCount},A.prototype.isRowAfterViewport=function(t){return t>this.getLastVisibleRow()},A.prototype.isColumnBeforeViewport=function(t){return this.columnFilter.sourceToVisible(t)<this.columnFilter.fixedCount&&t>=this.columnFilter.fixedCount},A.prototype.isColumnAfterViewport=function(t){return t>this.getLastVisibleColumn()},A.prototype.isRowInViewport=function(t){return!this.isRowBeforeViewport(t)&&!this.isRowAfterViewport(t)},A.prototype.isColumnInViewport=function(t){return!this.isColumnBeforeViewport(t)&&!this.isColumnAfterViewport(t)},A.prototype.isLastRowFullyVisible=function(){return this.getLastVisibleRow()===this.instance.getSetting("totalRows")-1&&!this.rowStrategy.isLastIncomplete()},A.prototype.isLastColumnFullyVisible=function(){return this.getLastVisibleColumn()===this.instance.getSetting("totalColumns")-1&&!this.columnStrategy.isLastIncomplete()},O.prototype.getWorkspaceHeight=function(t){var e=this.instance.getSetting("height");return(1/0===e||void 0===e||null===e||1>e)&&(e=this.instance.wtScrollbars.vertical instanceof P?this.instance.wtScrollbars.vertical.availableSize():1/0),1/0!==e&&(t>=e?e-=this.instance.getSetting("scrollbarHeight"):this.instance.wtScrollbars.horizontal.visible&&(e-=this.instance.getSetting("scrollbarHeight"))),e},O.prototype.getWorkspaceWidth=function(t){var e=this.instance.getSetting("width");return(1/0===e||void 0===e||null===e||1>e)&&(e=this.instance.wtScrollbars.horizontal instanceof P?this.instance.wtScrollbars.horizontal.availableSize():1/0),1/0!==e&&(t>=e?e-=this.instance.getSetting("scrollbarWidth"):this.instance.wtScrollbars.vertical.visible&&(e-=this.instance.getSetting("scrollbarWidth"))),e},O.prototype.getWorkspaceActualHeight=function(){return this.instance.wtDom.outerHeight(this.instance.wtTable.TABLE)},O.prototype.getWorkspaceActualWidth=function(){return this.instance.wtDom.outerWidth(this.instance.wtTable.TABLE)||this.instance.wtDom.outerWidth(this.instance.wtTable.TBODY)||this.instance.wtDom.outerWidth(this.instance.wtTable.THEAD)},O.prototype.getViewportHeight=function(t){var e=this.getWorkspaceHeight(t);if(1/0===e)return e;if(isNaN(this.columnHeaderHeight)){var i=this.instance.wtDom.offset(this.instance.wtTable.TBODY),n=this.instance.wtTable.tableOffset;this.columnHeaderHeight=i.top-n.top}return this.columnHeaderHeight>0?e-this.columnHeaderHeight:e},O.prototype.getViewportWidth=function(t){var e=this.getWorkspaceWidth(t);if(1/0===e)return e;if(isNaN(this.rowHeaderWidth)){var i=this.instance.wtTable.TBODY?this.instance.wtTable.TBODY.firstChild:null;if(i){var n=i.firstChild;for(this.rowHeaderWidth=0;n&&"TH"===n.nodeName;)this.rowHeaderWidth+=this.instance.wtDom.outerWidth(n),n=n.nextSibling}}return this.rowHeaderWidth>0?e-this.rowHeaderWidth:e},O.prototype.resetSettings=function(){this.rowHeaderWidth=0/0,this.columnHeaderHeight=0/0};var G={x:0,y:0,init:function(){this.setEvent("mouse"),this.setEvent("touch")},setEvent:function(t){var e=document["on"+t+"move"]||function(){};document["on"+t+"move"]=function(t){e(t),G.refresh(t)}},refresh:function(t){t||(t=e.event),"mousemove"==t.type?this.set(t):t.touches&&this.set(t.touches[0])},set:function(t){t.pageX||t.pageY?(this.x=t.pageX,this.y=t.pageY):(t.clientX||t.clientY)&&(this.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop)}};G.init();var q={get:function(t){var e=0,i=0;if(t.offsetParent)do i+=t.offsetLeft,e+=t.offsetTop;while(t=t.offsetParent);return[i,e]}},Q=function(t,e){if("string"==typeof t&&(t=document.getElementById(t)),t){var i=t.getElementsByTagName("div")[0];i&&-1!=i.className.search(/(^|\s)handle(\s|$)/)&&(this.init(t,i,e||{}),this.setup())}};Q.prototype={init:function(t,e,i){this.wrapper=t,this.handle=e,this.options=i,this.disabled=this.getOption("disabled",!1),this.horizontal=this.getOption("horizontal",!0),this.vertical=this.getOption("vertical",!1),this.slide=this.getOption("slide",!0),this.steps=this.getOption("steps",0),this.snap=this.getOption("snap",!1),this.loose=this.getOption("loose",!1),this.speed=this.getOption("speed",10)/100,this.xPrecision=this.getOption("xPrecision",0),this.yPrecision=this.getOption("yPrecision",0),this.callback=i.callback||null,this.animationCallback=i.animationCallback||null,this.bounds={left:i.left||0,right:-(i.right||0),top:i.top||0,bottom:-(i.bottom||0),x0:0,x1:0,xRange:0,y0:0,y1:0,yRange:0},this.value={prev:[-1,-1],current:[i.x||0,i.y||0],target:[i.x||0,i.y||0]},this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]},this.change=[0,0],this.activity=!1,this.dragging=!1,this.tapping=!1},getOption:function(t,e){return void 0!==this.options[t]?this.options[t]:e},setup:function(){this.setWrapperOffset(),this.setBoundsPadding(),this.setBounds(),this.setSteps(),this.addListeners()},setWrapperOffset:function(){this.offset.wrapper=q.get(this.wrapper)},setBoundsPadding:function(){this.bounds.left||this.bounds.right||(this.bounds.left=q.get(this.handle)[0]-this.offset.wrapper[0],this.bounds.right=-this.bounds.left),this.bounds.top||this.bounds.bottom||(this.bounds.top=q.get(this.handle)[1]-this.offset.wrapper[1],this.bounds.bottom=-this.bounds.top)},setBounds:function(){this.bounds.x0=this.bounds.left,this.bounds.x1=this.wrapper.offsetWidth+this.bounds.right,this.bounds.xRange=this.bounds.x1-this.bounds.x0-this.handle.offsetWidth,this.bounds.y0=this.bounds.top,this.bounds.y1=this.wrapper.offsetHeight+this.bounds.bottom,this.bounds.yRange=this.bounds.y1-this.bounds.y0-this.handle.offsetHeight,this.bounds.xStep=1/(this.xPrecision||Math.max(this.wrapper.offsetWidth,this.handle.offsetWidth)),this.bounds.yStep=1/(this.yPrecision||Math.max(this.wrapper.offsetHeight,this.handle.offsetHeight))
},setSteps:function(){if(this.steps>1){this.stepRatios=[];for(var t=0;this.steps-1>=t;t++)this.stepRatios[t]=t/(this.steps-1)}},addListeners:function(){var t=this;this.wrapper.onselectstart=function(){return!1},this.handle.onmousedown=this.handle.ontouchstart=function(e){t.handleDownHandler(e)},this.wrapper.onmousedown=this.wrapper.ontouchstart=function(e){t.wrapperDownHandler(e)};var i=document.onmouseup||function(){};document.onmouseup=function(e){i(e),t.documentUpHandler(e)};var n=document.ontouchend||function(){};document.ontouchend=function(e){n(e),t.documentUpHandler(e)};var o=e.onresize||function(){};e.onresize=function(e){o(e),t.documentResizeHandler(e)},this.wrapper.onmousemove=function(){t.activity=!0},this.wrapper.onclick=function(){return!t.activity},this.interval=setInterval(function(){t.animate()},25),t.animate(!1,!0)},handleDownHandler:function(t){this.activity=!1,G.refresh(t),this.preventDefaults(t,!0),this.startDrag(),this.cancelEvent(t)},wrapperDownHandler:function(t){G.refresh(t),this.preventDefaults(t,!0),this.startTap()},documentUpHandler:function(){this.stopDrag(),this.stopTap()},documentResizeHandler:function(){this.setWrapperOffset(),this.setBounds(),this.update()},enable:function(){this.disabled=!1,this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=!0,this.handle.className+=" disabled"},setStep:function(t,e,i){this.setValue(this.steps&&t>1?(t-1)/(this.steps-1):0,this.steps&&e>1?(e-1)/(this.steps-1):0,i)},setValue:function(t,e,i){this.setTargetValue([t,e||0]),i&&this.groupCopy(this.value.current,this.value.target)},startTap:function(t){this.disabled||(this.tapping=!0,this.setWrapperOffset(),this.setBounds(),void 0===t&&(t=[G.x-this.offset.wrapper[0]-this.handle.offsetWidth/2,G.y-this.offset.wrapper[1]-this.handle.offsetHeight/2]),this.setTargetOffset(t))},stopTap:function(){!this.disabled&&this.tapping&&(this.tapping=!1,this.setTargetValue(this.value.current),this.result())},startDrag:function(){this.disabled||(this.setWrapperOffset(),this.setBounds(),this.offset.mouse=[G.x-q.get(this.handle)[0],G.y-q.get(this.handle)[1]],this.dragging=!0)},stopDrag:function(){if(!this.disabled&&this.dragging){this.dragging=!1;var t=this.groupClone(this.value.current);if(this.slide){var e=this.change;t[0]+=4*e[0],t[1]+=4*e[1]}this.setTargetValue(t),this.result()}},feedback:function(){var t=this.value.current;this.snap&&this.steps>1&&(t=this.getClosestSteps(t)),this.groupCompare(t,this.value.prev)||("function"==typeof this.animationCallback&&this.animationCallback(t[0],t[1]),this.groupCopy(this.value.prev,t))},result:function(){"function"==typeof this.callback&&this.callback(this.value.target[0],this.value.target[1])},animate:function(t,e){if(!t||this.dragging){if(this.dragging){var i=this.groupClone(this.value.target),n=[G.x-this.offset.wrapper[0]-this.offset.mouse[0],G.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetOffset(n,this.loose),this.change=[this.value.target[0]-i[0],this.value.target[1]-i[1]]}(this.dragging||e)&&this.groupCopy(this.value.current,this.value.target),(this.dragging||this.glide()||e)&&(this.update(),this.feedback())}},glide:function(){var t=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];return t[0]||t[1]?(Math.abs(t[0])>this.bounds.xStep||Math.abs(t[1])>this.bounds.yStep?(this.value.current[0]+=t[0]*this.speed,this.value.current[1]+=t[1]*this.speed):this.groupCopy(this.value.current,this.value.target),!0):!1},update:function(){this.offset.current=this.snap?this.getOffsetsByRatios(this.getClosestSteps(this.value.current)):this.getOffsetsByRatios(this.value.current),this.show()},show:function(){this.groupCompare(this.offset.current,this.offset.prev)||(this.horizontal&&(this.handle.style.left=this.offset.current[0]+""+"px"),this.vertical&&(this.handle.style.top=this.offset.current[1]+""+"px"),this.groupCopy(this.offset.prev,this.offset.current))},setTargetValue:function(t,e){var i=e?this.getLooseValue(t):this.getProperValue(t);this.groupCopy(this.value.target,i),this.offset.target=this.getOffsetsByRatios(i)},setTargetOffset:function(t,e){var i=this.getRatiosByOffsets(t),n=e?this.getLooseValue(i):this.getProperValue(i);this.groupCopy(this.value.target,n),this.offset.target=this.getOffsetsByRatios(n)},getLooseValue:function(t){var e=this.getProperValue(t);return[e[0]+(t[0]-e[0])/4,e[1]+(t[1]-e[1])/4]},getProperValue:function(t){var e=this.groupClone(t);return e[0]=Math.max(e[0],0),e[1]=Math.max(e[1],0),e[0]=Math.min(e[0],1),e[1]=Math.min(e[1],1),(!this.dragging&&!this.tapping||this.snap)&&this.steps>1&&(e=this.getClosestSteps(e)),e},getRatiosByOffsets:function(t){return[this.getRatioByOffset(t[0],this.bounds.xRange,this.bounds.x0),this.getRatioByOffset(t[1],this.bounds.yRange,this.bounds.y0)]},getRatioByOffset:function(t,e,i){return e?(t-i)/e:0},getOffsetsByRatios:function(t){return[this.getOffsetByRatio(t[0],this.bounds.xRange,this.bounds.x0),this.getOffsetByRatio(t[1],this.bounds.yRange,this.bounds.y0)]},getOffsetByRatio:function(t,e,i){return Math.round(t*e)+i},getClosestSteps:function(t){return[this.getClosestStep(t[0]),this.getClosestStep(t[1])]},getClosestStep:function(t){for(var e=0,i=1,n=0;this.steps-1>=n;n++)i>Math.abs(this.stepRatios[n]-t)&&(i=Math.abs(this.stepRatios[n]-t),e=n);return this.stepRatios[e]},groupCompare:function(t,e){return t[0]==e[0]&&t[1]==e[1]},groupCopy:function(t,e){t[0]=e[0],t[1]=e[1]},groupClone:function(t){return[t[0],t[1]]},preventDefaults:function(t,i){t||(t=e.event),t.preventDefault&&t.preventDefault(),t.returnValue=!1,i&&document.selection&&document.selection.empty()},cancelEvent:function(t){t||(t=e.event),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0}},jQuery.browser||function(){var t,e;jQuery.uaMatch=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||0>t.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}},t=jQuery.uaMatch(navigator.userAgent),e={},t.browser&&(e[t.browser]=!0,e.version=t.version),e.chrome?e.webkit=!0:e.webkit&&(e.safari=!0),jQuery.browser=e}(),function(t){function i(i){var n=i||e.event,o=[].slice.call(arguments,1),s=0,r=0,a=0;return i=t.event.fix(n),i.type="mousewheel",n.wheelDelta&&(s=n.wheelDelta/120),n.detail&&(s=-n.detail/3),a=s,void 0!==n.axis&&n.axis===n.HORIZONTAL_AXIS&&(a=0,r=-1*s),void 0!==n.wheelDeltaY&&(a=n.wheelDeltaY/120),void 0!==n.wheelDeltaX&&(r=-1*n.wheelDeltaX/120),o.unshift(i,s,r,a),(t.event.dispatch||t.event.handle).apply(this,o)}var n=["DOMMouseScroll","mousewheel"];if(t.event.fixHooks)for(var o=n.length;o;)t.event.fixHooks[n[--o]]=t.event.mouseHooks;t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=n.length;t;)this.addEventListener(n[--t],i,!1);else this.onmousewheel=i},teardown:function(){if(this.removeEventListener)for(var t=n.length;t;)this.removeEventListener(n[--t],i,!1);else this.onmousewheel=null}},t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}(jQuery)})(jQuery,window,Handsontable),!function(t){"use strict";var e=function(e,i){this.$element=t(e),this.options=t.extend({},t.fn.typeahead.defaults,i),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=t(this.options.menu),this.shown=!1,this.listen()};e.prototype={constructor:e,select:function(){var t=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(t)).change(),this.hide()},updater:function(t){return t},show:function(){var e=t.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:e.top+e.height,left:e.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(){var e;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(e=t.isFunction(this.source)?this.source(this.query,t.proxy(this.process,this)):this.source,e?this.process(e):this)},process:function(e){var i=this;return e=t.grep(e,function(t){return i.matcher(t)}),e=this.sorter(e),e.length?this.render(e.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(t){return~t.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(t){for(var e,i=[],n=[],o=[];e=t.shift();)e.toLowerCase().indexOf(this.query.toLowerCase())?~e.indexOf(this.query)?n.push(e):o.push(e):i.push(e);return i.concat(n,o)},highlighter:function(t){var e=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return t.replace(RegExp("("+e+")","ig"),function(t,e){return"<strong>"+e+"</strong>"})},render:function(e){var i=this;return e=t(e).map(function(e,n){return e=t(i.options.item).attr("data-value",n),e.find("a").html(i.highlighter(n)),e[0]}),e.first().addClass("active"),this.$menu.html(e),this},next:function(){var e=this.$menu.find(".active").removeClass("active"),i=e.next();i.length||(i=t(this.$menu.find("li")[0])),i.addClass("active")},prev:function(){var t=this.$menu.find(".active").removeClass("active"),e=t.prev();e.length||(e=this.$menu.find("li").last()),e.addClass("active")},listen:function(){this.$element.on("focus",t.proxy(this.focus,this)).on("blur",t.proxy(this.blur,this)).on("keypress",t.proxy(this.keypress,this)).on("keyup",t.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",t.proxy(this.keydown,this)),this.$menu.on("click",t.proxy(this.click,this)).on("mouseenter","li",t.proxy(this.mouseenter,this)).on("mouseleave","li",t.proxy(this.mouseleave,this))},eventSupported:function(t){var e=t in this.$element;return e||(this.$element.setAttribute(t,"return;"),e="function"==typeof this.$element[t]),e},move:function(t){if(this.shown){switch(t.keyCode){case 9:case 13:case 27:t.preventDefault();break;case 38:t.preventDefault(),this.prev();break;case 40:t.preventDefault(),this.next()}t.stopPropagation()}},keydown:function(e){this.suppressKeyPressRepeat=~t.inArray(e.keyCode,[40,38,9,13,27]),this.move(e)},keypress:function(t){this.suppressKeyPressRepeat||this.move(t)},keyup:function(t){switch(t.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}t.stopPropagation(),t.preventDefault()},focus:function(){this.focused=!0},blur:function(){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(t){t.stopPropagation(),t.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(e){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),t(e.currentTarget).addClass("active")},mouseleave:function(){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var i=t.fn.typeahead;t.fn.typeahead=function(i){return this.each(function(){var n=t(this),o=n.data("typeahead"),s="object"==typeof i&&i;o||n.data("typeahead",o=new e(this,s)),"string"==typeof i&&o[i]()})},t.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},t.fn.typeahead.Constructor=e,t.fn.typeahead.noConflict=function(){return t.fn.typeahead=i,this},t(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(){var e=t(this);e.data("typeahead")||e.typeahead(e.data())})}(window.jQuery),function(){function t(t){this._n=t}function e(t,e,i){var n,o=Math.pow(10,e);if(n=(Math.round(t*o)/o).toFixed(e),i){var s=RegExp("0{1,"+i+"}$");n=n.replace(s,"")}return n}function i(t,e){var i;return i=e.indexOf("$")>-1?o(t,e):e.indexOf("%")>-1?s(t,e):e.indexOf(":")>-1?r(t,e):l(t,e)}function n(t,e){if(e.indexOf(":")>-1)t._n=a(e);else if(e===f)t._n=0;else{var i=e;"."!==d[p].delimiters.decimal&&(e=e.replace(/\./g,"").replace(d[p].delimiters.decimal,"."));for(var n=RegExp(d[p].abbreviations.thousand+"(?:\\)|(\\"+d[p].currency.symbol+")?(?:\\))?)?$"),o=RegExp(d[p].abbreviations.million+"(?:\\)|(\\"+d[p].currency.symbol+")?(?:\\))?)?$"),s=RegExp(d[p].abbreviations.billion+"(?:\\)|(\\"+d[p].currency.symbol+")?(?:\\))?)?$"),r=RegExp(d[p].abbreviations.trillion+"(?:\\)|(\\"+d[p].currency.symbol+")?(?:\\))?)?$"),l=["KB","MB","GB","TB","PB","EB","ZB","YB"],c=!1,h=0;l.length>=h&&!(c=e.indexOf(l[h])>-1?Math.pow(1024,h+1):!1);h++);t._n=(c?c:1)*(i.match(n)?Math.pow(10,3):1)*(i.match(o)?Math.pow(10,6):1)*(i.match(s)?Math.pow(10,9):1)*(i.match(r)?Math.pow(10,12):1)*(e.indexOf("%")>-1?.01:1)*Number((e.indexOf("(")>-1?"-":"")+e.replace(/[^0-9\.-]+/g,"")),t._n=c?Math.ceil(t._n):t._n}return t._n}function o(t,e){var n=1>=e.indexOf("$")?!0:!1,o="";e.indexOf(" $")>-1?(o=" ",e=e.replace(" $","")):e.indexOf("$ ")>-1?(o=" ",e=e.replace("$ ","")):e=e.replace("$","");var s=i(t,e);return n?s.indexOf("(")>-1||s.indexOf("-")>-1?(s=s.split(""),s.splice(1,0,d[p].currency.symbol+o),s=s.join("")):s=d[p].currency.symbol+o+s:s.indexOf(")")>-1?(s=s.split(""),s.splice(-1,0,o+d[p].currency.symbol),s=s.join("")):s=s+o+d[p].currency.symbol,s}function s(t,e){var n="";e.indexOf(" %")>-1?(n=" ",e=e.replace(" %","")):e=e.replace("%",""),t._n=100*t._n;var o=i(t,e);return o.indexOf(")")>-1?(o=o.split(""),o.splice(-1,0,n+"%"),o=o.join("")):o=o+n+"%",o}function r(t){var e=Math.floor(t._n/60/60),i=Math.floor((t._n-60*60*e)/60),n=Math.round(t._n-60*60*e-60*i);return e+":"+(10>i?"0"+i:i)+":"+(10>n?"0"+n:n)}function a(t){var e=t.split(":"),i=0;return 3===e.length?(i+=60*60*Number(e[0]),i+=60*Number(e[1]),i+=Number(e[2])):2===e.lenght&&(i+=60*Number(e[0]),i+=Number(e[1])),Number(i)}function l(t,i){var n=!1,o=!1,s="",r="",a="",l=Math.abs(t._n);if(0===t._n&&null!==f)return f;if(i.indexOf("(")>-1&&(n=!0,i=i.slice(1,-1)),i.indexOf("a")>-1&&(i.indexOf(" a")>-1?(s=" ",i=i.replace(" a","")):i=i.replace("a",""),l>=Math.pow(10,12)?(s+=d[p].abbreviations.trillion,t._n=t._n/Math.pow(10,12)):Math.pow(10,12)>l&&l>=Math.pow(10,9)?(s+=d[p].abbreviations.billion,t._n=t._n/Math.pow(10,9)):Math.pow(10,9)>l&&l>=Math.pow(10,6)?(s+=d[p].abbreviations.million,t._n=t._n/Math.pow(10,6)):Math.pow(10,6)>l&&l>=Math.pow(10,3)&&(s+=d[p].abbreviations.thousand,t._n=t._n/Math.pow(10,3))),i.indexOf("b")>-1){i.indexOf(" b")>-1?(r=" ",i=i.replace(" b","")):i=i.replace("b","");for(var c,h,u=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],g=0;u.length>=g;g++)if(c=Math.pow(1024,g),h=Math.pow(1024,g+1),t._n>=c&&h>t._n){r+=u[g],c>0&&(t._n=t._n/c);break}}i.indexOf("o")>-1&&(i.indexOf(" o")>-1?(a=" ",i=i.replace(" o","")):i=i.replace("o",""),a+=d[p].ordinal(t._n)),i.indexOf("[.]")>-1&&(o=!0,i=i.replace("[.]","."));var m=(""+t._n).split(".")[0],w=i.split(".")[1],v=i.indexOf(","),y="",b=!1;return w?(w.indexOf("[")>-1?(w=w.replace("]",""),w=w.split("["),y=e(t._n,w[0].length+w[1].length,w[1].length)):y=e(t._n,w.length),m=y.split(".")[0],y=y.split(".")[1].length?d[p].delimiters.decimal+y.split(".")[1]:"",o&&0===Number(y)&&(y="")):m=e(t._n,null),m.indexOf("-")>-1&&(m=m.slice(1),b=!0),v>-1&&(m=(""+m).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+d[p].delimiters.thousands)),0===i.indexOf(".")&&(m=""),(n&&b?"(":"")+(!n&&b?"-":"")+m+y+(a?a:"")+(s?s:"")+(r?r:"")+(n&&b?")":"")}function c(t,e){d[t]=e}var h,u="1.4.7",d={},p="en",f=null,g="undefined"!=typeof module&&module.exports;h=function(e){return h.isNumeral(e)?e=e.value():Number(e)||(e=0),new t(Number(e))},h.version=u,h.isNumeral=function(e){return e instanceof t},h.language=function(t,e){return t?(t&&!e&&(p=t),(e||!d[t])&&c(t,e),h):p},h.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(t){var e=t%10;return 1===~~(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th"},currency:{symbol:"$"}}),h.zeroFormat=function(t){f="string"==typeof t?t:null},h.fn=t.prototype={clone:function(){return h(this)},format:function(t){return i(this,t?t:h.defaultFormat)},unformat:function(t){return n(this,t?t:h.defaultFormat)},value:function(){return this._n},valueOf:function(){return this._n},set:function(t){return this._n=Number(t),this},add:function(t){return this._n=this._n+Number(t),this},subtract:function(t){return this._n=this._n-Number(t),this},multiply:function(t){return this._n=this._n*Number(t),this},divide:function(t){return this._n=this._n/Number(t),this},difference:function(t){var e=this._n-Number(t);return 0>e&&(e=-e),e}},g&&(module.exports=h),"undefined"==typeof ender&&(this.numeral=h),"function"==typeof define&&define.amd&&define([],function(){return h})}.call(this),function(t,e){function i(t){for(var e,i=t.split(/\s+/),n=[],o=0;e=i[o];o++)e=e[0].toUpperCase(),n.push(e);return n}function n(e){return e.id&&t('label[for="'+e.id+'"]').val()||e.name}function o(i,s,r){return r||(r=0),s.each(function(){var s,a,l=t(this),c=this,h=this.nodeName.toLowerCase();switch("label"==h&&l.find("input, textarea, select").length&&(s=l.text(),l=l.children().first(),c=l.get(0),h=c.nodeName.toLowerCase()),h){case"menu":a={name:l.attr("label"),items:{}},r=o(a.items,l.children(),r);break;case"a":case"button":a={name:l.text(),disabled:!!l.attr("disabled"),callback:function(){return function(){l.click()}}()};break;case"menuitem":case"command":switch(l.attr("type")){case e:case"command":case"menuitem":a={name:l.attr("label"),disabled:!!l.attr("disabled"),callback:function(){return function(){l.click()}}()};break;case"checkbox":a={type:"checkbox",disabled:!!l.attr("disabled"),name:l.attr("label"),selected:!!l.attr("checked")};break;case"radio":a={type:"radio",disabled:!!l.attr("disabled"),name:l.attr("label"),radio:l.attr("radiogroup"),value:l.attr("id"),selected:!!l.attr("checked")};break;default:a=e}break;case"hr":a="-------";break;case"input":switch(l.attr("type")){case"text":a={type:"text",name:s||n(c),disabled:!!l.attr("disabled"),value:l.val()};break;case"checkbox":a={type:"checkbox",name:s||n(c),disabled:!!l.attr("disabled"),selected:!!l.attr("checked")};break;case"radio":a={type:"radio",name:s||n(c),disabled:!!l.attr("disabled"),radio:!!l.attr("name"),value:l.val(),selected:!!l.attr("checked")};break;default:a=e}break;case"select":a={type:"select",name:s||n(c),disabled:!!l.attr("disabled"),selected:l.val(),options:{}},l.children().each(function(){a.options[this.value]=t(this).text()});break;case"textarea":a={type:"textarea",name:s||n(c),disabled:!!l.attr("disabled"),value:l.val()};break;case"label":break;default:a={type:"html",html:l.clone(!0)}}a&&(r++,i["key"+r]=a)}),r}t.support.htmlMenuitem="HTMLMenuItemElement"in window,t.support.htmlCommand="HTMLCommandElement"in window,t.support.eventSelectstart="onselectstart"in document.documentElement;var s=null,r=!1,a=t(window),l=0,c={},h={},u={},d={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,determinePosition:function(e){if(t.ui&&t.ui.position)e.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var i=this.offset();i.top+=this.outerHeight(),i.left+=this.outerWidth()/2-e.outerWidth()/2,e.css(i)}},position:function(i,n,o){var s;if(!n&&!o)return i.determinePosition.call(this,i.$menu),e;if("maintain"===n&&"maintain"===o)s=i.$menu.position();else{var r=i.$trigger.parents().andSelf().filter(function(){return"fixed"==t(this).css("position")}).length;r&&(o-=a.scrollTop(),n-=a.scrollLeft()),s={top:o,left:n}}var l=a.scrollTop()+a.height(),c=a.scrollLeft()+a.width(),h=i.$menu.height(),u=i.$menu.width();s.top+h>l&&(s.top-=h),s.left+u>c&&(s.left-=u),i.$menu.css(s)},positionSubmenu:function(e){if(t.ui&&t.ui.position)e.css("display","block").position({my:"left top",at:"right top",of:this,collision:"fit"}).css("display","");else{var i={top:0,left:this.outerWidth()};e.css(i)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:t.noop,hide:t.noop},callback:null,items:{}},p={timer:null,pageX:null,pageY:null},f=function(t){for(var e=0,i=t;;)if(e=Math.max(e,parseInt(i.css("z-index"),10)||0),i=i.parent(),!i||!i.length||"html body".indexOf(i.prop("nodeName").toLowerCase())>-1)break;return e},g={abortevent:function(t){t.preventDefault(),t.stopImmediatePropagation()},contextmenu:function(e){var i=t(this);if(e.preventDefault(),e.stopImmediatePropagation(),!("right"!=e.data.trigger&&e.originalEvent||i.hasClass("context-menu-disabled"))){if(s=i,e.data.build){var n=e.data.build(s,e);if(n===!1)return;if(e.data=t.extend(!0,{},d,e.data,n||{}),!e.data.items||t.isEmptyObject(e.data.items))throw window.console&&(console.error||console.log)("No items specified to show in contextMenu"),Error("No Items sepcified");e.data.$trigger=s,m.create(e.data)}m.show.call(i,e.data,e.pageX,e.pageY)}},click:function(e){e.preventDefault(),e.stopImmediatePropagation(),t(this).trigger(t.Event("contextmenu",{data:e.data,pageX:e.pageX,pageY:e.pageY}))},mousedown:function(e){var i=t(this);s&&s.length&&!s.is(i)&&s.data("contextMenu").$menu.trigger("contextmenu:hide"),2==e.button&&(s=i.data("contextMenuActive",!0))},mouseup:function(e){var i=t(this);i.data("contextMenuActive")&&s&&s.length&&s.is(i)&&!i.hasClass("context-menu-disabled")&&(e.preventDefault(),e.stopImmediatePropagation(),s=i,i.trigger(t.Event("contextmenu",{data:e.data,pageX:e.pageX,pageY:e.pageY}))),i.removeData("contextMenuActive")},mouseenter:function(e){var i=t(this),n=t(e.relatedTarget),o=t(document);n.is(".context-menu-list")||n.closest(".context-menu-list").length||s&&s.length||(p.pageX=e.pageX,p.pageY=e.pageY,p.data=e.data,o.on("mousemove.contextMenuShow",g.mousemove),p.timer=setTimeout(function(){p.timer=null,o.off("mousemove.contextMenuShow"),s=i,i.trigger(t.Event("contextmenu",{data:p.data,pageX:p.pageX,pageY:p.pageY}))},e.data.delay))},mousemove:function(t){p.pageX=t.pageX,p.pageY=t.pageY},mouseleave:function(e){var i=t(e.relatedTarget);if(!i.is(".context-menu-list")&&!i.closest(".context-menu-list").length){try{clearTimeout(p.timer)}catch(e){}p.timer=null}},layerClick:function(i){var n,o,s,r=t(this),l=r.data("contextMenuRoot"),h=!1,u=i.button,d=i.pageX,p=i.pageY;i.preventDefault(),i.stopImmediatePropagation(),r.on("mouseup",function(){h=!0}),setTimeout(function(){var f,g;if("left"==l.trigger&&0==u||"right"==l.trigger&&2==u)if(document.elementFromPoint){l.$layer.hide(),n=document.elementFromPoint(d-a.scrollLeft(),p-a.scrollTop()),l.$layer.show(),s=[];for(var m in c)s.push(m);if(n=t(n).closest(s.join(", ")),n.length&&n.is(l.$trigger[0]))return l.position.call(l.$trigger,l,d,p),e}else if(o=l.$trigger.offset(),f=t(window),o.top+=f.scrollTop(),o.top<=i.pageY&&(o.left+=f.scrollLeft(),o.left<=i.pageX&&(o.bottom=o.top+l.$trigger.outerHeight(),o.bottom>=i.pageY&&(o.right=o.left+l.$trigger.outerWidth(),o.right>=i.pageX))))return l.position.call(l.$trigger,l,d,p),e;g=function(t){t&&(t.preventDefault(),t.stopImmediatePropagation()),l.$menu.trigger("contextmenu:hide"),n&&n.length&&setTimeout(function(){n.contextMenu({x:d,y:p})},50)},h?g():r.on("mouseup",g)},50)},keyStop:function(t,e){e.isInput||t.preventDefault(),t.stopPropagation()},key:function(t){var i=s.data("contextMenu")||{};switch(i.$menu.children(),t.keyCode){case 9:case 38:if(g.keyStop(t,i),i.isInput){if(9==t.keyCode&&t.shiftKey)return t.preventDefault(),i.$selected&&i.$selected.find("input, textarea, select").blur(),i.$menu.trigger("prevcommand"),e;if(38==t.keyCode&&"checkbox"==i.$selected.find("input, textarea, select").prop("type"))return t.preventDefault(),e}else if(9!=t.keyCode||t.shiftKey)return i.$menu.trigger("prevcommand"),e;case 40:if(g.keyStop(t,i),!i.isInput)return i.$menu.trigger("nextcommand"),e;if(9==t.keyCode)return t.preventDefault(),i.$selected&&i.$selected.find("input, textarea, select").blur(),i.$menu.trigger("nextcommand"),e;if(40==t.keyCode&&"checkbox"==i.$selected.find("input, textarea, select").prop("type"))return t.preventDefault(),e;break;case 37:if(g.keyStop(t,i),i.isInput||!i.$selected||!i.$selected.length)break;if(!i.$selected.parent().hasClass("context-menu-root")){var n=i.$selected.parent().parent();return i.$selected.trigger("contextmenu:blur"),i.$selected=n,e}break;case 39:if(g.keyStop(t,i),i.isInput||!i.$selected||!i.$selected.length)break;var o=i.$selected.data("contextMenu")||{};if(o.$menu&&i.$selected.hasClass("context-menu-submenu"))return i.$selected=null,o.$selected=null,o.$menu.trigger("nextcommand"),e;break;case 35:case 36:return i.$selected&&i.$selected.find("input, textarea, select").length?e:((i.$selected&&i.$selected.parent()||i.$menu).children(":not(.disabled, .not-selectable)")[36==t.keyCode?"first":"last"]().trigger("contextmenu:focus"),t.preventDefault(),e);case 13:if(g.keyStop(t,i),i.isInput){if(i.$selected&&!i.$selected.is("textarea, select"))return t.preventDefault(),e;break}return i.$selected&&i.$selected.trigger("mouseup"),e;case 32:case 33:case 34:return g.keyStop(t,i),e;case 27:return g.keyStop(t,i),i.$menu.trigger("contextmenu:hide"),e;default:var r=String.fromCharCode(t.keyCode).toUpperCase();if(i.accesskeys[r])return i.accesskeys[r].$node.trigger(i.accesskeys[r].$menu?"contextmenu:focus":"mouseup"),e}t.stopPropagation(),i.$selected&&i.$selected.trigger(t)},prevItem:function(e){e.stopPropagation();var i=t(this).data("contextMenu")||{};if(i.$selected){var n=i.$selected;i=i.$selected.parent().data("contextMenu")||{},i.$selected=n}for(var o=i.$menu.children(),s=i.$selected&&i.$selected.prev().length?i.$selected.prev():o.last(),r=s;s.hasClass("disabled")||s.hasClass("not-selectable");)if(s=s.prev().length?s.prev():o.last(),s.is(r))return;i.$selected&&g.itemMouseleave.call(i.$selected.get(0),e),g.itemMouseenter.call(s.get(0),e);var a=s.find("input, textarea, select");a.length&&a.focus()},nextItem:function(e){e.stopPropagation();var i=t(this).data("contextMenu")||{};if(i.$selected){var n=i.$selected;i=i.$selected.parent().data("contextMenu")||{},i.$selected=n}for(var o=i.$menu.children(),s=i.$selected&&i.$selected.next().length?i.$selected.next():o.first(),r=s;s.hasClass("disabled")||s.hasClass("not-selectable");)if(s=s.next().length?s.next():o.first(),s.is(r))return;i.$selected&&g.itemMouseleave.call(i.$selected.get(0),e),g.itemMouseenter.call(s.get(0),e);var a=s.find("input, textarea, select");a.length&&a.focus()},focusInput:function(){var e=t(this).closest(".context-menu-item"),i=e.data(),n=i.contextMenu,o=i.contextMenuRoot;o.$selected=n.$selected=e,o.isInput=n.isInput=!0},blurInput:function(){var e=t(this).closest(".context-menu-item"),i=e.data(),n=i.contextMenu,o=i.contextMenuRoot;o.isInput=n.isInput=!1},menuMouseenter:function(){var e=t(this).data().contextMenuRoot;e.hovering=!0},menuMouseleave:function(e){var i=t(this).data().contextMenuRoot;i.$layer&&i.$layer.is(e.relatedTarget)&&(i.hovering=!1)},itemMouseenter:function(i){var n=t(this),o=n.data(),s=o.contextMenu,r=o.contextMenuRoot;return r.hovering=!0,i&&r.$layer&&r.$layer.is(i.relatedTarget)&&(i.preventDefault(),i.stopImmediatePropagation()),(s.$menu?s:r).$menu.children(".hover").trigger("contextmenu:blur"),n.hasClass("disabled")||n.hasClass("not-selectable")?(s.$selected=null,e):(n.trigger("contextmenu:focus"),e)},itemMouseleave:function(i){var n=t(this),o=n.data(),s=o.contextMenu,r=o.contextMenuRoot;return r!==s&&r.$layer&&r.$layer.is(i.relatedTarget)?(r.$selected&&r.$selected.trigger("contextmenu:blur"),i.preventDefault(),i.stopImmediatePropagation(),r.$selected=s.$selected=s.$node,e):(n.trigger("contextmenu:blur"),e)},itemClick:function(e){var i,n=t(this),o=n.data(),s=o.contextMenu,r=o.contextMenuRoot,a=o.contextMenuKey;if(s.items[a]&&!n.hasClass("disabled")&&!n.hasClass("context-menu-submenu")){if(e.preventDefault(),e.stopImmediatePropagation(),t.isFunction(r.callbacks[a]))i=r.callbacks[a];else{if(!t.isFunction(r.callback))return;i=r.callback}i.call(r.$trigger,a,r)!==!1?r.$menu.trigger("contextmenu:hide"):r.$menu.parent().length&&m.update.call(r.$trigger,r)}},inputClick:function(t){t.stopImmediatePropagation()},hideMenu:function(e,i){var n=t(this).data("contextMenuRoot");m.hide.call(n.$trigger,n,i&&i.force)},focusItem:function(e){e.stopPropagation();var i=t(this),n=i.data(),o=n.contextMenu,s=n.contextMenuRoot;i.addClass("hover").siblings(".hover").trigger("contextmenu:blur"),o.$selected=s.$selected=i,o.$node&&s.positionSubmenu.call(o.$node,o.$menu)},blurItem:function(e){e.stopPropagation();var i=t(this),n=i.data(),o=n.contextMenu;n.contextMenuRoot,i.removeClass("hover"),o.$selected=null}},m={show:function(i,n,o){var r=t(this),a={};if(t("#context-menu-layer").trigger("mousedown"),i.$trigger=r,i.events.show.call(r,i)===!1)return s=null,e;if(m.update.call(r,i),i.position.call(r,i,n,o),i.zIndex&&(a.zIndex=f(r)+i.zIndex),m.layer.call(i.$menu,i,a.zIndex),i.$menu.find("ul").css("zIndex",a.zIndex+1),i.$menu.css(a)[i.animation.show](i.animation.duration),r.data("contextMenu",i),t(document).off("keydown.contextMenu").on("keydown.contextMenu",g.key),i.autoHide){var l=r.position();l.right=l.left+r.outerWidth(),l.bottom=l.top+this.outerHeight(),t(document).on("mousemove.contextMenuAutoHide",function(t){!i.$layer||i.hovering||t.pageX>=l.left&&t.pageX<=l.right&&t.pageY>=l.top&&t.pageY<=l.bottom||i.$menu.trigger("contextmenu:hide")})}},hide:function(i,n){var o=t(this);if(i||(i=o.data("contextMenu")||{}),n||!i.events||i.events.hide.call(o,i)!==!1){if(i.$layer){setTimeout(function(t){return function(){t.remove()}}(i.$layer),10);try{delete i.$layer}catch(r){i.$layer=null}}s=null,i.$menu.find(".hover").trigger("contextmenu:blur"),i.$selected=null,t(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),i.$menu&&i.$menu[i.animation.hide](i.animation.duration,function(){i.build&&(i.$menu.remove(),t.each(i,function(t){switch(t){case"ns":case"selector":case"build":case"trigger":return!0;default:i[t]=e;try{delete i[t]}catch(n){}return!0}}))})}},create:function(n,o){o===e&&(o=n),n.$menu=t('<ul class="context-menu-list '+(n.className||"")+'"></ul>').data({contextMenu:n,contextMenuRoot:o}),t.each(["callbacks","commands","inputs"],function(t,e){n[e]={},o[e]||(o[e]={})}),o.accesskeys||(o.accesskeys={}),t.each(n.items,function(e,s){var r=t('<li class="context-menu-item '+(s.className||"")+'"></li>'),a=null,l=null;if(s.$node=r.data({contextMenu:n,contextMenuRoot:o,contextMenuKey:e}),s.accesskey)for(var c,h=i(s.accesskey),d=0;c=h[d];d++)if(!o.accesskeys[c]){o.accesskeys[c]=s,s._name=s.name.replace(RegExp("("+c+")","i"),'<span class="context-menu-accesskey">$1</span>');break}if("string"==typeof s)r.addClass("context-menu-separator not-selectable");else if(s.type&&u[s.type])u[s.type].call(r,s,n,o),t.each([n,o],function(i,n){n.commands[e]=s,t.isFunction(s.callback)&&(n.callbacks[e]=s.callback)});else{switch("html"==s.type?r.addClass("context-menu-html not-selectable"):s.type?(a=t("<label></label>").appendTo(r),t("<span></span>").html(s._name||s.name).appendTo(a),r.addClass("context-menu-input"),n.hasTypes=!0,t.each([n,o],function(t,i){i.commands[e]=s,i.inputs[e]=s})):s.items&&(s.type="sub"),s.type){case"text":l=t('<input type="text" value="1" name="context-menu-input-'+e+'" value="">').val(s.value||"").appendTo(a);break;case"textarea":l=t('<textarea name="context-menu-input-'+e+'"></textarea>').val(s.value||"").appendTo(a),s.height&&l.height(s.height);break;case"checkbox":l=t('<input type="checkbox" value="1" name="context-menu-input-'+e+'" value="">').val(s.value||"").prop("checked",!!s.selected).prependTo(a);break;case"radio":l=t('<input type="radio" value="1" name="context-menu-input-'+s.radio+'" value="">').val(s.value||"").prop("checked",!!s.selected).prependTo(a);break;case"select":l=t('<select name="context-menu-input-'+e+'">').appendTo(a),s.options&&(t.each(s.options,function(e,i){t("<option></option>").val(e).text(i).appendTo(l)}),l.val(s.selected));break;case"sub":t("<span></span>").html(s._name||s.name).appendTo(r),s.appendTo=s.$node,m.create(s,o),r.data("contextMenu",s).addClass("context-menu-submenu"),s.callback=null;
break;case"html":t(s.html).appendTo(r);break;default:t.each([n,o],function(i,n){n.commands[e]=s,t.isFunction(s.callback)&&(n.callbacks[e]=s.callback)}),t("<span></span>").html(s._name||s.name||"").appendTo(r)}s.type&&"sub"!=s.type&&"html"!=s.type&&(l.on("focus",g.focusInput).on("blur",g.blurInput),s.events&&l.on(s.events,n)),s.icon&&r.addClass("icon icon-"+s.icon)}s.$input=l,s.$label=a,r.appendTo(n.$menu),!n.hasTypes&&t.support.eventSelectstart&&r.on("selectstart.disableTextSelect",g.abortevent)}),n.$node||n.$menu.css("display","none").addClass("context-menu-root"),n.$menu.appendTo(n.appendTo||document.body)},update:function(i,n){var o=this;n===e&&(n=i,i.$menu.find("ul").andSelf().css({position:"static",display:"block"}).each(function(){var e=t(this);e.width(e.css("position","absolute").width()).css("position","static")}).css({position:"",display:""})),i.$menu.children().each(function(){var e=t(this),s=e.data("contextMenuKey"),r=i.items[s],a=t.isFunction(r.disabled)&&r.disabled.call(o,s,n)||r.disabled===!0;if(e[a?"addClass":"removeClass"]("disabled"),r.type)switch(e.find("input, select, textarea").prop("disabled",a),r.type){case"text":case"textarea":r.$input.val(r.value||"");break;case"checkbox":case"radio":r.$input.val(r.value||"").prop("checked",!!r.selected);break;case"select":r.$input.val(r.selected||"")}r.$menu&&m.update.call(o,r,n)})},layer:function(e,i){var n=e.$layer=t('<div id="context-menu-layer" style="position:fixed; z-index:'+i+'; top:0; left:0; opacity: 0; filter: alpha(opacity=0); background-color: #000;"></div>').css({height:a.height(),width:a.width(),display:"block"}).data("contextMenuRoot",e).insertBefore(this).on("contextmenu",g.abortevent).on("mousedown",g.layerClick);return t.support.fixedPosition||n.css({position:"absolute",height:t(document).height()}),n}};t.fn.contextMenu=function(i){if(i===e)this.first().trigger("contextmenu");else if(i.x&&i.y)this.first().trigger(t.Event("contextmenu",{pageX:i.x,pageY:i.y}));else if("hide"===i){var n=this.data("contextMenu").$menu;n&&n.trigger("contextmenu:hide")}else i?this.removeClass("context-menu-disabled"):i||this.addClass("context-menu-disabled");return this},t.contextMenu=function(i,n){"string"!=typeof i&&(n=i,i="create"),"string"==typeof n?n={selector:n}:n===e&&(n={});var o=t.extend(!0,{},d,n||{}),s=t(document);switch(i){case"create":if(!o.selector)throw Error("No selector specified");if(o.selector.match(/.context-menu-(list|item|input)($|\s)/))throw Error('Cannot bind to selector "'+o.selector+'" as it contains a reserved className');if(!o.build&&(!o.items||t.isEmptyObject(o.items)))throw Error("No Items sepcified");switch(l++,o.ns=".contextMenu"+l,c[o.selector]=o.ns,h[o.ns]=o,o.trigger||(o.trigger="right"),r||(s.on({"contextmenu:hide.contextMenu":g.hideMenu,"prevcommand.contextMenu":g.prevItem,"nextcommand.contextMenu":g.nextItem,"contextmenu.contextMenu":g.abortevent,"mouseenter.contextMenu":g.menuMouseenter,"mouseleave.contextMenu":g.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",g.inputClick).on({"mouseup.contextMenu":g.itemClick,"contextmenu:focus.contextMenu":g.focusItem,"contextmenu:blur.contextMenu":g.blurItem,"contextmenu.contextMenu":g.abortevent,"mouseenter.contextMenu":g.itemMouseenter,"mouseleave.contextMenu":g.itemMouseleave},".context-menu-item"),r=!0),s.on("contextmenu"+o.ns,o.selector,o,g.contextmenu),o.trigger){case"hover":s.on("mouseenter"+o.ns,o.selector,o,g.mouseenter).on("mouseleave"+o.ns,o.selector,o,g.mouseleave);break;case"left":s.on("click"+o.ns,o.selector,o,g.click)}o.build||m.create(o);break;case"destroy":if(o.selector){if(c[o.selector]){var a=t(".context-menu-list").filter(":visible");a.length&&a.data().contextMenuRoot.$trigger.is(o.selector)&&a.trigger("contextmenu:hide",{force:!0});try{h[c[o.selector]].$menu&&h[c[o.selector]].$menu.remove(),delete h[c[o.selector]]}catch(u){h[c[o.selector]]=null}s.off(c[o.selector])}}else s.off(".contextMenu .contextMenuAutoHide"),t.each(c,function(t,e){s.off(e)}),c={},h={},l=0,r=!1,t("#context-menu-layer, .context-menu-list").remove();break;case"html5":(!t.support.htmlCommand&&!t.support.htmlMenuitem||"boolean"==typeof n&&n)&&t('menu[type="context"]').each(function(){this.id&&t.contextMenu({selector:"[contextmenu="+this.id+"]",items:t.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw Error('Unknown operation "'+i+'"')}return this},t.contextMenu.setInputValues=function(i,n){n===e&&(n={}),t.each(i.inputs,function(t,e){switch(e.type){case"text":case"textarea":e.value=n[t]||"";break;case"checkbox":e.selected=n[t]?!0:!1;break;case"radio":e.selected=(n[e.radio]||"")==e.value?!0:!1;break;case"select":e.selected=n[t]||""}})},t.contextMenu.getInputValues=function(i,n){return n===e&&(n={}),t.each(i.inputs,function(t,e){switch(e.type){case"text":case"textarea":case"select":n[t]=e.$input.val();break;case"checkbox":n[t]=e.$input.prop("checked");break;case"radio":e.$input.prop("checked")&&(n[e.radio]=e.value)}}),n},t.contextMenu.fromMenu=function(e){var i=t(e),n={};return o(n,i.children()),n},t.contextMenu.defaults=d,t.contextMenu.types=u}(jQuery);